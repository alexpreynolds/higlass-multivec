!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["higlass-multivec.min"]=t():e["higlass-multivec.min"]=t()}(window,(function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=4)}([,function(e,t,r){"use strict";var i,n,a;n=[t],void 0===(a="function"==typeof(i=function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=e._cachedApplicationRef=Symbol("_cachedApplicationRef"),r=e._mixinRef=Symbol("_mixinRef"),i=e._originalMixin=Symbol("_originalMixin"),n=e.wrap=(e,t)=>(Object.setPrototypeOf(t,e),e[i]||(e[i]=e),t),a=e.Cached=e=>n(e,r=>{let i=e[t];if(i||(i=e[t]=Symbol(e.name)),r.hasOwnProperty(i))return r[i];let n=e(r);return r[i]=n,n}),o=e.HasInstance=e=>(Symbol.hasInstance&&!e.hasOwnProperty(Symbol.hasInstance)&&Object.defineProperty(e,Symbol.hasInstance,{value:function(e){const t=this[i];for(;null!=e;){if(e.hasOwnProperty(r)&&e[r]===t)return!0;e=Object.getPrototypeOf(e)}return!1}}),e),l=e.BareMixin=e=>n(e,t=>{let n=e(t);return n.prototype[r]=e[i],n});e.Mixin=e=>a(o(l(e))),e.mix=e=>new s(e);class s{constructor(e){this.superclass=e}with(){return Array.from(arguments).reduce((e,t)=>t(e),this.superclass)}}})?i.apply(t,n):i)||(e.exports=a)},,,function(e,t,r){"use strict";r.r(t),r.d(t,"StackedBarTrack",(function(){return Ke})),r.d(t,"ScaledStackedBarTrack",(function(){return pt})),r.d(t,"BasicMultipleLineChart",(function(){return Mt})),r.d(t,"BasicMultipleBarChart",(function(){return It})),window.higlassTracks=window.higlassTracks||{},window.higlassTracksByType=window.higlassTracksByType||{},window.higlassDataFetchersByType=window.higlassDataFetchersByType||{};const i=()=>Math.random().toString(36).substring(2,8);var n=(e,t={})=>{const{pluginType:r="track"}=t;"track"===r?((e,{force:t=!1}={})=>{let r=i();for(;window.higlassTracks[r];)r=i();e.name=r,window.higlassTracks[e.name]=e,window.higlassTracksByType[e.config.type]&&!t?console.warn(`A track with the same type (${e.config.type}) was already registered. To override it, set force to true.`):window.higlassTracksByType[e.config.type]=e})(e,t):"dataFetcher"===r&&((e,{force:t=!1}={})=>{window.higlassDataFetchersByType[e.config.type]&&!t?console.warn(`A data fetcher with the same type (${e.config.type}) was already registered. To override it, set force to true.`):window.higlassDataFetchersByType[e.config.type]=e})(e,t)};const a=Math.sqrt(50),o=Math.sqrt(10),l=Math.sqrt(2);function s(e,t,r){const i=(t-e)/Math.max(0,r),n=Math.floor(Math.log10(i)),c=i/Math.pow(10,n),u=c>=a?10:c>=o?5:c>=l?2:1;let h,v,f;return n<0?(f=Math.pow(10,-n)/u,h=Math.round(e*f),v=Math.round(t*f),h/f<e&&++h,v/f>t&&--v,f=-f):(f=Math.pow(10,n)*u,h=Math.round(e/f),v=Math.round(t/f),h*f<e&&++h,v*f>t&&--v),v<h&&.5<=r&&r<2?s(e,t,2*r):[h,v,f]}function c(e,t,r){return s(e=+e,t=+t,r=+r)[2]}function u(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function h(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function v(e){let t,r,i;function n(e,i,n=0,a=e.length){if(n<a){if(0!==t(i,i))return a;do{const t=n+a>>>1;r(e[t],i)<0?n=t+1:a=t}while(n<a)}return n}return 2!==e.length?(t=u,r=(t,r)=>u(e(t),r),i=(t,r)=>e(t)-r):(t=e===u||e===h?e:f,r=e,i=e),{left:n,center:function(e,t,r=0,a=e.length){const o=n(e,t,r,a-1);return o>r&&i(e[o-1],t)>-i(e[o],t)?o-1:o},right:function(e,i,n=0,a=e.length){if(n<a){if(0!==t(i,i))return a;do{const t=n+a>>>1;r(e[t],i)<=0?n=t+1:a=t}while(n<a)}return n}}}function f(){return 0}const d=v(u),p=d.right;d.left,v((function(e){return null===e?NaN:+e})).center;var m=p,g=function(e,t,r){e.prototype=t.prototype=r,r.constructor=e};function y(e,t){var r=Object.create(e.prototype);for(var i in t)r[i]=t[i];return r}function b(){}var x="\\s*([+-]?\\d+)\\s*",w="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",k="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",M=/^#([0-9a-f]{3,8})$/,A=new RegExp("^rgb\\("+[x,x,x]+"\\)$"),S=new RegExp("^rgb\\("+[k,k,k]+"\\)$"),D=new RegExp("^rgba\\("+[x,x,x,w]+"\\)$"),T=new RegExp("^rgba\\("+[k,k,k,w]+"\\)$"),O=new RegExp("^hsl\\("+[w,k,k]+"\\)$"),C=new RegExp("^hsla\\("+[w,k,k,w]+"\\)$"),_={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function z(){return this.rgb().formatHex()}function V(){return this.rgb().formatRgb()}function I(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=M.exec(e))?(r=t[1].length,t=parseInt(t[1],16),6===r?F(t):3===r?new R(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===r?P(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===r?P(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=A.exec(e))?new R(t[1],t[2],t[3],1):(t=S.exec(e))?new R(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=D.exec(e))?P(t[1],t[2],t[3],t[4]):(t=T.exec(e))?P(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=O.exec(e))?G(t[1],t[2]/100,t[3]/100,1):(t=C.exec(e))?G(t[1],t[2]/100,t[3]/100,t[4]):_.hasOwnProperty(e)?F(_[e]):"transparent"===e?new R(NaN,NaN,NaN,0):null}function F(e){return new R(e>>16&255,e>>8&255,255&e,1)}function P(e,t,r,i){return i<=0&&(e=t=r=NaN),new R(e,t,r,i)}function B(e){return e instanceof b||(e=I(e)),e?new R((e=e.rgb()).r,e.g,e.b,e.opacity):new R}function E(e,t,r,i){return 1===arguments.length?B(e):new R(e,t,r,null==i?1:i)}function R(e,t,r,i){this.r=+e,this.g=+t,this.b=+r,this.opacity=+i}function j(){return"#"+H(this.r)+H(this.g)+H(this.b)}function N(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function H(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function G(e,t,r,i){return i<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new L(e,t,r,i)}function X(e){if(e instanceof L)return new L(e.h,e.s,e.l,e.opacity);if(e instanceof b||(e=I(e)),!e)return new L;if(e instanceof L)return e;var t=(e=e.rgb()).r/255,r=e.g/255,i=e.b/255,n=Math.min(t,r,i),a=Math.max(t,r,i),o=NaN,l=a-n,s=(a+n)/2;return l?(o=t===a?(r-i)/l+6*(r<i):r===a?(i-t)/l+2:(t-r)/l+4,l/=s<.5?a+n:2-a-n,o*=60):l=s>0&&s<1?0:o,new L(o,l,s,e.opacity)}function L(e,t,r,i){this.h=+e,this.s=+t,this.l=+r,this.opacity=+i}function Y(e,t,r){return 255*(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)}function W(e,t,r,i,n){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*r+(1+3*e+3*a-3*o)*i+o*n)/6}g(b,I,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:z,formatHex:z,formatHsl:function(){return X(this).formatHsl()},formatRgb:V,toString:V}),g(R,E,y(b,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new R(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new R(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:j,formatHex:j,formatRgb:N,toString:N})),g(L,(function(e,t,r,i){return 1===arguments.length?X(e):new L(e,t,r,null==i?1:i)}),y(b,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new L(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new L(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*t,n=2*r-i;return new R(Y(e>=240?e-240:e+120,n,i),Y(e,n,i),Y(e<120?e+240:e-120,n,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));var q=function(e){return function(){return e}};function U(e,t){return function(r){return e+r*t}}function $(e){return 1==(e=+e)?Z:function(t,r){return r-t?function(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(i){return Math.pow(e+i*t,r)}}(t,r,e):q(isNaN(t)?r:t)}}function Z(e,t){var r=t-e;return r?U(e,r):q(isNaN(e)?t:e)}var J=function e(t){var r=$(t);function i(e,t){var i=r((e=E(e)).r,(t=E(t)).r),n=r(e.g,t.g),a=r(e.b,t.b),o=Z(e.opacity,t.opacity);return function(t){return e.r=i(t),e.g=n(t),e.b=a(t),e.opacity=o(t),e+""}}return i.gamma=e,i}(1);function K(e){return function(t){var r,i,n=t.length,a=new Array(n),o=new Array(n),l=new Array(n);for(r=0;r<n;++r)i=E(t[r]),a[r]=i.r||0,o[r]=i.g||0,l[r]=i.b||0;return a=e(a),o=e(o),l=e(l),i.opacity=1,function(e){return i.r=a(e),i.g=o(e),i.b=l(e),i+""}}}K((function(e){var t=e.length-1;return function(r){var i=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),n=e[i],a=e[i+1],o=i>0?e[i-1]:2*n-a,l=i<t-1?e[i+2]:2*a-n;return W((r-i/t)*t,o,n,a,l)}})),K((function(e){var t=e.length;return function(r){var i=Math.floor(((r%=1)<0?++r:r)*t),n=e[(i+t-1)%t],a=e[i%t],o=e[(i+1)%t],l=e[(i+2)%t];return W((r-i/t)*t,n,a,o,l)}}));var Q=function(e,t){t||(t=[]);var r,i=e?Math.min(t.length,e.length):0,n=t.slice();return function(a){for(r=0;r<i;++r)n[r]=e[r]*(1-a)+t[r]*a;return n}};function ee(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function te(e,t){var r,i=t?t.length:0,n=e?Math.min(i,e.length):0,a=new Array(n),o=new Array(i);for(r=0;r<n;++r)a[r]=se(e[r],t[r]);for(;r<i;++r)o[r]=t[r];return function(e){for(r=0;r<n;++r)o[r]=a[r](e);return o}}var re=function(e,t){var r=new Date;return e=+e,t=+t,function(i){return r.setTime(e*(1-i)+t*i),r}},ie=function(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}},ne=function(e,t){var r,i={},n={};for(r in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)r in e?i[r]=se(e[r],t[r]):n[r]=t[r];return function(e){for(r in i)n[r]=i[r](e);return n}},ae=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,oe=new RegExp(ae.source,"g");var le=function(e,t){var r,i,n,a=ae.lastIndex=oe.lastIndex=0,o=-1,l=[],s=[];for(e+="",t+="";(r=ae.exec(e))&&(i=oe.exec(t));)(n=i.index)>a&&(n=t.slice(a,n),l[o]?l[o]+=n:l[++o]=n),(r=r[0])===(i=i[0])?l[o]?l[o]+=i:l[++o]=i:(l[++o]=null,s.push({i:o,x:ie(r,i)})),a=oe.lastIndex;return a<t.length&&(n=t.slice(a),l[o]?l[o]+=n:l[++o]=n),l.length<2?s[0]?function(e){return function(t){return e(t)+""}}(s[0].x):function(e){return function(){return e}}(t):(t=s.length,function(e){for(var r,i=0;i<t;++i)l[(r=s[i]).i]=r.x(e);return l.join("")})},se=function(e,t){var r,i=typeof t;return null==t||"boolean"===i?q(t):("number"===i?ie:"string"===i?(r=I(t))?(t=r,J):le:t instanceof I?J:t instanceof Date?re:ee(t)?Q:Array.isArray(t)?te:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?ne:ie)(e,t)},ce=function(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}};function ue(e){return+e}var he=[0,1];function ve(e){return e}function fe(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:(r=isNaN(t)?NaN:.5,function(){return r});var r}function de(e,t,r){var i=e[0],n=e[1],a=t[0],o=t[1];return n<i?(i=fe(n,i),a=r(o,a)):(i=fe(i,n),a=r(a,o)),function(e){return a(i(e))}}function pe(e,t,r){var i=Math.min(e.length,t.length)-1,n=new Array(i),a=new Array(i),o=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<i;)n[o]=fe(e[o],e[o+1]),a[o]=r(t[o],t[o+1]);return function(t){var r=m(e,t,1,i)-1;return a[r](n[r](t))}}function me(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function ge(){var e,t,r,i,n,a,o=he,l=he,s=se,c=ve;function u(){var e,t,r,s=Math.min(o.length,l.length);return c!==ve&&(e=o[0],t=o[s-1],e>t&&(r=e,e=t,t=r),c=function(r){return Math.max(e,Math.min(t,r))}),i=s>2?pe:de,n=a=null,h}function h(t){return null==t||isNaN(t=+t)?r:(n||(n=i(o.map(e),l,s)))(e(c(t)))}return h.invert=function(r){return c(t((a||(a=i(l,o.map(e),ie)))(r)))},h.domain=function(e){return arguments.length?(o=Array.from(e,ue),u()):o.slice()},h.range=function(e){return arguments.length?(l=Array.from(e),u()):l.slice()},h.rangeRound=function(e){return l=Array.from(e),s=ce,u()},h.clamp=function(e){return arguments.length?(c=!!e||ve,u()):c!==ve},h.interpolate=function(e){return arguments.length?(s=e,u()):s},h.unknown=function(e){return arguments.length?(r=e,h):r},function(r,i){return e=r,t=i,u()}}function ye(){return ge()(ve,ve)}function be(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}var xe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function we(e){if(!(t=xe.exec(e)))throw new Error("invalid format: "+e);var t;return new ke({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function ke(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}we.prototype=ke.prototype,ke.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};function Me(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,i=e.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+e.slice(r+1)]}var Ae,Se,De,Te,Oe=function(e){return(e=Me(Math.abs(e)))?e[1]:NaN},Ce=function(e,t){var r=Me(e,t);if(!r)return e+"";var i=r[0],n=r[1];return n<0?"0."+new Array(-n).join("0")+i:i.length>n+1?i.slice(0,n+1)+"."+i.slice(n+1):i+new Array(n-i.length+2).join("0")},_e={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Ce(100*e,t),r:Ce,s:function(e,t){var r=Me(e,t);if(!r)return e+"";var i=r[0],n=r[1],a=n-(Ae=3*Math.max(-8,Math.min(8,Math.floor(n/3))))+1,o=i.length;return a===o?i:a>o?i+new Array(a-o+1).join("0"):a>0?i.slice(0,a)+"."+i.slice(a):"0."+new Array(1-a).join("0")+Me(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)},ze=function(e){return e},Ve=Array.prototype.map,Ie=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];Se=function(e){var t,r,i=void 0===e.grouping||void 0===e.thousands?ze:(t=Ve.call(e.grouping,Number),r=e.thousands+"",function(e,i){for(var n=e.length,a=[],o=0,l=t[0],s=0;n>0&&l>0&&(s+l+1>i&&(l=Math.max(1,i-s)),a.push(e.substring(n-=l,n+l)),!((s+=l+1)>i));)l=t[o=(o+1)%t.length];return a.reverse().join(r)}),n=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",l=void 0===e.numerals?ze:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(Ve.call(e.numerals,String)),s=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"−":e.minus+"",u=void 0===e.nan?"NaN":e.nan+"";function h(e){var t=(e=we(e)).fill,r=e.align,h=e.sign,v=e.symbol,f=e.zero,d=e.width,p=e.comma,m=e.precision,g=e.trim,y=e.type;"n"===y?(p=!0,y="g"):_e[y]||(void 0===m&&(m=12),g=!0,y="g"),(f||"0"===t&&"="===r)&&(f=!0,t="0",r="=");var b="$"===v?n:"#"===v&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",x="$"===v?a:/[%p]/.test(y)?s:"",w=_e[y],k=/[defgprs%]/.test(y);function M(e){var n,a,s,v=b,M=x;if("c"===y)M=w(e)+M,e="";else{var A=(e=+e)<0||1/e<0;if(e=isNaN(e)?u:w(Math.abs(e),m),g&&(e=function(e){e:for(var t,r=e.length,i=1,n=-1;i<r;++i)switch(e[i]){case".":n=t=i;break;case"0":0===n&&(n=i),t=i;break;default:if(!+e[i])break e;n>0&&(n=0)}return n>0?e.slice(0,n)+e.slice(t+1):e}(e)),A&&0==+e&&"+"!==h&&(A=!1),v=(A?"("===h?h:c:"-"===h||"("===h?"":h)+v,M=("s"===y?Ie[8+Ae/3]:"")+M+(A&&"("===h?")":""),k)for(n=-1,a=e.length;++n<a;)if(48>(s=e.charCodeAt(n))||s>57){M=(46===s?o+e.slice(n+1):e.slice(n))+M,e=e.slice(0,n);break}}p&&!f&&(e=i(e,1/0));var S=v.length+e.length+M.length,D=S<d?new Array(d-S+1).join(t):"";switch(p&&f&&(e=i(D+e,D.length?d-M.length:1/0),D=""),r){case"<":e=v+e+M+D;break;case"=":e=v+D+e+M;break;case"^":e=D.slice(0,S=D.length>>1)+v+e+M+D.slice(S);break;default:e=D+v+e+M}return l(e)}return m=void 0===m?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),M.toString=function(){return e+""},M}return{format:h,formatPrefix:function(e,t){var r=h(((e=we(e)).type="f",e)),i=3*Math.max(-8,Math.min(8,Math.floor(Oe(t)/3))),n=Math.pow(10,-i),a=Ie[8+i/3];return function(e){return r(n*e)+a}}}}({thousands:",",grouping:[3],currency:["$",""]}),De=Se.format,Te=Se.formatPrefix;function Fe(e,t,r,i){var n,a=function(e,t,r){r=+r;const i=(t=+t)<(e=+e),n=i?c(t,e,r):c(e,t,r);return(i?-1:1)*(n<0?1/-n:n)}(e,t,r);switch((i=we(null==i?",f":i)).type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null!=i.precision||isNaN(n=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Oe(t)/3)))-Oe(Math.abs(e)))}(a,o))||(i.precision=n),Te(i,o);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(n=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Oe(t)-Oe(e))+1}(a,Math.max(Math.abs(e),Math.abs(t))))||(i.precision=n-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(n=function(e){return Math.max(0,-Oe(Math.abs(e)))}(a))||(i.precision=n-2*("%"===i.type))}return De(i)}function Pe(e){var t=e.domain;return e.ticks=function(e){var r=t();return function(e,t,r){if(!((r=+r)>0))return[];if((e=+e)===(t=+t))return[e];const i=t<e,[n,a,o]=i?s(t,e,r):s(e,t,r);if(!(a>=n))return[];const l=a-n+1,c=new Array(l);if(i)if(o<0)for(let e=0;e<l;++e)c[e]=(a-e)/-o;else for(let e=0;e<l;++e)c[e]=(a-e)*o;else if(o<0)for(let e=0;e<l;++e)c[e]=(n+e)/-o;else for(let e=0;e<l;++e)c[e]=(n+e)*o;return c}(r[0],r[r.length-1],null==e?10:e)},e.tickFormat=function(e,r){var i=t();return Fe(i[0],i[i.length-1],null==e?10:e,r)},e.nice=function(r){null==r&&(r=10);var i,n,a=t(),o=0,l=a.length-1,s=a[o],u=a[l],h=10;for(u<s&&(n=s,s=u,u=n,n=o,o=l,l=n);h-- >0;){if((n=c(s,u,r))===i)return a[o]=s,a[l]=u,t(a);if(n>0)s=Math.floor(s/n)*n,u=Math.ceil(u/n)*n;else{if(!(n<0))break;s=Math.ceil(s*n)/n,u=Math.floor(u*n)/n}i=n}return e},e}function Be(){var e=ye();return e.copy=function(){return me(e,Be())},be.apply(e,arguments),Pe(e)}class Ee extends Map{constructor(e,t=He){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),null!=e)for(const[t,r]of e)this.set(t,r)}get(e){return super.get(Re(this,e))}has(e){return super.has(Re(this,e))}set(e,t){return super.set(je(this,e),t)}delete(e){return super.delete(Ne(this,e))}}Set;function Re({_intern:e,_key:t},r){const i=t(r);return e.has(i)?e.get(i):r}function je({_intern:e,_key:t},r){const i=t(r);return e.has(i)?e.get(i):(e.set(i,r),r)}function Ne({_intern:e,_key:t},r){const i=t(r);return e.has(i)&&(r=e.get(r),e.delete(i)),r}function He(e){return null!==e&&"object"==typeof e?e.valueOf():e}const Ge=Symbol("implicit");function Xe(){var e=new Ee,t=[],r=[],i=Ge;function n(n){let a=e.get(n);if(void 0===a){if(i!==Ge)return i;e.set(n,a=t.push(n)-1)}return r[a%r.length]}return n.domain=function(r){if(!arguments.length)return t.slice();t=[],e=new Ee;for(const i of r)e.has(i)||e.set(i,t.push(i)-1);return n},n.range=function(e){return arguments.length?(r=Array.from(e),n):r.slice()},n.unknown=function(e){return arguments.length?(i=e,n):i},n.copy=function(){return Xe(t,r).unknown(i)},be.apply(n,arguments),n}var Le=function(e){for(var t=e.length/6|0,r=new Array(t),i=0;i<t;)r[i]="#"+e.slice(6*i,6*++i);return r}("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),Ye=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],i=!0,n=!1,a=void 0;try{for(var o,l=e[Symbol.iterator]();!(i=(o=l.next()).done)&&(r.push(o.value),!t||r.length!==t);i=!0);}catch(e){n=!0,a=e}finally{try{!i&&l.return&&l.return()}finally{if(n)throw a}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},We=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),qe=function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,i)}if("value"in n)return n.value;var o=n.get;return void 0!==o?o.call(i):void 0};function Ue(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $e(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Ze(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Je=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];if(!new.target)throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');var n=e.services,a=n.tileProxy,o=n.pixiRenderer,l=e.utils,s=l.colorToHex,c=l.absToChr,u=function(t){function r(e,t){Ue(this,r);var i=$e(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t));return i.initializeStackedBarTrack(),i}return Ze(r,t),We(r,[{key:"initializeStackedBarTrack",value:function(){this.stackedBarTrackInitialized||(this.maxAndMin={max:null,min:null},this.textureGraphics=new e.libraries.PIXI.Graphics,this.stackedBarTrackInitialized=!0)}},{key:"createColorScale",value:function(){if(!this.options.colorScale)if(this.tilesetInfo.row_infos&&this.tilesetInfo.row_infos[0].color)this.options.colorScale=this.tilesetInfo.row_infos.map((function(e){return e.color}));else{this.options.colorScale=["#FF0000","#FF4500","#32CD32","#008000","#006400","#C2E105","#FFFF00","#66CDAA","#8A91D0","#CD5C5C","#E9967A","#BDB76B","#808080","#C0C0C0","#FFFFFF"]}}},{key:"initTile",value:function(e){if(this.createColorScale(),this.initializeStackedBarTrack(),this.scale.minRawValue=this.minVisibleValue(),this.scale.maxRawValue=this.maxVisibleValue(),this.scale.minValue=this.scale.minRawValue,this.scale.maxValue=this.scale.maxRawValue,this.options.globalMinMax)this.maxAndMin.min=this.options.globalMinMax.min,this.maxAndMin.max=this.options.globalMinMax.max;else if(this.maxAndMin.min=this.minValueInArray(e.tileData.dense),this.maxAndMin.max=this.maxValueInArray(e.tileData.dense),this.isValueScaleLocked()){var t=this.getLockGroupExtrema();null!==t&&(this.maxAndMin.min=1.05*t[0],this.maxAndMin.max=1.05*t[1])}this.numCategories=this.options.selectRows?this.options.selectRows.length:e.tileData.shape[0],this.localColorToHexScale(),this.unFlatten(e),this.renderTile(e),this.rescaleTiles(),this.rescaleTiles()}},{key:"destroyTile",value:function(e){e.sprite.destroy(!0),e.graphics.destroy(!0),e.graphics=null,e.sprite=null}},{key:"rerender",value:function(e){qe(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"rerender",this).call(this,e),this.options=e;for(var t=this.visibleAndFetchedTiles(),i=0;i<t.length;i++){var n=t[i];n.matrix=null,this.updateTile(n)}for(var a=0;a<t.length;a++){var o=t[a];this.renderTile(o)}this.rescaleTiles(),this.rescaleTiles(),this.draw()}},{key:"updateTile",value:function(){for(var e=this.visibleAndFetchedTiles(),t=0;t<e.length;t++){var r=e[t];this.unFlatten(r)}if(this.isValueScaleLocked()){var i=this.getLockGroupExtrema();null!==i&&(this.maxAndMin.min=1.05*i[0],this.maxAndMin.max=1.05*i[1]),this.rescaleTiles()}this.rescaleTiles()}},{key:"drawTile",value:function(e){}},{key:"renderTile",value:function(e){e.svgData=null,e.mouseOverData=null;var t=e.graphics;t.clear(),t.children.map((function(e){t.removeChild(e)})),e.drawnAtScale=this._xScale.copy();var r=this.getTilePosAndDimensions(e.tileData.zoomLevel,e.tileData.tilePos,this.tilesetInfo.tile_size),i=r.tileX,n=r.tileWidth,a=this.unFlatten(e);this.oldDimensions=this.dimensions;try{this.drawVerticalBars(this.mapOriginalColors(a),i,n,this.maxAndMin.max,this.maxAndMin.min,e),t.addChild(e.sprite),this.makeMouseOverData(e)}catch(e){}}},{key:"syncMaxAndMin",value:function(){var e=this,t=this.visibleAndFetchedTiles();this.maxAndMin.min=0,this.maxAndMin.max=0,t.map((function(t){t.minValue+t.maxValue>e.maxAndMin.min+e.maxAndMin.max&&(e.maxAndMin.min=t.minValue,e.maxAndMin.max=t.maxValue)}))}},{key:"rescaleTiles",value:function(){var e=this,t=this.visibleAndFetchedTiles();if(this.options.globalMinMax)this.maxAndMin.min=this.options.globalMinMax.min,this.maxAndMin.max=this.options.globalMinMax.max;else if(this.isValueScaleLocked()){var r=this.getLockGroupExtrema();null!==r&&(this.maxAndMin.min=1.05*r[0],this.maxAndMin.max=1.05*r[1])}else this.syncMaxAndMin();if(!0===this.options.symmetricRange){var i=Math.max(Math.abs(this.maxAndMin.min),this.maxAndMin.max);i+=.01*i,this.maxAndMin.min=-i,this.maxAndMin.max=i}t.map((function(t){var r=Be().domain([0,e.maxAndMin.max+Math.abs(e.maxAndMin.min)]).range([0,e.dimensions[1]]),i=e.dimensions[1]-r(Math.abs(e.maxAndMin.min)),n=r(t.minValue+t.maxValue),a=t.sprite,o=i-r(t.maxValue);a&&(a.height=n,a.y=o)}))}},{key:"localColorToHexScale",value:function(){for(var e=this.options.colorScale||Xe(Le),t={},r=0;r<e.length;r++)t[e[r]]=s(e[r]);this.colorHexMap=t}},{key:"findMaxAndMin",value:function(e){for(var t={max:null,min:null},r=0;r<e.length;r++){var i=e[r],n=i.filter((function(e){return e>=0})).reduce((function(e,t){return e+t}),0);n>t.max&&(t.max=n);var a=i.filter((function(e){return e<=0}));if(a.length>0){var o=(a=a.map((function(e){return Math.abs(e)}))).reduce((function(e,t){return e+t}),0);(null===t.min||o>t.min)&&(t.min=o)}}return t}},{key:"unFlatten",value:function(e){if(e.matrix)return e.matrix;var t=e.tileData.dense;t.filter((function(e){return e<0})).length>0&&"linear"===this.options.valueScaling&&(console.warn("Negative values present in data. Defaulting to exponential scale."),this.options.valueScaling="exponential");var r=this.simpleUnFlatten(e,t),i=this.findMaxAndMin(r);return e.matrix=r,e.maxValue=i.max,e.minValue=i.min,this.syncMaxAndMin(),r}},{key:"simpleUnFlatten",value:function(e,t){for(var r=this,i=this.numCategories,n=e.tileData.shape[1],a=[],o=0;o<i;o++)for(var l=function(e){var i=void 0;if(i=void 0===a[e]?[]:a[e],r.options.selectRows){var l=r.options.selectRows[o];if(Array.isArray(l)){var s=l.reduce((function(r,i){return r+t[n*i+e]}),0);i.push(s)}else i.push(t[n*l+e])}else i.push(t[n*o+e]);a[e]=i},s=0;s<n;s++)l(s);return"log"===this.options.valueScaling&&function(){for(var e=null==r.options.pseudocount?1:r.options.pseudocount,t=function(t){var r=a[t].map((function(t){return t+e})),i=r.reduce((function(e,t){return e+t}),0),n=r.map((function(e){return Math.log(e)})),o=n.reduce((function(e,t){return e+t}),0),l=Math.log(i),s=n.map((function(e){return e/o*l}));a[t]=s},i=0;i<n;i++)t(i)}(),a}},{key:"mapOriginalColors",value:function(e){for(var t=this.options.colorScale||Xe(Le),r=[],i=0;i<e.length;i++){for(var n=[],a=0;a<e[i].length;a++)n[a]={value:isNaN(e[i][a])?0:e[i][a],color:t[a]};for(var o=[],l=[],s=0;s<n.length;s++)n[s].value>=0?o.push(n[s]):n[s].value<0&&l.push(n[s]);this.options.sortLargestOnTop?(o.sort((function(e,t){return e.value-t.value})),l.sort((function(e,t){return t.value-e.value}))):(o.sort((function(e,t){return t.value-e.value})),l.sort((function(e,t){return e.value-t.value}))),r.push([o,l])}return r}},{key:"drawVerticalBars",value:function(t,r,i,n,a,l){var s=new e.libraries.PIXI.Graphics,c=this.dimensions[1],u=n+Math.abs(a),h=n*c/u,v=Math.abs(a)*c/u,f=this.dimensions[1];this.drawBackground(t,s),this.options.barBorder&&s.lineStyle(1,0,1);for(var d=0;d<t.length;d++){var p=10*d;0===d&&p;for(var m=t[d][0],g=Be().domain([0,n]).range([0,h]),y=0,b=0;b<m.length;b++){var x=g(m[b].value),w=h-(y+x);this.addSVGInfo(l,p,w,10,x,m[b].color),s.beginFill(this.colorHexMap[m[b].color]),s.drawRect(p,w,10,x),y+=x,f>w&&(f=w)}if(Math.abs(a)>0)for(var k=t[d][1],M=Be().domain([-Math.abs(a),0]).range([v,0]),A=0,S=0;S<k.length;S++){var D=M(k[S].value),T=h+A;this.addSVGInfo(l,p,T,10,D,k[S].color),s.beginFill(this.colorHexMap[k[S].color]),s.drawRect(p,T,10,D),A+=D}}try{var O=o.generateTexture(s,e.libraries.PIXI.SCALE_MODES.NEAREST),C=new e.libraries.PIXI.Sprite(O);C.width=this._xScale(r+i)-this._xScale(r),C.x=this._xScale(r),l.sprite=C,l.lowestY=f}catch(e){}}},{key:"draw",value:function(){qe(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"draw",this).call(this)}},{key:"addSVGInfo",value:function(e,t,r,i,n,a){e.hasOwnProperty("svgData")&&null!==e.svgData?(e.svgData.barXValues.push(t),e.svgData.barYValues.push(r),e.svgData.barWidths.push(i),e.svgData.barHeights.push(n),e.svgData.barColors.push(a)):e.svgData={barXValues:[t],barYValues:[r],barWidths:[i],barHeights:[n],barColors:[a]}}},{key:"setDimensions",value:function(e){var t=this;this.oldDimensions=this.dimensions,qe(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"setDimensions",this).call(this,e),this.visibleAndFetchedTiles().map((function(e){return t.initTile(e)}))}},{key:"minValueInArray",value:function(e){for(var t=e[0],r=1;r<e.length;r++){var i=e[r];t=i<t?i:t}return t}},{key:"maxValueInArray",value:function(e){for(var t=e[0],r=1;r<e.length;r++){var i=e[r];t=i>t?i:t}return t}},{key:"makeMouseOverData",value:function(e){for(var t=this.numCategories,r=e.tileData.shape[1],i=e.svgData.barYValues,n=e.svgData.barHeights,a=e.svgData.barColors,o=[],l=0;l<t;l++)for(var s=0;s<r;s++){var c=s*t+l,u={y:i[c],height:n[c],color:a[c]};void 0===o[s]?o[s]=[u]:o[s].push(u)}for(var h=0;h<o.length;h++)o[h]=o[h].sort((function(e,t){return e.y-t.y}));e.mouseOverData=o}},{key:"exportSVG",value:function(){var e=this;this.visibleAndFetchedTiles().map((function(t){e.initTile(t),e.draw()}));var t=null,i=null;t=i=document.createElement("g");var n=qe(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"superSVG",this).call(this),a=Ye(n,2);i=a[0],t=a[1];var o=document.createElement("g");t.appendChild(o),o.setAttribute("transform","translate("+this.pMain.position.x+","+this.pMain.position.y+") scale("+this.pMain.scale.x+","+this.pMain.scale.y+")");var l=!0,s=!1,c=void 0;try{for(var u,h=this.visibleAndFetchedTiles()[Symbol.iterator]();!(l=(u=h.next()).done);l=!0){var v=u.value,f=document.createElement("g");f.setAttribute("transform"," translate("+v.sprite.x+","+v.sprite.y+") rotate(0) scale("+v.sprite.scale.x+","+v.sprite.scale.y+") ");for(var d=v.svgData,p=0;p<d.barXValues.length;p++){var m=document.createElement("rect");m.setAttribute("fill",d.barColors[p]),m.setAttribute("stroke",d.barColors[p]),m.setAttribute("x",d.barXValues[p]),m.setAttribute("y",d.barYValues[p]-v.lowestY),m.setAttribute("height",d.barHeights[p]),m.setAttribute("width",d.barWidths[p]),this.options.barBorder&&(m.setAttribute("stroke-width","0.1"),m.setAttribute("stroke","black")),f.appendChild(m)}o.appendChild(f)}}catch(e){s=!0,c=e}finally{try{!l&&h.return&&h.return()}finally{if(s)throw c}}return[i,i]}},{key:"getMouseOverHtml",value:function(e,t){if(!this.tilesetInfo)return"";var r=this.options.colorScale||Xe(Le),i=this.calculateZoomLevel(),n=a.calculateTileWidth(this.tilesetInfo,i,this.tilesetInfo.tile_size),o=this._xScale.invert(e)/n,l=Math.floor(this.tilesetInfo.tile_size*(o-Math.floor(o))),s=this.tileToLocalId([i,Math.floor(o)]),u=this.fetchedTiles[s];if(!u)return"";for(var h=u.matrix[l],v=u.mouseOverData[l],f=(t-u.sprite.y)/u.sprite.scale.y+u.lowestY,d={},p=0;p<r.length;p++)d[r[p]]=p;if(f<v[0].y||f>=v[v.length-1].y+v[v.length-1].height)return"";for(var m=0;m<v.length;m++){var g=v[m].y,y=v[m].height;if(f>g&&f<=g+y){var b=v[m].color,x=Number.parseFloat(h[d[b]]).toPrecision(4).toString(),w=this.tilesetInfo.row_infos[d[b]],k=this._xScale.invert(e),M=null;if(this.options.chromInfo&&this.options.binSize){var A=c(k,this.options.chromInfo);M=A[0]+":"+(Math.ceil(A[1]/this.options.binSize)*this.options.binSize-this.options.binSize)}var S='<div class="track-mouseover-menu-table">';return M&&(S+='\n              <div class="track-mouseover-menu-table-item">\n                <label for="position" class="track-mouseover-menu-table-item-label">Position</label>\n                <div name="position" class="track-mouseover-menu-table-item-value">'+M+"</div>\n              </div>\n              "),S+='<div class="track-mouseover-menu-table-item">\n              <label for="binScore" class="track-mouseover-menu-table-item-label">Score</label>\n              <div name="binScore" class="track-mouseover-menu-table-item-value">'+x+"</div>\n            </div>",S+='\n              <div class="track-mouseover-menu-table-item">\n                <label for="stateName" class="track-mouseover-menu-table-item-label">Chromatin state</label>\n                <div name="stateName" class="track-mouseover-menu-table-item-value">'+('<svg width="10" height="10" style="position:relative; top:-2px;"><rect width="10" height="10" rx="2" ry="2" style="fill:'+b+';stroke:black;stroke-width:2;"></svg> '+w)+"</div>\n              </div>",S+="</div>"}}}}]),r}(e.tracks.BarTrack);return new(Function.prototype.bind.apply(u,[null].concat(r)))};Je.config={type:"horizontal-stacked-bar",datatype:["multivec","epilogos"],local:!1,orientation:"1d-horizontal",thumbnail:(new DOMParser).parseFromString('<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 5640 5420" preserveAspectRatio="xMidYMid meet"> <g id="layer101" fill="#000000" stroke="none"> <path d="M0 2710 l0 -2710 2820 0 2820 0 0 2710 0 2710 -2820 0 -2820 0 0 -2710z"/> </g> <g id="layer102" fill="#750075" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> <path d="M4340 2710 l0 -2510 560 0 560 0 0 2510 0 2510 -560 0 -560 0 0 -2510z"/> <path d="M200 1870 l0 -1670 630 0 630 0 0 1670 0 1670 -630 0 -630 0 0 -1670z"/> <path d="M1660 1810 l0 -1610 570 0 570 0 0 1610 0 1610 -570 0 -570 0 0 -1610z"/> <path d="M3000 840 l0 -640 570 0 570 0 0 640 0 640 -570 0 -570 0 0 -640z"/> </g> <g id="layer103" fill="#ffff04" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> </g> </svg>',"text/xml").documentElement,availableOptions:["labelPosition","labelColor","valueScaling","labelTextOpacity","labelBackgroundOpacity","trackBorderWidth","trackBorderColor","trackType","scaledHeight","backgroundColor","colorScale","barBorder","sortLargestOnTop","selectRows"],defaultOptions:{labelPosition:"topLeft",labelColor:"black",labelTextOpacity:.4,valueScaling:"linear",trackBorderWidth:0,trackBorderColor:"black",backgroundColor:"white",barBorder:!0,sortLargestOnTop:!0,selectRows:null},otherOptions:{epilogos:{scaledHeight:!1}}};var Ke=Je,Qe=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],i=!0,n=!1,a=void 0;try{for(var o,l=e[Symbol.iterator]();!(i=(o=l.next()).done)&&(r.push(o.value),!t||r.length!==t);i=!0);}catch(e){n=!0,a=e}finally{try{!i&&l.return&&l.return()}finally{if(n)throw a}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},et=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),tt=function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,i)}if("value"in n)return n.value;var o=n.get;return void 0!==o?o.call(i):void 0};function rt(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function it(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function nt(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function at(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var ot=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];if(!new.target)throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');var n=e.services,a=n.tileProxy,o=n.pixiRenderer,l=e.utils,s=l.absToChr,c=l.colorToHex,u=function(t){function r(e,t){it(this,r);var i=nt(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t));return i.initializeStackedDeltaBarTrack(),i}return at(r,t),et(r,[{key:"initializeStackedDeltaBarTrack",value:function(){this.stackedDeltaBarTrackInitialized||(this.maxAndMin={max:null,min:null},this.textureGraphics=new e.libraries.PIXI.Graphics,this.stackedDeltaBarTrackInitialized=!0)}},{key:"createColorScale",value:function(){if(!this.options.colorScale)if(this.tilesetInfo.row_infos&&this.tilesetInfo.row_infos[0].color)this.options.colorScale=this.tilesetInfo.row_infos.map((function(e){return e.color}));else{this.options.colorScale=["#FF0000","#FF4500","#32CD32","#008000","#006400","#C2E105","#FFFF00","#66CDAA","#8A91D0","#CD5C5C","#E9967A","#BDB76B","#808080","#C0C0C0","#FFFFFF"]}}},{key:"initTile",value:function(e){this.createColorScale(),this.initializeStackedDeltaBarTrack(),this.scale.minRawValue=this.minVisibleValue(),this.scale.maxRawValue=this.maxVisibleValue(),this.scale.minValue=this.scale.minRawValue,this.scale.maxValue=this.scale.maxRawValue,this.maxAndMin.min=this.minValueInArray(e.tileData.dense),this.maxAndMin.max=this.maxValueInArray(e.tileData.dense),this.numCategories=e.tileData.shape[0],this.localColorToHexScale(),this.unFlatten(e),this.renderTile(e),this.rescaleTiles()}},{key:"destroyTile",value:function(e){e.sprite.destroy(!0),e.graphics.destroy(!0),e.graphics=null,e.sprite=null}},{key:"rerender",value:function(e){tt(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"rerender",this).call(this,e),this.options=e;for(var t=this.visibleAndFetchedTiles(),i=0;i<t.length;i++)this.updateTile(t[i]);this.rescaleTiles(),this.draw()}},{key:"updateTile",value:function(){for(var e=this.visibleAndFetchedTiles(),t=0;t<e.length;t++){var r=e[t];this.unFlatten(r)}this.rescaleTiles()}},{key:"drawTile",value:function(e){}},{key:"renderTile",value:function(e){e.svgData=null,e.mouseOverData=null;var t=e.graphics;t.clear(),t.children.map((function(e){t.removeChild(e)})),e.drawnAtScale=this._xScale.copy();var r=this.getTilePosAndDimensions(e.tileData.zoomLevel,e.tileData.tilePos,this.tilesetInfo.tile_size),i=r.tileX,n=r.tileWidth,a=this.unFlatten(e);this.oldDimensions=this.dimensions;try{this.drawVerticalBars(this.mapOriginalColors(a),i,n,this.maxAndMin.max,this.maxAndMin.min,e),t.addChild(e.sprite),this.makeMouseOverData(e)}catch(t){console.log("StackedDeltaBarChart -> renderTile("+e.tileId+") TypeError")}}},{key:"syncMaxAndMin",value:function(){var e=this,t=this.visibleAndFetchedTiles();this.maxAndMin.min=0,this.maxAndMin.max=0,t.map((function(t){t.minValue+t.maxValue>e.maxAndMin.min+e.maxAndMin.max&&(e.maxAndMin.min=t.minValue,e.maxAndMin.max=t.maxValue)}))}},{key:"rescaleTiles",value:function(){var e=this,t=this.visibleAndFetchedTiles();this.syncMaxAndMin(),t.map((function(t){var r=Be().domain([0,e.maxAndMin.max+Math.abs(e.maxAndMin.min)]).range([0,e.dimensions[1]]),i=e.dimensions[1]-r(Math.abs(e.maxAndMin.min)),n=r(t.minValue+t.maxValue),a=t.sprite,o=i-r(t.maxValue);a&&(a.height=n,a.y=o)}))}},{key:"localColorToHexScale",value:function(){for(var e=this.options.colorScale||Xe(schemeCategory10),t={},r=0;r<e.length;r++)t[e[r]]=c(e[r]),this.options.hideColorByIndex&&r===this.options.hideColorByIndex&&(t[e[r]]=c("#ffffff"));this.colorHexMap=t}},{key:"findMaxAndMin",value:function(e){for(var t={max:null,min:null},r=0;r<e.length;r++){var i=e[r],n=i.filter((function(e){return e>=0})).reduce((function(e,t){return e+t}),0);n>t.max&&(t.max=n);var a=i.filter((function(e){return e<=0}));if(a.length>0){var o=(a=a.map((function(e){return Math.abs(e)}))).reduce((function(e,t){return e+t}),0);(null===t.min||o>t.min)&&(t.min=o)}}return t}},{key:"unFlatten",value:function(e){if(e.matrix)return e.matrix;var t=e.tileData.dense;t.filter((function(e){return e<0})).length>0&&"linear"===this.options.valueScaling&&(console.warn("Negative values present in data. Defaulting to exponential scale."),this.options.valueScaling="exponential");var r=this.simpleUnFlatten(e,t),i=this.findMaxAndMin(r.matrix);return e.sortedIdxs=r.idxs,e.matrix=r.matrix,e.maxValue=i.max,e.minValue=i.min,this.syncMaxAndMin(),r.matrix}},{key:"simpleUnFlatten",value:function(e,t){for(var r=this,i=this.numCategories,n=e.tileData.shape[1],a=[],o=[],l=0;l<i;l++)for(var s=function(e){var i=void 0;if(i=void 0===a[e]?[]:a[e],r.options.selectRows){var o=r.options.selectRows[l];if(Array.isArray(o)){var s=o.reduce((function(r,i){return r+t[n*i+e]}),0);i.push(s)}else i.push(t[n*o+e])}else i.push(t[n*l+e]);a[e]=i},c=0;c<n;c++)s(c);for(var u=-1,h=0;h<n;h++){for(var v=0;v<i;v++)u<a[h][v]&&(u=a[h][v]);o[h]=this.remapVectorToSortedIndices(a[h]),a[h]=this.remapVectorToStateSortedDeltas(a[h])}return{idxs:o,matrix:a}}},{key:"remapVectorToSortedIndices",value:function(e){var t=e.length-1;Array(t+1);return[].concat(rt(e)).map((function(e,t){return{i:t,d:e}})).sort((function(e,t){return e.d>t.d?1:-1})).map((function(e){return e.i}))}},{key:"remapVectorToStateSortedDeltas",value:function(e){var t=0,r=e.length-1,i=Array(r+1),n=[].concat(rt(i.keys())).sort((function(t,r){return e[t]-e[r]}));for(i[n[t]]=e[n[t]];t++<r;)i[n[t]]=e[n[t]]-e[n[t-1]];return i}},{key:"remapVectorToStateDeltas",value:function(e){var t=[].concat(rt(Array(e.length).keys()));t.sort((function(t,r){return e[t]<e[r]?-1:e[t]>e[r]?1:0}));var r=[];t.forEach((function(i,n){return r.push({i:t[n],d:e[t[n]]})}));var i=new Array(e.length);i[0]=r[0];for(var n=1;n<e.length;++n)i[n]={i:r[n].i,d:r[n].d-r[n-1].d};return i}},{key:"sortStateDeltasByState",value:function(e){var t=[].concat(rt(e));return t.sort((function(e,t){return e.i>t.i?1:-1})),t}},{key:"sortStateDeltasByValue",value:function(e){var t=[].concat(rt(e));return t.sort((function(e,t){return e.d>t.d?1:-1})),t}},{key:"remapVectorToUndiffedStateDeltas",value:function(e){var t=[].concat(rt(Array(e.length).keys()));t.sort((function(t,r){return e[t]<e[r]?-1:e[t]>e[r]?1:0}));var r=[];return t.forEach((function(i,n){return r.push({i:t[n],d:e[t[n]]})})),r}},{key:"accumulateStateDeltasUpToState",value:function(e,t){for(var r=0,i=0;i<e.length;i++){var n=e[i];if(r+=n.d,n.i===t)break}return r}},{key:"mapOriginalColors",value:function(e){for(var t=this.options.colorScale||Xe(schemeCategory10),r=[],i=0;i<e.length;i++){for(var n=[],a=0;a<e[i].length;a++)n[a]={value:isNaN(e[i][a])?0:e[i][a],color:t[a]};for(var o=[],l=[],s=0;s<n.length;s++)n[s].value>=0?o.push(n[s]):n[s].value<0&&l.push(n[s]);r.push([o,l])}return r}},{key:"drawVerticalBars",value:function(t,r,i,n,a,l){if(l&&t){this.textureGraphics.clear();var s=this.dimensions[1],c=n+Math.abs(a),u=n*s/c,h=(Math.abs(a),this.dimensions[1]);this.drawBackground(t,this.textureGraphics),this.options.barBorder&&this.textureGraphics.lineStyle(1,0,1);for(var v=this.options.fillOpacityMin?this.options.fillOpacityMin:.1,f=this.options.fillOpacityMax?this.options.fillOpacityMax:1,d=Be().domain([0,this.numCategories-1]).range([f,v]),p=0;p<t.length;p++){var m=10*p;0===p&&m;for(var g=t[p][0],y=Be().domain([0,n]).range([0,u]),b=0,x=l.sortedIdxs[p],w=y(g.reduce((function(e,t){return e+parseFloat(t.value)}),0)),k=0;k<g.length;k++){var M=x[k],A=y(g[M].value),S=u-(b+A);this.addSVGInfo(l,m,S,10,A,g[M].color);var D=x[g.length-1-k],T=y(g[D].value),O=w,C=u-O,_=this.options.fillOpacityMin?parseFloat(d(k)):1;this.textureGraphics.beginFill(this.colorHexMap[g[D].color],_),this.textureGraphics.drawRect(m,C,10,O),w-=T,b+=A,h>C&&(h=C)}}try{var z=o.generateTexture(this.textureGraphics,e.libraries.PIXI.SCALE_MODES.NEAREST),V=new e.libraries.PIXI.Sprite(z);V.width=this._xScale(r+i)-this._xScale(r),V.x=this._xScale(r),l.sprite=V,l.lowestY=h}catch(e){console.log("StackedDeltaBarChart -> drawVerticalBars("+l.tileId+") TypeError")}}}},{key:"addSVGInfo",value:function(e,t,r,i,n,a){e.hasOwnProperty("svgData")&&null!==e.svgData?(e.svgData.barXValues.push(t),e.svgData.barYValues.push(r),e.svgData.barWidths.push(i),e.svgData.barHeights.push(n),e.svgData.barColors.push(a)):e.svgData={barXValues:[t],barYValues:[r],barWidths:[i],barHeights:[n],barColors:[a]}}},{key:"setDimensions",value:function(e){var t=this;this.oldDimensions=this.dimensions,tt(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"setDimensions",this).call(this,e),this.visibleAndFetchedTiles().map((function(e){return t.initTile(e)}))}},{key:"minValueInArray",value:function(e){for(var t=e[0],r=1;r<e.length;r++){var i=e[r];t=i<t?i:t}return t}},{key:"maxValueInArray",value:function(e){for(var t=e[0],r=1;r<e.length;r++){var i=e[r];t=i>t?i:t}return t}},{key:"makeMouseOverData",value:function(e){for(var t=this.numCategories,r=e.tileData.shape[1],i=e.svgData.barYValues,n=e.svgData.barHeights,a=e.svgData.barColors,o=[],l=0;l<t;l++)for(var s=0;s<r;s++){var c=s*t+l,u={y:i[c],height:n[c],color:a[c]};void 0===o[s]?o[s]=[u]:o[s].push(u)}for(var h=0;h<o.length;h++)o[h]=o[h].sort((function(e,t){return e.y-t.y}));e.mouseOverData=o}},{key:"exportSVG",value:function(){var e=this;this.visibleAndFetchedTiles().map((function(t){e.initTile(t),e.draw()}));var t=null,i=null;t=i=document.createElement("g");var n=tt(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"superSVG",this).call(this),a=Qe(n,2);i=a[0],t=a[1];var o=document.createElement("g");t.appendChild(o),o.setAttribute("transform","translate("+this.pMain.position.x+","+this.pMain.position.y+") scale("+this.pMain.scale.x+","+this.pMain.scale.y+")");var l=!0,s=!1,c=void 0;try{for(var u,h=this.visibleAndFetchedTiles()[Symbol.iterator]();!(l=(u=h.next()).done);l=!0){var v=u.value,f=document.createElement("g");f.setAttribute("transform"," translate("+v.sprite.x+","+v.sprite.y+") rotate(0) scale("+v.sprite.scale.x+","+v.sprite.scale.y+") ");for(var d=v.svgData,p=0;p<d.barXValues.length;p++){var m=document.createElement("rect");m.setAttribute("fill",d.barColors[p]),m.setAttribute("stroke",d.barColors[p]),m.setAttribute("x",d.barXValues[p]),m.setAttribute("y",d.barYValues[p]-v.lowestY),m.setAttribute("height",d.barHeights[p]),m.setAttribute("width",d.barWidths[p]),this.options.barBorder&&(m.setAttribute("stroke-width","0.1"),m.setAttribute("stroke","black")),f.appendChild(m)}o.appendChild(f)}}catch(e){s=!0,c=e}finally{try{!l&&h.return&&h.return()}finally{if(s)throw c}}return[i,i]}},{key:"getMouseOverHtml",value:function(e,t){var r=this;if(!this.tilesetInfo)return"";var i=this.options.colorScale||Xe(schemeCategory10),n=this.calculateZoomLevel(),o=a.calculateTileWidth(this.tilesetInfo,n,this.tilesetInfo.tile_size),l=this._xScale.invert(e)/o,c=Math.floor(this.tilesetInfo.tile_size*(l-Math.floor(l))),u=this.tileToLocalId([n,Math.floor(l)]),h=this.fetchedTiles[u];if(!h)return"";for(var v=h.matrix[c],f=h.sortedIdxs[c],d=h.mouseOverData[c],p=(t-h.sprite.y)/h.sprite.scale.y+h.lowestY,m={},g=0;g<i.length;g++)m[i[g]]=g;if(p<d[0].y||p>=d[d.length-1].y+d[d.length-1].height)return"";for(var y=0;y<d.length;y++){var b=d[y].y,x=d[y].height;if(p>b&&p<=b+x){var w=d[y].color;if("#ffffff"===w)return"";var k=Number.parseFloat(v[m[w]]).toPrecision(4).toString(),M=void 0;if(this.options.selectRows){var A=this.options.selectRows[m[w]];if(Array.isArray(A)){var S=A.map((function(e){return r.tilesetInfo.row_infos[e].name||r.tilesetInfo.row_infos[e]}));M=S.join(", ")}else{var D=this.tilesetInfo.row_infos[A];M=D.name||D}}else!function(){var e=m[w],t=r.tilesetInfo.row_infos[e],i=r.remapVectorToUndiffedStateDeltas(v);M=t.name||t;var n=!0,a=[];f.forEach((function(t){n&&a.push(t),t===e&&(n=!1)}));var o=a.map((function(e){return i.filter((function(t){return t.i===e}))})).map((function(e){return e[0].d})).reduce((function(e,t){return e+t}),0);k=Number.parseFloat(o).toPrecision(4).toString()}();var T='<svg width="10" height="10"><rect width="10" height="10" rx="2" ry="2" style="fill:'+w+';stroke:black;stroke-width:2;"></svg> '+M,O=this._xScale.invert(e),C=null;if(this.options.chromInfo&&this.options.binSize){var _=s(O,this.options.chromInfo);C=_[0]+":"+(Math.ceil(_[1]/this.options.binSize)*this.options.binSize-this.options.binSize)}var z="";return z+='<div class="track-mouseover-menu-table">',C&&(z+='\n              <div class="track-mouseover-menu-table-item">\n                <label for="position" class="track-mouseover-menu-table-item-label">Position</label>\n                <div name="position" class="track-mouseover-menu-table-item-value">'+C+"</div>\n              </div>\n              "),z+='\n              <div class="track-mouseover-menu-table-item">\n                <label for="normalizedDensity" class="track-mouseover-menu-table-item-label">Normalized density</label>\n                <div name="normalizedDensity" class="track-mouseover-menu-table-item-value">'+k+'</div>\n              </div>\n              <div class="track-mouseover-menu-table-item">\n                <label for="category" class="track-mouseover-menu-table-item-label">Category</label>\n                <div name="category" class="track-mouseover-menu-table-item-value">'+T+"</div>\n              </div>\n            ",z+="</div>"}}}},{key:"draw",value:function(){tt(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"draw",this).call(this)}}]),r}(e.tracks.BarTrack);return new(Function.prototype.bind.apply(u,[null].concat(r)))};ot.config={type:"horizontal-stacked-delta-bar",datatype:["multivec","epilogos"],local:!1,orientation:"1d-horizontal",thumbnail:(new DOMParser).parseFromString('<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 5640 5420" preserveAspectRatio="xMidYMid meet"> <g id="layer101" fill="#000000" stroke="none"> <path d="M0 2710 l0 -2710 2820 0 2820 0 0 2710 0 2710 -2820 0 -2820 0 0 -2710z"/> </g> <g id="layer102" fill="#750075" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> <path d="M4340 2710 l0 -2510 560 0 560 0 0 2510 0 2510 -560 0 -560 0 0 -2510z"/> <path d="M200 1870 l0 -1670 630 0 630 0 0 1670 0 1670 -630 0 -630 0 0 -1670z"/> <path d="M1660 1810 l0 -1610 570 0 570 0 0 1610 0 1610 -570 0 -570 0 0 -1610z"/> <path d="M3000 840 l0 -640 570 0 570 0 0 640 0 640 -570 0 -570 0 0 -640z"/> </g> <g id="layer103" fill="#ffff04" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> </g> </svg>',"text/xml").documentElement,availableOptions:["labelPosition","labelColor","valueScaling","labelTextOpacity","labelBackgroundOpacity","trackBorderWidth","trackBorderColor","trackType","scaledHeight","backgroundColor","colorScale","barBorder","sortLargestOnTop","selectRows"],defaultOptions:{labelPosition:"topLeft",labelColor:"black",labelTextOpacity:.4,valueScaling:"linear",trackBorderWidth:0,trackBorderColor:"black",backgroundColor:"white",barBorder:!0,sortLargestOnTop:!0,selectRows:null,fillOpacityMin:.1,fillOpacityMax:1},otherOptions:{epilogos:{scaledHeight:!1}}};var lt=r(1),st=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],i=!0,n=!1,a=void 0;try{for(var o,l=e[Symbol.iterator]();!(i=(o=l.next()).done)&&(r.push(o.value),!t||r.length!==t);i=!0);}catch(e){n=!0,a=e}finally{try{!i&&l.return&&l.return()}finally{if(n)throw a}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},ct=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),ut=function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,i)}if("value"in n)return n.value;var o=n.get;return void 0!==o?o.call(i):void 0};function ht(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vt(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ft(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var dt=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];if(!new.target)throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');var n=e.services.tileProxy,a=function(t){function r(e,t){ht(this,r);var i=vt(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t));return i.maxAndMin={max:null,min:null},i}return ft(r,t),ct(r,[{key:"renderTile",value:function(e){for(var t=e.graphics,r=t.children.length-1;r>=0;r--)t.removeChild(t.children[r]);t.clear(),e.drawnAtScale=this._xScale.copy();var i=this.getTilePosAndDimensions(e.tileData.zoomLevel,e.tileData.tilePos,this.tilesetInfo.tile_size),n=i.tileX,a=i.tileWidth,o=this.unFlatten(e);this.drawNormalizedBars(this.scaleMatrix(this.mapOriginalColors(o)),n,a,e),t.addChild(e.sprite),this.makeMouseOverData(e)}},{key:"rescaleTiles",value:function(){var e=this;this.visibleAndFetchedTiles().map((function(t){t.sprite&&(t.sprite.height=e.dimensions[1],t.sprite.y=0)}))}},{key:"scaleMatrix",value:function(e){for(var t=function(t){var r=e[t][0],i=e[t][1],n=r.map((function(e){return e.value})),a=i.map((function(e){return e.value})),o=n.length>0?n.reduce((function(e,t){return e+t})):0,l=a.length>0?a.reduce((function(e,t){return e+t})):0;r.map((function(e){return e.value=e.value/o})),i.map((function(e){return e.value=e.value/l}))},r=0;r<e.length;r++)t(r);return e}},{key:"mapOriginalColors",value:function(e){for(var t=this.options.colorScale||Xe(schemeCategory10),r=[],i=0;i<e.length;i++){for(var n=[],a=0;a<e[i].length;a++)n[a]={value:e[i][a],color:t[a]};for(var o=[],l=[],s=0;s<n.length;s++)n[s].value>=0?o.push(n[s]):n[s].value<0&&l.push(n[s]);this.options.sortLargestOnTop?(o.sort((function(e,t){return e.value-t.value})),l.sort((function(e,t){return t.value-e.value}))):(o.sort((function(e,t){return t.value-e.value})),l.sort((function(e,t){return e.value-t.value}))),r.push([o,l])}return r}},{key:"drawNormalizedBars",value:function(t,r,i,n){for(var a=this.dimensions[1],o=new e.libraries.PIXI.Graphics,l=this.dimensions[1],s=0;s<t.length;s++){var c=s;0===s&&c;for(var u=Be().domain([0,1]).range([0,a/2]),h=0,v=0;v<t[s][0].length;v++){var f=u(t[s][0][v].value),d=a/2-(h+f),p=t[s][0][v].color;this.addSVGInfo(n,c,d,1,f,p),o.beginFill(this.colorHexMap[p],1),o.drawRect(c,d,1,f),h+=f,l>d&&(l=d)}h=0;for(var m=Be().domain([0,1]).range([0,a/2]),g=0,y=0;y<t[s][1].length;y++){var b=m(t[s][1][y].value),x=a/2+g,w=t[s][1][y].color;this.addSVGInfo(n,c,x,1,b,w),o.beginFill(this.colorHexMap[w],1),o.drawRect(c,x,1,b),g+=b}g=0}var k=o.generateTexture(e.libraries.PIXI.SCALE_MODES.NEAREST),M=new e.libraries.PIXI.Sprite(k);M.width=this._xScale(r+i)-this._xScale(r),M.x=this._xScale(r),n.sprite=M}},{key:"setDimensions",value:function(e){var t=this;ut(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"setDimensions",this).call(this,e),this.visibleAndFetchedTiles().map((function(e){return t.initTile(e)}))}},{key:"addSVGInfo",value:function(e,t,r,i,n,a){e.hasOwnProperty("svgData")&&null!==e.svgData?(e.svgData.barXValues.push(t),e.svgData.barYValues.push(r),e.svgData.barWidths.push(i),e.svgData.barHeights.push(n),e.svgData.barColors.push(a)):e.svgData={barXValues:[t],barYValues:[r],barWidths:[i],barHeights:[n],barColors:[a]}}},{key:"draw",value:function(){ut(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"draw",this).call(this)}},{key:"makeMouseOverData",value:function(e){for(var t=e.tileData.shape[0],r=e.tileData.shape[1],i=e.svgData.barYValues,n=e.svgData.barColors,a=e.svgData.barHeights,o=[],l=0;l<t;l++)for(var s=0;s<r;s++){var c=s*t+l,u={y:i[c],color:n[c],height:a[c]};void 0===o[s]?o[s]=[u]:o[s].push(u)}for(var h=0;h<o.length;h++)o[h]=o[h].sort((function(e,t){return e.y-t.y}));e.mouseOverData=o}},{key:"exportSVG",value:function(){var e=this;this.visibleAndFetchedTiles().map((function(t){e.initTile(t)}));var t=null,i=null;t=i=document.createElement("g");var n=ut(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"superSVG",this).call(this),a=st(n,2);i=a[0],t=a[1];var o=document.createElement("g");t.appendChild(o),o.setAttribute("transform","translate("+this.pMain.position.x+","+this.pMain.position.y+") scale("+this.pMain.scale.x+","+this.pMain.scale.y+")");var l=!0,s=!1,c=void 0;try{for(var u,h=this.visibleAndFetchedTiles()[Symbol.iterator]();!(l=(u=h.next()).done);l=!0){var v=u.value,f=document.createElement("g");f.setAttribute("transform","translate("+v.sprite.x+","+v.sprite.y+") rotate(0) scale("+v.sprite.scale.x+","+v.sprite.scale.y+")");for(var d=v.svgData,p=0;p<d.barXValues.length;p++){var m=document.createElement("rect");m.setAttribute("fill",d.barColors[p]),m.setAttribute("stroke",d.barColors[p]),m.setAttribute("x",d.barXValues[p]),m.setAttribute("y",d.barYValues[p]),m.setAttribute("height",d.barHeights[p]),m.setAttribute("width",d.barWidths[p]),v.barBorders&&(m.setAttribute("stroke-width","0.1"),m.setAttribute("stroke","black")),f.appendChild(m)}o.appendChild(f)}}catch(e){s=!0,c=e}finally{try{!l&&h.return&&h.return()}finally{if(s)throw c}}return[i,i]}},{key:"getMouseOverHtml",value:function(e,t){if(!this.tilesetInfo)return"";var r=this.options.colorScale||Xe(schemeCategory10),i=this.calculateZoomLevel(),a=n.calculateTileWidth(this.tilesetInfo,i,this.tilesetInfo.tile_size),o=this._xScale.invert(e)/a,l=Math.floor(this.tilesetInfo.tile_size*(o-Math.floor(o))),s=this.tileToLocalId([i,Math.floor(o)]),c=this.fetchedTiles[s];if(!c)return"";for(var u=c.matrix[l],h=c.mouseOverData[l],v={},f=0;f<r.length;f++)v[r[f]]=f;if(t<h[0].y||t>=h[h.length-1].y+h[h.length-1].height)return"";for(var d=0;d<h.length;d++)if(t>h[d].y&&t<=h[d].y+h[d].height){var p=h[d].color,m=Number.parseFloat(u[v[p]]).toPrecision(4).toString(),g=this.tilesetInfo.row_infos[v[p]];return'<svg width="10" height="10"><rect width="10" height="10" rx="2" ry="2"\n            style="fill:'+p+';stroke:black;stroke-width:2;"></svg> '+(g.name||g)+"<br>"+m}}}]),r}(Object(lt.mix)(e.tracks.BarTrack).with(e.tracks.OneDimensionalMixin));return new(Function.prototype.bind.apply(a,[null].concat(r)))};dt.config={type:"scaled-horizontal-stacked-bar",datatype:["multivec"],local:!1,orientation:"1d-horizontal",thumbnail:(new DOMParser).parseFromString('<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="564px" height="542px" viewBox="0 0 5640 5420" preserveAspectRatio="xMidYMid meet"> <g id="layer101" fill="#000000" stroke="none"> <path d="M0 2710 l0 -2710 2820 0 2820 0 0 2710 0 2710 -2820 0 -2820 0 0 -2710z"/> </g> <g id="layer102" fill="#750075" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> <path d="M4340 2710 l0 -2510 560 0 560 0 0 2510 0 2510 -560 0 -560 0 0 -2510z"/> <path d="M200 1870 l0 -1670 630 0 630 0 0 1670 0 1670 -630 0 -630 0 0 -1670z"/> <path d="M1660 1810 l0 -1610 570 0 570 0 0 1610 0 1610 -570 0 -570 0 0 -1610z"/> <path d="M3000 840 l0 -640 570 0 570 0 0 640 0 640 -570 0 -570 0 0 -640z"/> </g> <g id="layer103" fill="#ffff04" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> </g> </svg>',"text/xml").documentElement,availableOptions:["labelPosition","labelColor","valueScaling","labelTextOpacity","labelBackgroundOpacity","trackBorderWidth","trackBorderColor","trackType","scaledHeight","backgroundColor","colorScale","barBorder","sortLargestOnTop"],defaultOptions:{labelPosition:"topLeft",labelColor:"black",labelTextOpacity:.4,valueScaling:"linear",trackBorderWidth:0,trackBorderColor:"black",backgroundColor:"white",barBorder:!0,sortLargestOnTop:!0,colorScale:["#FF0000","#FF4500","#32CD32","#008000","#006400","#C2E105","#FFFF00","#66CDAA","#8A91D0","#CD5C5C","#E9967A","#BDB76B","#808080","#C0C0C0","#FFFFFF"]}};var pt=dt,mt=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],i=!0,n=!1,a=void 0;try{for(var o,l=e[Symbol.iterator]();!(i=(o=l.next()).done)&&(r.push(o.value),!t||r.length!==t);i=!0);}catch(e){n=!0,a=e}finally{try{!i&&l.return&&l.return()}finally{if(n)throw a}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},gt=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),yt=function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,i)}if("value"in n)return n.value;var o=n.get;return void 0!==o?o.call(i):void 0};function bt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xt(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function wt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var kt=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];if(!new.target)throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');e.services.tileProxy;var n=function(e){function t(e,r){bt(this,t);var i=xt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return i.maxAndMin={max:null,min:null},i}return wt(t,e),gt(t,[{key:"renderTile",value:function(e){var t=e.graphics;t.clear(),e.drawnAtScale=this._xScale.copy();for(var r=this.getTilePosAndDimensions(e.tileData.zoomLevel,e.tileData.tilePos,this.tilesetInfo.tile_size),i=r.tileX,n=r.tileWidth,a=e.matrix,o=this.dimensions[1],l=e.tileData.shape,s=this.options.colorScale||Xe(schemeCategory10),c=Be().domain([0,this.maxAndMin.max]).range([0,o/l[0]]),u=0;u<a[0].length;u++){var h=o/l[0],v=u===a[0].length-1?h*u+(h*(u+1)-h*u)-1:h*u+(h*(u+1)-h*u);t.lineStyle(1,this.colorHexMap[s[u]],1);for(var f=0;f<a.length;f++){var d=this._xScale(i+f*n/this.tilesetInfo.tile_size),p=v-c(a[f][u]);this.addSVGInfo(e,d,p,s[u]),0===f?t.moveTo(d,p):t.lineTo(d,p)}}}},{key:"setDimensions",value:function(e){var r=this;yt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setDimensions",this).call(this,e),this.visibleAndFetchedTiles().map((function(e){return r.initTile(e)}))}},{key:"addSVGInfo",value:function(e,t,r,i){e.svgData&&e.svgData.hasOwnProperty("lineXValues")&&e.svgData.hasOwnProperty("lineYValues")&&e.svgData.hasOwnProperty("lineColor")?e.svgData.lineColor[e.svgData.lineColor.length-1]!==i?(e.svgData.lineXValues.push([t]),e.svgData.lineYValues.push([r]),e.svgData.lineColor.push(i)):(e.svgData.lineXValues[e.svgData.lineXValues.length-1].push(t),e.svgData.lineYValues[e.svgData.lineYValues.length-1].push(r)):e.svgData={lineXValues:[[t]],lineYValues:[[r]],lineColor:[i]}}},{key:"exportSVG",value:function(){var e=document.createElement("g"),r=e,i=yt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"superSVG",this).call(this),n=mt(i,2);e=n[0],r=n[1],e.setAttribute("class","exported-line-track");var a=document.createElement("g");r.appendChild(a),a.setAttribute("transform","translate("+this.position[0]+","+this.position[1]+")");for(var o=this.visibleAndFetchedTiles(),l=0;l<o.length;l++)for(var s=0;s<o[l].svgData.lineXValues.length;s++){var c=document.createElement("path");c.setAttribute("fill","transparent"),c.setAttribute("stroke",o[l].svgData.lineColor[s]);for(var u="M"+o[l].svgData.lineXValues[s][0]+" "+o[l].svgData.lineYValues[s][0],h=0;h<o[l].svgData.lineXValues[s].length;h++)u+="L"+o[l].svgData.lineXValues[s][h]+" "+o[l].svgData.lineYValues[s][h];c.setAttribute("d",u),a.appendChild(c)}var v=document.createElement("g");if(v.setAttribute("id","axis"),e.appendChild(v),v.setAttribute("transform","translate("+this.axis.pAxis.position.x+", "+this.axis.pAxis.position.y+")"),"left"===this.options.axisPositionHorizontal||"top"===this.options.axisPositionVertical){var f=this.axis.exportAxisLeftSVG(this.valueScale,this.dimensions[1]);v.appendChild(f)}else if("right"===this.options.axisPositionHorizontal||"bottom"===this.options.axisPositionVertical){var d=this.axis.exportAxisRightSVG(this.valueScale,this.dimensions[1]);v.appendChild(d)}return[e,r]}},{key:"getMouseOverHtml",value:function(e,t){return""}}]),t}(Object(lt.mix)(e.tracks.BarTrack).with(e.tracks.OneDimensionalMixin));return new(Function.prototype.bind.apply(n,[null].concat(r)))};kt.config={type:"basic-multiple-line-chart",datatype:["multivec"],local:!1,orientation:"1d-horizontal",thumbnail:(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  width="100%" height="100%" viewBox="0 0 340 288" preserveAspectRatio="xMidYMid meet"><rect id="svgEditorBackground" x="0" y="0" width="340" height="288" style="fill:none;stroke:none;"/><g style="fill:rgb(239,221,228);fill-rule:evenodd;stroke:rgb(239,221,228);stroke-width:0.1;" id="l1"><path d="M0,0h340v88h-2l-8,-4l-4,-2v-1h-3l-14,-7v-1h-3l-16,-8v-1h-3l-18,-9v-1h-3l-32,-16v-1h-3l-14,-7v-1l-5,5c-2,0,-2,1,-7,6c-2,0,-2,1,-8,7c-2,0,-2,1,-7,6c-2,0,-2,1,-6,5c-2,0,-2,1,-5,4h-1l-2,-16l-1,-9c0,-4,-1,-3,-3,-2c-2,0,-2,1,-3,2l-2,1l-2,1c-2,0,-2,1,-3,2l-2,1c-2,0,-2,1,-3,2l-2,1c-2,0,-2,1,-3,2h-1l-2,-1l-1,-1v-1h-2l-1,-1v-1h-2l-2,-2v-1h-2l-2,-2v-1h-2l-2,-2v-1c-3,0,-3,2,-4,3h-1v2l-1,1h-1v2l-1,1h-1l-1,-1l-2,-4c0,-3,-1,-3,-5,-11c0,-3,-1,-3,-4,-9c0,-3,-1,-3,-3,-7v2l-7,21h-1v4l-3,9l-3,9l-3,9h-1v4l-3,9l-3,9l-3,9h-1v4l-3,9l-2,6l-1,2h-1c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3l-1,-2c0,-2,-1,-2,-3,-4l-1,-2c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3v-1l-1,1c-5,0,-5,1,-11,4c-3,0,-3,1,-5,2c-3,0,-3,1,-5,2c-3,0,-3,1,-5,2l-3,1c-3,0,-3,1,-5,2h-2Z" style="fill:white;"/><path d="M220,41h1l24,12l1,1v1h2l24,12l1,1v1h2l28,14l1,1v1h2l18,9l8,4l1,1v1h2l4,2l1,1v94l-2,2h-1v2l-4,4l-11,11h-1v2l-8,8l-2,1l-15,1l-32,2c-17,0,-17,1,-33,2c-16,0,-16,1,-31,2l-16,1c-17,0,-17,1,-33,2h-7l-1,-2l-1,-6c0,-6,-1,-6,-2,-11l-1,-6c0,-6,-1,-6,-2,-11v-2l-4,4c-2,0,-2,1,-6,5c-2,0,-2,1,-7,6c-2,0,-2,1,-7,6l-2,1h-2l-8,-8v-1h-2l-1,-1l-7,-7v-1l-1,1l-4,2c-3,0,-3,1,-7,3c-3,0,-3,1,-5,2h-2l-2,-1l-6,-6l-2,-2v-1h-2l-3,-3v-1l-1,1h-1v3l-2,4h-1v3l-2,4h-1v3h-2l-1,-1c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-3,-4v3l-2,10h-1v6l-1,4h-1v5l-1,5h-1l-6,-3l-1,-1v-1h-2l-6,-3l-1,-1v-1h-2l-4,-2l-1,-1v-1h-2l-2,-1l-1,-1v-130l4,-2l3,-1c3,0,3,-1,5,-2l3,-1c3,0,3,-1,5,-2l3,-1c3,0,3,-1,5,-2l3,-1h3l1,2c0,2,1,2,2,3l3,6c0,2,1,2,2,3l2,4l2,4c0,2,1,2,2,3l4,8c0,2,1,2,2,3l3,6c0,2,1,2,2,3l4,8c0,2,1,2,2,3l4,8c0,2,1,2,2,3l3,6c0,2,1,2,2,3l3,6v-2l1,-4l7,-21h1v-4l3,-9l3,-9h1v-4l3,-9l2,-6h1v-4l3,-9l2,-6h1v-4l3,-9l2,-6h1l2,4l1,3c0,3,1,3,2,5c0,3,1,3,2,5c0,3,1,3,2,5c0,3,1,3,2,5c0,3,1,3,2,5q0,1,1,-3l1,-3h1v-4l1,-3h1v-4l1,-3h1v-4l1,-3h1v-4l1,-1h1l5,5l5,5v1l3,-1c2,0,2,-1,3,-2c2,0,2,-1,3,-2l2,-1c2,0,2,-1,3,-2l2,-1h1l1,2l1,9l1,10c0,9,1,9,2,12v-1l1,-1c2,0,2,-1,4,-3l2,-2c2,0,2,-1,5,-4c2,0,2,-1,6,-5c2,0,2,-1,5,-4c2,0,2,-1,6,-5c2,0,2,-1,6,-5c2,0,2,-1,5,-4c2,0,2,-1,6,-5c2,0,2,-1,5,-4Z" style="fill:white;"/><path d="M339,214h1v74h-340v-58h1l24,12l1,1v1h2l8,4l1,1v-3l1,-5l2,-8l1,-3h1l2,4c0,2,1,2,2,3l2,4v2h1v1l1,-2h1v-3l2,-4h1v-3l1,-2h1v-3l2,-4h1v-3l1,-2h1l4,4c0,1,2,1,6,2v-1l3,-1c3,0,3,-1,5,-2l9,-3h2l1,1c0,2,1,2,6,7l3,3c0,2,1,2,8,9v2l4,-4c2,0,2,-1,5,-4c2,0,2,-1,6,-5c2,0,2,-1,5,-4l2,-1h1l1,7l1,10c0,10,1,10,4,11v-1c15,0,15,-1,29,-2l15,-1c16,0,16,-1,46,-3l15,-1l30,-2l15,-1l16,-1h14v-1c2,0,2,-1,9,-8l8,-8h1v-2l2,-1h1v-2Z" style="fill:white;"/></g><g style="fill:rgb(252,100,68);fill-rule:evenodd;stroke:rgb(252,100,68);stroke-width:0.1;" id="l2"><path d="M109,10h1l2,4c0,3,1,3,4,9c0,3,1,3,5,11c0,3,1,3,2,5l1,3q0,1,2-3l1-1h1v-2l1-1h1v-2h3l2,2v1h2l2,2v1h2l2,2v1h2l1,1v1h2l1,1v1h2c1,1,1,0,2-1l2-1c2,0,2-1,3-2l2-1c2,0,2-1,3-2l4-2c2,0,2-1,3-2l4-2h1l1,4l1,9c0,10,1,10,2,16v-1c2,0,2-1,6-5c2,0,2-1,7-6c2,0,2-1,9-8c2,0,2-1,6-5c2,0,2-1,7-6l2-1h3l12,6v1h3l32,16v1h3l18,9v1h3l16,8v1h3l14,7v1h3l14,7v14h-3l-4-2l-1-1v-1h-2l-26-13l-1-1v-1h-2l-28-14l-1-1v-1h-2l-24-12l-1-1v-1h-2l-18-9l-4-2v-1l-4,4c-2,0-2,1-4,3c-2,0-2,1-5,4c-2,0-2,1-6,5c-2,0-2,1-5,4c-2,0-2,1-4,3l-2,2c-2,0-2,1-5,4c-2,0-2,1-6,5c-2,0-2,1-4,3l-2,2c-2,0-2,1-5,4h-1l-1-6l-2-20c0-7-2-6-4-6v1l-1,1l-2,1c-2,0-2,1-3,2c-2,0-2,1-3,2l-2,1h-2l-12-12v1l-1,5l-1,3h-1v4l-1,3l-1,2h-1v5l-1,4l-1,3h-1v4h-1l-1-1l-1-2c0-3-1-3-2-5c0-3-1-3-2-5c0-3-1-3-2-5c0-3-1-3-2-5l-1-3c0-3-1-3-3-7v3l-2,6l-2,6h-1v4l-3,9l-2,6h-1v4l-3,9l-2,6l-1,2h-1v5l-3,9l-2,6l-1,2h-1v5l-3,9l-3,9h-1v4l-1,2h-1l-2-4c0-2-1-2-2-3l-3-6c0-2-1-2-2-3l-4-8c0-2-1-2-2-3l-4-8c0-2-1-2-2-3l-3-6c0-2-1-2-2-3l-4-8c0-2-1-2-2-3l-4-8c0-2-1-2-2-3l-3-6c0-2-1-2-2-3l-1-2c0-2-3-1-6-1v1l-2,1l-3,1c-3,0-3,1-5,2l-3,1c-3,0-3,1-5,2l-3,1c-3,0-3,1-5,2h-2v-12l4-2l3-1c3,0,3-1,5-2c3,0,3-1,5-2c3,0,3-1,5-2c3,0,3-1,9-4l5-1h1l2,2c0,2,1,2,2,3c0,3,1,3,4,6c0,3,1,3,4,6c0,2,1,2,2,3c0,3,1,3,4,6c0,3,1,3,2,4c0,2,1,2,3,4l1,2c0,2,1,2,3,4c0,2,1,2,2,3c0,2,1,2,2,3c0,2,1,2,2,3c0,2,1,2,2,3c0,2,1,2,2,3l1,2v-2l3-9l2-6l1-2h1v-5l3-9l3-9l2-6l1-2h1v-5l3-9l3-9l2-6l1-2h1v-5l3-9l3-9z"/></g><g style="fill:rgb(6,6,252);fill-rule:evenodd;stroke:rgb(6,6,252);stroke-width:0.1;" id="l3"><path d="M56,197h1l3,3v1h2l8,8v1h2v1l4-2c3,0,3-1,7-3c3,0,3-1,7-3h1l8,8v1h2l1,1l7,7v1l2-1c2,0,2-1,7-6c2,0,2-1,7-6c2,0,2-1,6-5c2,0,2-1,5-4h1l1,2l1,5l1,6c0,6,1,6,2,11l2,12c0,2,9,1,25,1v-1l15-1l18-1c16,0,16-1,31-2c16,0,16-1,31-2c18,0,18-1,34-2h13v-1c2,0,2-1,7-6l5-5h1v-2l10-10l5-5h1v16l-8,8h-1v2l-12,12l-4,1l-28,2l-15,1c-17,0-17,1-32,2c-15,0-15,1-28,2c-17,0-17,1-31,2l-15,1c-16,0-16,1-31,2h-1l-1-1l-1-10l-1-12v-5l-1,1c-2,0-2,1-5,4c-2,0-2,1-6,5c-2,0-2,1-5,4c-2,0-2,1-5,4h-1c0-2-1-2-8-9c0-2-1-2-9-10l-1-2v-1l-2,1l-6,2c-3,0-3,1-5,2l-6,2h-4l-2-2v-1h-2c-3-3-3-1-4,2l-2,4h-1v3l-1,2h-1v3l-2,4h-1v3l-1,2h-1l-1-1l-2-4c0-2-1-2-2-3l-3-6v3l-2,8h-1v5l-1,3h-1l-10-5l-1-1v-1h-2l-22-11l-1-1v-15h1l4,2l1,1v1h2l4,2l1,1v1h2l4,2l2,1l1,1v1h2l4,2l1,1v-5l1-5l1-4h1v-6l2-10l1-3h1l2,2c0,2,1,2,2,3c0,2,1,2,2,3c0,2,1,2,2,3c0,2,1,2,2,3c0,2,1,2,3,3v-3l2-4h1v-3l2-4h1v-3z"/></g><g style="fill:rgb(252,133,112);fill-rule:evenodd;stroke:rgb(252,133,112);stroke-width:0.1;" id="l4"><path d="M216,29h1v1l-1,1h-1v-1zm-115,4h1v2h-1zm109,1h1v1l-2,2h-1v-1zm7,2h1v1l-2,2h-1v-1zm-14,4h1v1l-1,1h-1v-1zm-80,1h1l1,1v1h-1l-1-1zm72,6h1v1l-2,2h-1v-1zm-59,1h1l5,5l6,6v1h-1l-5-5l-5-5v-1l-1,1h-1v-1zm75,0h1v1l-1,1h-1v-1zm-47,3h1v2h-1zm42,1h1v1l-1,1h-1v-1zm-18,1h1v1l-2,2h-1v-1zm-11,1h1v2h-1zm23,3h1v1l-1,1h-1v-1zm-35,1h1v4h-1zm17,0h1v1l-2,2h-1v-1zm13,3h1v1l-2,2h-1v-1zm-104,3h1v2h-1z"/><path d="M41,66h1l1,1v1h-1l-1-1zm89,0h1v2h-1zm59,0h1v1l-1,1h-1v-1zm-23,2h1v4h-1zm18,2h1v1l-2,2h-1v-1zm-139,2h1l1,1v1h-1l-1-1zm133,3h1v1l-1,1h-1v-1zm-11,3h1v3h-1zm5,2h1v1l-1,1h-1v-1zm-121,1h1l1,1v1h-1l-1-1zm4,6h1l1,1v1h-1l-1-1zm2,3h1l1,1v1h-1l-1-1zm24,5h1v2h-1zm-20,1h1l1,1v1h-1l-1-1zm278,6h1v1h-1zm-245,2h1v2h-1zm-7,22h1v2h-1zm-12,16h1l1,1v1h-1l-1-1z"/></g><g style="fill:rgb(155,153,247);fill-rule:evenodd;stroke:rgb(155,153,247);stroke-width:0.1;" id="l5"><path d="M339,197h1v1l-2,2h-1v-1zm-16,17h1v1l-2,2h-1v-1zm14,2h1v1l-1,1h-1v-1zm-3,3h1v1l-3,3h-1v-1zm-270,2h1l1,1v1h-1l-1-1zm67,5h1v2h-1zm165,1h2v1h-2zm-16,1h2v1h-2zm-33,2h2v1h-2zm-16,1h2v1h-2zm-16,1h3v1h-3zm-15,1h2v1h-2zm-33,2h2v1h-2zm-16,1h2v1h-2zm164,0h2v1h-2zm-14,1h2v1h-2zm-46,3h2v1h-2zm-15,1h2v1h-2zm-15,1h2v1h-2zm-30,2h2v1h-2zm-45,3h2v1h-2zm-15,1h2v1h-2z"/></g></svg>',"text/xml").documentElement,availableOptions:["labelPosition","labelColor","valueScaling","labelTextOpacity","labelBackgroundOpacity","trackBorderWidth","trackBorderColor","trackType"],defaultOptions:{labelPosition:"topLeft",labelColor:"black",labelTextOpacity:.4,valueScaling:"linear",trackBorderWidth:0,trackBorderColor:"black"}};var Mt=kt,At=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],i=!0,n=!1,a=void 0;try{for(var o,l=e[Symbol.iterator]();!(i=(o=l.next()).done)&&(r.push(o.value),!t||r.length!==t);i=!0);}catch(e){n=!0,a=e}finally{try{!i&&l.return&&l.return()}finally{if(n)throw a}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dt=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),Tt=function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,i)}if("value"in n)return n.value;var o=n.get;return void 0!==o?o.call(i):void 0};function Ot(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function Ct(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _t(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function zt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Vt=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];if(!new.target)throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');var n=e.services,a=n.tileProxy,o=n.pixiRenderer,l=e.utils,s=l.absToChr,c=l.colorToHex,u=function(t){function r(e,t){Ct(this,r);var i=_t(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t));return i.initializeBasicMultipleBarChart(),i}return zt(r,t),Dt(r,[{key:"initializeBasicMultipleBarChart",value:function(){this.basicMultipleBarChartInitialized||(this.maxAndMin={max:null,min:null},this.textureGraphics=new e.libraries.PIXI.Graphics,this.basicMultipleBarChartInitialized=!0,this.renderedTileIds=Object.create({}),this.rescaledTileIds=Object.create({}))}},{key:"createColorScale",value:function(){if(!this.options.colorScale)if(this.tilesetInfo.row_infos&&this.tilesetInfo.row_infos[0].color)this.options.colorScale=this.tilesetInfo.row_infos.map((function(e){return e.color}));else{this.options.colorScale=["#FF0000","#FF4500","#32CD32","#008000","#006400","#C2E105","#FFFF00","#66CDAA","#8A91D0","#CD5C5C","#E9967A","#BDB76B","#808080","#C0C0C0","#FFFFFF"]}}},{key:"initTile",value:function(e){var t=this;this.createColorScale(),this.initializeBasicMultipleBarChart(),this.scale.minRawValue=this.minVisibleValue(),this.scale.maxRawValue=this.maxVisibleValue(),this.scale.minValue=this.scale.minRawValue,this.scale.maxValue=this.scale.maxRawValue,this.maxAndMin.min=this.minValueInArray(e.tileData.dense),this.maxAndMin.max=this.maxValueInArray(e.tileData.dense),this.numCategories=this.options.selectRows?this.options.selectRows.length:e.tileData.shape[0],this.localColorToHexScale(),this.unFlatten(e),this.renderedTileIds[e.tileId]=!1,this.renderTile(e);var r=this.visibleAndFetchedTiles(),i=r.map((function(e){return e.tileId})),n=Object.keys(this.renderedTileIds);this.deepEqual(i,n)&&(this.syncMaxAndMin(),r.map((function(e){if(t.minValueInArray(e.tileData.dense)!==t.maxAndMin.min||t.maxValueInArray(e.tileData.dense)!==t.maxAndMin.max){if(e.hasOwnProperty("mouseoverRawData")&&null!==e.mouseoverRawData){for(var r in e.mouseoverRawData)e.mouseoverRawData.hasOwnProperty(r)&&delete e.mouseoverRawData[r];e.mouseoverRawData=null}t.renderedTileIds[e.tileId]=!1,t.renderTile(e)}})))}},{key:"destroyTile",value:function(e){var t=this;for(var r in delete this.renderedTileIds[e.tileId],this.renderedTileIds)this.renderedTileIds[r]=!1;for(var r in delete this.rescaledTileIds[e.tileId],this.rescaledTileIds)this.rescaledTileIds[r]=!1;e.sprite.destroy(!0),e.graphics.destroy(!0),e.graphics=null,e.sprite=null;var i=this.visibleAndFetchedTiles(),n=i.map((function(e){return e.tileId})),a=Object.keys(this.renderedTileIds);this.deepEqual(n,a)&&(this.syncMaxAndMin(),i.map((function(e){if(t.minValueInArray(e.tileData.dense)!==t.maxAndMin.min||t.maxValueInArray(e.tileData.dense)!==t.maxAndMin.max){if(e.hasOwnProperty("mouseoverRawData")&&null!==e.mouseoverRawData){for(var r in e.mouseoverRawData)e.mouseoverRawData.hasOwnProperty(r)&&delete e.mouseoverRawData[r];e.mouseoverRawData=null}t.renderedTileIds[e.tileId]=!1,t.renderTile(e)}})))}},{key:"rerender",value:function(e){Tt(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"rerender",this).call(this,e),this.options=e;for(var t=this.visibleAndFetchedTiles(),i=0;i<t.length;i++)this.updateTile(t[i]);this.draw()}},{key:"updateTile",value:function(){for(var e=this.visibleAndFetchedTiles(),t=0;t<e.length;t++){var r=e[t];this.unFlatten(r)}}},{key:"drawTile",value:function(e){}},{key:"renderTile",value:function(e){if(!this.renderedTileIds[e.tileId]){e.svgData=null,e.mouseOverData=null;var t=e.graphics;t.clear(),t.children.map((function(e){t.removeChild(e)})),e.drawnAtScale=this._xScale.copy();var r=this.getTilePosAndDimensions(e.tileData.zoomLevel,e.tileData.tilePos,this.tilesetInfo.tile_size),i=r.tileX,n=r.tileWidth,a=this.unFlatten(e);this.oldDimensions=this.dimensions;try{this.drawVerticalBars(this.mapOriginalColors(a),i,n,this.maxAndMin.max,this.maxAndMin.min,e),t.addChild(e.sprite),this.makeMouseOverData(e),this.renderedTileIds[e.tileId]=!0}catch(e){}}}},{key:"syncMaxAndMin",value:function(){var e=this,t=this.visibleAndFetchedTiles();this.maxAndMin.min=0,this.maxAndMin.max=0,t.map((function(t){t.minValue<e.maxAndMin.min&&(e.maxAndMin.min=t.minValue),t.maxValue>e.maxAndMin.max&&(e.maxAndMin.max=t.maxValue)}))}},{key:"deepEqual",value:function(e,t){var r=this,i=Object.keys,n=void 0===e?"undefined":St(e),a=void 0===t?"undefined":St(t);return e&&t&&"object"===n&&n===a?i(e).length===i(t).length&&i(e).every((function(i){return r.deepEqual(e[i],t[i])})):e===t}},{key:"rescaleTiles",value:function(){var e=this,t=this.visibleAndFetchedTiles(),r=t.map((function(e){return e.tileId})),i=Object.keys(this.renderedTileIds);this.deepEqual(r,i)&&(this.syncMaxAndMin(),t.map((function(t){if(!e.rescaledTileIds[t.tileId]){var r=Be().domain([0,e.maxAndMin.max+Math.abs(e.maxAndMin.min)]).range([0,e.dimensions[1]]),i=e.dimensions[1]-r(Math.abs(e.maxAndMin.min)),n=r(e.maxAndMin.max+Math.abs(e.maxAndMin.min)),a=t.sprite,o=i-r(e.maxAndMin.max);a&&(a.height=n,a.y=o,e.rescaledTileIds[t.tileId]=!0)}})))}},{key:"localColorToHexScale",value:function(){for(var e=this.options.colorScale||Xe(schemeCategory10),t={},r=0;r<e.length;r++)t[e[r]]=c(e[r]),this.options.hideColorByIndex&&r===this.options.hideColorByIndex&&(t[e[r]]=c("#ffffff"));this.colorHexMap=t}},{key:"findMaxAndMin",value:function(e){for(var t={max:null,min:null},r=0;r<e.length;r++){var i=e[r],n=Math.max.apply(Math,Ot(i.filter((function(e){return e>=0}))));n>t.max&&(t.max=n);var a=i.filter((function(e){return e<=0}));if(a.length>0){a=a.map((function(e){return Math.abs(e)}));var o=Math.min.apply(Math,Ot(a));(null===t.min||o>t.min)&&(t.min=o)}else t.min=0}return t}},{key:"unFlatten",value:function(e){if(e.matrix)return e.matrix;var t=e.tileData.dense;t.filter((function(e){return e<0})).length>0&&"linear"===this.options.valueScaling&&(this.options.valueScaling="exponential");var r=this.simpleUnFlatten(e,t),i=this.findMaxAndMin(r.matrix);return e.matrix=r.matrix,e.maxValue=i.max,e.minValue=i.min,this.syncMaxAndMin(),r.matrix}},{key:"simpleUnFlatten",value:function(e,t){for(var r=this,i=this.numCategories,n=e.tileData.shape[1],a=[],o=0;o<i;o++)for(var l=function(e){var i=void 0;if(i=void 0===a[e]?[]:a[e],r.options.selectRows){var l=r.options.selectRows[o];if(Array.isArray(l)){var s=l.reduce((function(r,i){return r+t[n*i+e]}),0);i.push(s)}else i.push(t[n*l+e])}else i.push(t[n*o+e]);a[e]=i},s=0;s<n;s++)l(s);for(var c=-1,u=0;u<n;u++)for(var h=0;h<i;h++)c<a[u][h]&&(c=a[u][h]);return{matrix:a}}},{key:"remapVectorToSortedIndices",value:function(e){var t=e.length-1;Array(t+1);return[].concat(Ot(e)).map((function(e,t){return{i:t,d:e}})).sort((function(e,t){return e.d>t.d?1:-1})).map((function(e){return e.i}))}},{key:"remapVectorToStateSortedDeltas",value:function(e){var t=0,r=e.length-1,i=Array(r+1),n=[].concat(Ot(i.keys())).sort((function(t,r){return e[t]-e[r]}));for(i[n[t]]=e[n[t]];t++<r;)i[n[t]]=e[n[t]]-e[n[t-1]];return i}},{key:"remapVectorToStateDeltas",value:function(e){var t=[].concat(Ot(Array(e.length).keys()));t.sort((function(t,r){return e[t]<e[r]?-1:e[t]>e[r]?1:0}));var r=[];t.forEach((function(i,n){return r.push({i:t[n],d:e[t[n]]})}));var i=new Array(e.length);i[0]=r[0];for(var n=1;n<e.length;++n)i[n]={i:r[n].i,d:r[n].d-r[n-1].d};return i}},{key:"sortStateDeltasByState",value:function(e){var t=[].concat(Ot(e));return t.sort((function(e,t){return e.i>t.i?1:-1})),t}},{key:"sortStateDeltasByValue",value:function(e){var t=[].concat(Ot(e));return t.sort((function(e,t){return e.d>t.d?1:-1})),t}},{key:"remapVectorToUndiffedStateDeltas",value:function(e){var t=[].concat(Ot(Array(e.length).keys()));t.sort((function(t,r){return e[t]<e[r]?-1:e[t]>e[r]?1:0}));var r=[];return t.forEach((function(i,n){return r.push({i:t[n],d:e[t[n]]})})),r}},{key:"accumulateStateDeltasUpToState",value:function(e,t){for(var r=0,i=0;i<e.length;i++){var n=e[i];if(r+=n.d,n.i===t)break}return r}},{key:"mapOriginalColors",value:function(e){for(var t=this.options.colorScale||Xe(schemeCategory10),r=[],i=0;i<e.length;i++){for(var n=[],a=0;a<e[i].length;a++)n[a]={value:isNaN(e[i][a])?0:e[i][a],color:t[a]};for(var o=[],l=[],s=0;s<n.length;s++)n[s].value>=0?o.push(n[s]):n[s].value<0&&l.push(n[s]);o.reverse(),l.reverse(),r.push([o,l])}return r}},{key:"drawVerticalBars",value:function(t,r,i,n,a,l){this.textureGraphics.clear();var s=this.dimensions[1];this.syncMaxAndMin();var u=-1===this.options.valueScaleMax?n:this.options.valueScaleMax,h=n+Math.abs(a),v=n*s/h,f=Math.abs(a)*s/h,d=v/this.numCategories,p=(this.numCategories,this.dimensions[1]);this.drawBackground(t,this.textureGraphics);for(var m=c("#000000"),g=Be().domain([0,u]).range([0,d]),y=0;y<t.length;y++){var b=10*y;0===y&&b;for(var x=t[y][0],w=0,k=0;k<x.length;k++){var M=x[k].value;-1!==this.options.valueScaleMax&&x[k].value>this.options.valueScaleMax&&(M=this.options.valueScaleMax);var A=g(M)<.5?1:g(M),S=v-w-A;this.addSVGInfo(l,b,S,10,A,x[k].color),this.textureGraphics.beginFill(this.colorHexMap[x[k].color],g(M)<1?.33:1),this.textureGraphics.drawRect(b,S,10,A),this.textureGraphics.endFill(),w+=d,p>S&&(p=S)}}"20.490855"===l.tileId&&(console.log("lowestY (background over tile) "+p),console.log("drawRect (background over tile) > y0 0 y1 "+p)),this.addSVGInfo(l,0,0,10*t.length,p,"#000000"),this.textureGraphics.beginFill(m),this.textureGraphics.drawRect(0,0,10*t.length,p),this.textureGraphics.endFill();for(var D=d-p,T=0;T<t.length;T++){var O=10*T;0===T&&O;for(var C=t[T][0],_=0,z=0;z<C.length;z++){g(C[z].value);var V=parseInt(v-_-D),I=parseInt(d);this.addMouseoverRawInfo(l,O,V,10,I,C[z].color),_+=d}}try{var F=o.generateTexture(this.textureGraphics,e.libraries.PIXI.SCALE_MODES.NEAREST),P=new e.libraries.PIXI.Sprite(F);P.width=this._xScale(r+i)-this._xScale(r),P.x=this._xScale(r),l.sprite=P,l.lowestY=p}catch(e){}}},{key:"addSVGInfo",value:function(e,t,r,i,n,a){e.hasOwnProperty("svgData")&&null!==e.svgData?(e.svgData.barXValues.push(t),e.svgData.barYValues.push(r),e.svgData.barWidths.push(i),e.svgData.barHeights.push(n),e.svgData.barColors.push(a)):e.svgData={barXValues:[t],barYValues:[r],barWidths:[i],barHeights:[n],barColors:[a]}}},{key:"addMouseoverRawInfo",value:function(e,t,r,i,n,a){e.hasOwnProperty("mouseoverRawData")&&null!==e.mouseoverRawData?(e.mouseoverRawData.barXValues.push(t),e.mouseoverRawData.barYValues.push(r),e.mouseoverRawData.barWidths.push(i),e.mouseoverRawData.barHeights.push(n),e.mouseoverRawData.barColors.push(a)):e.mouseoverRawData={barXValues:[t],barYValues:[r],barWidths:[i],barHeights:[n],barColors:[a]}}},{key:"setDimensions",value:function(e){var t=this;this.oldDimensions=this.dimensions,Tt(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"setDimensions",this).call(this,e),this.visibleAndFetchedTiles().map((function(e){if(e.hasOwnProperty("mouseoverRawData")&&null!==e.mouseoverRawData){for(var r in e.mouseoverRawData)e.mouseoverRawData.hasOwnProperty(r)&&delete e.mouseoverRawData[r];e.mouseoverRawData=null}t.initTile(e)}))}},{key:"minValueInArray",value:function(e){for(var t=e[0],r=1;r<e.length;r++){var i=e[r];t=i<t?i:t}return t}},{key:"maxValueInArray",value:function(e){for(var t=e[0],r=1;r<e.length;r++){var i=e[r];t=i>t?i:t}return t}},{key:"makeMouseOverData",value:function(e){for(var t=this.numCategories,r=e.tileData.shape[1],i=e.mouseoverRawData.barYValues,n=e.mouseoverRawData.barHeights,a=e.mouseoverRawData.barColors,o=[],l=0;l<t;l++)for(var s=0;s<r;s++){var c=s*t+l,u={y:i[c],height:n[c],color:a[c]};void 0===o[s]?o[s]=[u]:o[s].push(u)}for(var h=0;h<o.length;h++)o[h]=o[h].sort((function(e,t){return e.y-t.y}));e.mouseOverData=o}},{key:"exportSVG",value:function(){var e=this;this.visibleAndFetchedTiles().map((function(t){e.initTile(t),e.draw()}));var t=null,i=null;t=i=document.createElement("g");var n=Tt(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"superSVG",this).call(this),a=At(n,2);i=a[0],t=a[1];var o=document.createElement("g");t.appendChild(o),o.setAttribute("transform","translate("+this.pMain.position.x+","+this.pMain.position.y+") scale("+this.pMain.scale.x+","+this.pMain.scale.y+")");var l=!0,s=!1,c=void 0;try{for(var u,h=this.visibleAndFetchedTiles()[Symbol.iterator]();!(l=(u=h.next()).done);l=!0){var v=u.value,f=document.createElement("g"),d=v.sprite.x,p=v.sprite.y+v.lowestY,m=v.sprite.scale.x,g=v.sprite.scale.y;f.setAttribute("transform"," translate("+d+","+p+") rotate(0) scale("+m+","+g+") ");for(var y=v.svgData,b=0;b<y.barXValues.length;b++){var x=document.createElement("rect");x.setAttribute("fill",y.barColors[b]),x.setAttribute("stroke",y.barColors[b]),x.setAttribute("x",y.barXValues[b]),x.setAttribute("y",y.barYValues[b]-v.lowestY),x.setAttribute("height",y.barHeights[b]),x.setAttribute("width",y.barWidths[b]),this.options.barBorder&&(x.setAttribute("stroke-width","0.1"),x.setAttribute("stroke","black")),f.appendChild(x)}o.appendChild(f)}}catch(e){s=!0,c=e}finally{try{!l&&h.return&&h.return()}finally{if(s)throw c}}return[i,i]}},{key:"getMouseOverHtml",value:function(e,t){var r=this;if(!this.tilesetInfo)return"";var i=this.options.colorScale||Xe(schemeCategory10),n=this.calculateZoomLevel(),o=a.calculateTileWidth(this.tilesetInfo,n,this.tilesetInfo.tile_size),l=this._xScale.invert(e)/o,c=Math.floor(this.tilesetInfo.tile_size*(l-Math.floor(l))),u=this.tileToLocalId([n,Math.floor(l)]),h=this.fetchedTiles[u];if(!h)return"";for(var v=h.matrix[c],f=h.mouseOverData[c],d=(t-h.sprite.y)/h.sprite.scale.y+h.lowestY,p={},m=0;m<i.length;m++)p[i[m]]=m;if(d<f[0].y||d>=f[f.length-1].y+f[f.length-1].height)return"";for(var g=0;g<f.length;g++){var y=f[g].y,b=f[g].height;if(d>y&&d<=y+b){var x=f[g].color;if("#ffffff"===x)return"";var w=Number.parseFloat(v[p[x]]).toPrecision(4).toString(),k=void 0;if(this.options.selectRows){var M=this.options.selectRows[p[x]];if(Array.isArray(M)){k=M.map((function(e){return r.tilesetInfo.row_infos[e].name||r.tilesetInfo.row_infos[e]})).join(", ")}else{var A=this.tilesetInfo.row_infos[M];k=A.name||A}}else{var S=this.tilesetInfo.row_infos[p[x]];k=S.name||S}var D='<svg width="10" height="10"><rect width="10" height="10" rx="2" ry="2" style="fill:'+x+';stroke:black;stroke-width:2;"></svg> '+k,T=this._xScale.invert(e),O=null;if(this.options.chromInfo&&this.options.binSize){var C=s(T,this.options.chromInfo);O=C[0]+":"+(Math.ceil(C[1]/this.options.binSize)*this.options.binSize-this.options.binSize)}var _="";return _+='<div class="track-mouseover-menu-table">',O&&(_+='\n              <div class="track-mouseover-menu-table-item">\n                <label for="position" class="track-mouseover-menu-table-item-label">Position</label>\n                <div name="position" class="track-mouseover-menu-table-item-value">'+O+"</div>\n              </div>\n              "),_+='\n              <div class="track-mouseover-menu-table-item">\n                <label for="normalizedDensity" class="track-mouseover-menu-table-item-label">Normalized density</label>\n                <div name="normalizedDensity" class="track-mouseover-menu-table-item-value">'+w+'</div>\n              </div>\n              <div class="track-mouseover-menu-table-item">\n                <label for="category" class="track-mouseover-menu-table-item-label">Category</label>\n                <div name="category" class="track-mouseover-menu-table-item-value">'+D+"</div>\n              </div>\n            ",_+="</div>"}}}},{key:"draw",value:function(){Tt(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"draw",this).call(this)}}]),r}(e.tracks.BarTrack);return new(Function.prototype.bind.apply(u,[null].concat(r)))};Vt.config={type:"basic-multiple-bar-chart",datatype:["multivec","epilogos"],local:!1,orientation:"1d-horizontal",thumbnail:(new DOMParser).parseFromString('<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 5640 5420" preserveAspectRatio="xMidYMid meet"> <g id="layer101" fill="#000000" stroke="none"> <path d="M0 2710 l0 -2710 2820 0 2820 0 0 2710 0 2710 -2820 0 -2820 0 0 -2710z"/> </g> <g id="layer102" fill="#750075" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> <path d="M4340 2710 l0 -2510 560 0 560 0 0 2510 0 2510 -560 0 -560 0 0 -2510z"/> <path d="M200 1870 l0 -1670 630 0 630 0 0 1670 0 1670 -630 0 -630 0 0 -1670z"/> <path d="M1660 1810 l0 -1610 570 0 570 0 0 1610 0 1610 -570 0 -570 0 0 -1610z"/> <path d="M3000 840 l0 -640 570 0 570 0 0 640 0 640 -570 0 -570 0 0 -640z"/> </g> <g id="layer103" fill="#ffff04" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> </g> </svg>',"text/xml").documentElement,availableOptions:["labelPosition","labelColor","valueScaling","labelTextOpacity","labelBackgroundOpacity","trackBorderWidth","trackBorderColor","trackType","scaledHeight","backgroundColor","colorScale","barBorder","sortLargestOnTop","selectRows"],defaultOptions:{labelPosition:"topLeft",labelColor:"black",labelTextOpacity:.4,valueScaling:"linear",trackBorderWidth:0,trackBorderColor:"black"}};var It=Vt;n({name:"StackedBarTrack",track:Ke,config:Ke.config}),n({name:"ScaledStackedBarTrack",track:pt,config:pt.config}),n({name:"BasicMultipleLineChart",track:Mt,config:Mt.config}),n({name:"BasicMultipleBarChart",track:It,config:It.config})}])}));