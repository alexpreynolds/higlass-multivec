!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["higlass-multivec"]=e():t["higlass-multivec"]=e()}(window,(function(){return function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r(r.s=4)}([,function(t,e,r){"use strict";var i,n,a;n=[e],void 0===(a="function"==typeof(i=function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=t._cachedApplicationRef=Symbol("_cachedApplicationRef"),r=t._mixinRef=Symbol("_mixinRef"),i=t._originalMixin=Symbol("_originalMixin"),n=t.wrap=(t,e)=>(Object.setPrototypeOf(e,t),t[i]||(t[i]=t),e),a=t.Cached=t=>n(t,r=>{let i=t[e];if(i||(i=t[e]=Symbol(t.name)),r.hasOwnProperty(i))return r[i];let n=t(r);return r[i]=n,n}),o=t.HasInstance=t=>(Symbol.hasInstance&&!t.hasOwnProperty(Symbol.hasInstance)&&Object.defineProperty(t,Symbol.hasInstance,{value:function(t){const e=this[i];for(;null!=t;){if(t.hasOwnProperty(r)&&t[r]===e)return!0;t=Object.getPrototypeOf(t)}return!1}}),t),l=t.BareMixin=t=>n(t,e=>{let n=t(e);return n.prototype[r]=t[i],n});t.Mixin=t=>a(o(l(t))),t.mix=t=>new s(t);class s{constructor(t){this.superclass=t}with(){return Array.from(arguments).reduce((t,e)=>e(t),this.superclass)}}})?i.apply(e,n):i)||(t.exports=a)},,,function(t,e,r){"use strict";r.r(e),r.d(e,"StackedBarTrack",(function(){return Kt})),r.d(e,"ScaledStackedBarTrack",(function(){return pe})),r.d(e,"BasicMultipleLineChart",(function(){return Me})),r.d(e,"BasicMultipleBarChart",(function(){return Ve})),window.higlassTracks=window.higlassTracks||{},window.higlassTracksByType=window.higlassTracksByType||{},window.higlassDataFetchersByType=window.higlassDataFetchersByType||{};const i=()=>Math.random().toString(36).substring(2,8);var n=(t,e={})=>{const{pluginType:r="track"}=e;"track"===r?((t,{force:e=!1}={})=>{let r=i();for(;window.higlassTracks[r];)r=i();t.name=r,window.higlassTracks[t.name]=t,window.higlassTracksByType[t.config.type]&&!e?console.warn(`A track with the same type (${t.config.type}) was already registered. To override it, set force to true.`):window.higlassTracksByType[t.config.type]=t})(t,e):"dataFetcher"===r&&((t,{force:e=!1}={})=>{window.higlassDataFetchersByType[t.config.type]&&!e?console.warn(`A data fetcher with the same type (${t.config.type}) was already registered. To override it, set force to true.`):window.higlassDataFetchersByType[t.config.type]=t})(t,e)};const a=Math.sqrt(50),o=Math.sqrt(10),l=Math.sqrt(2);function s(t,e,r){const i=(e-t)/Math.max(0,r),n=Math.floor(Math.log10(i)),u=i/Math.pow(10,n),c=u>=a?10:u>=o?5:u>=l?2:1;let h,v,f;return n<0?(f=Math.pow(10,-n)/c,h=Math.round(t*f),v=Math.round(e*f),h/f<t&&++h,v/f>e&&--v,f=-f):(f=Math.pow(10,n)*c,h=Math.round(t/f),v=Math.round(e/f),h*f<t&&++h,v*f>e&&--v),v<h&&.5<=r&&r<2?s(t,e,2*r):[h,v,f]}function u(t,e,r){return s(t=+t,e=+e,r=+r)[2]}function c(t,e){return null==t||null==e?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function h(t,e){return null==t||null==e?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function v(t){let e,r,i;function n(t,i,n=0,a=t.length){if(n<a){if(0!==e(i,i))return a;do{const e=n+a>>>1;r(t[e],i)<0?n=e+1:a=e}while(n<a)}return n}return 2!==t.length?(e=c,r=(e,r)=>c(t(e),r),i=(e,r)=>t(e)-r):(e=t===c||t===h?t:f,r=t,i=t),{left:n,center:function(t,e,r=0,a=t.length){const o=n(t,e,r,a-1);return o>r&&i(t[o-1],e)>-i(t[o],e)?o-1:o},right:function(t,i,n=0,a=t.length){if(n<a){if(0!==e(i,i))return a;do{const e=n+a>>>1;r(t[e],i)<=0?n=e+1:a=e}while(n<a)}return n}}}function f(){return 0}const d=v(c),p=d.right;d.left,v((function(t){return null===t?NaN:+t})).center;var m=p,g=function(t,e,r){t.prototype=e.prototype=r,r.constructor=t};function y(t,e){var r=Object.create(t.prototype);for(var i in e)r[i]=e[i];return r}function b(){}var x="\\s*([+-]?\\d+)\\s*",w="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",k="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",M=/^#([0-9a-f]{3,8})$/,A=new RegExp("^rgb\\("+[x,x,x]+"\\)$"),S=new RegExp("^rgb\\("+[k,k,k]+"\\)$"),D=new RegExp("^rgba\\("+[x,x,x,w]+"\\)$"),T=new RegExp("^rgba\\("+[k,k,k,w]+"\\)$"),O=new RegExp("^hsl\\("+[w,k,k]+"\\)$"),_=new RegExp("^hsla\\("+[w,k,k,w]+"\\)$"),C={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function z(){return this.rgb().formatHex()}function I(){return this.rgb().formatRgb()}function V(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=M.exec(t))?(r=e[1].length,e=parseInt(e[1],16),6===r?F(e):3===r?new R(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===r?P(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===r?P(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=A.exec(t))?new R(e[1],e[2],e[3],1):(e=S.exec(t))?new R(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=D.exec(t))?P(e[1],e[2],e[3],e[4]):(e=T.exec(t))?P(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=O.exec(t))?H(e[1],e[2]/100,e[3]/100,1):(e=_.exec(t))?H(e[1],e[2]/100,e[3]/100,e[4]):C.hasOwnProperty(t)?F(C[t]):"transparent"===t?new R(NaN,NaN,NaN,0):null}function F(t){return new R(t>>16&255,t>>8&255,255&t,1)}function P(t,e,r,i){return i<=0&&(t=e=r=NaN),new R(t,e,r,i)}function B(t){return t instanceof b||(t=V(t)),t?new R((t=t.rgb()).r,t.g,t.b,t.opacity):new R}function E(t,e,r,i){return 1===arguments.length?B(t):new R(t,e,r,null==i?1:i)}function R(t,e,r,i){this.r=+t,this.g=+e,this.b=+r,this.opacity=+i}function j(){return"#"+G(this.r)+G(this.g)+G(this.b)}function N(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function G(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function H(t,e,r,i){return i<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new X(t,e,r,i)}function L(t){if(t instanceof X)return new X(t.h,t.s,t.l,t.opacity);if(t instanceof b||(t=V(t)),!t)return new X;if(t instanceof X)return t;var e=(t=t.rgb()).r/255,r=t.g/255,i=t.b/255,n=Math.min(e,r,i),a=Math.max(e,r,i),o=NaN,l=a-n,s=(a+n)/2;return l?(o=e===a?(r-i)/l+6*(r<i):r===a?(i-e)/l+2:(e-r)/l+4,l/=s<.5?a+n:2-a-n,o*=60):l=s>0&&s<1?0:o,new X(o,l,s,t.opacity)}function X(t,e,r,i){this.h=+t,this.s=+e,this.l=+r,this.opacity=+i}function Y(t,e,r){return 255*(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)}function W(t,e,r,i,n){var a=t*t,o=a*t;return((1-3*t+3*a-o)*e+(4-6*a+3*o)*r+(1+3*t+3*a-3*o)*i+o*n)/6}g(b,V,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:z,formatHex:z,formatHsl:function(){return L(this).formatHsl()},formatRgb:I,toString:I}),g(R,E,y(b,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new R(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new R(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:j,formatHex:j,formatRgb:N,toString:N})),g(X,(function(t,e,r,i){return 1===arguments.length?L(t):new X(t,e,r,null==i?1:i)}),y(b,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new X(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new X(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*e,n=2*r-i;return new R(Y(t>=240?t-240:t+120,n,i),Y(t,n,i),Y(t<120?t+240:t-120,n,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var q=function(t){return function(){return t}};function U(t,e){return function(r){return t+r*e}}function $(t){return 1==(t=+t)?Z:function(e,r){return r-e?function(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(i){return Math.pow(t+i*e,r)}}(e,r,t):q(isNaN(e)?r:e)}}function Z(t,e){var r=e-t;return r?U(t,r):q(isNaN(t)?e:t)}var J=function t(e){var r=$(e);function i(t,e){var i=r((t=E(t)).r,(e=E(e)).r),n=r(t.g,e.g),a=r(t.b,e.b),o=Z(t.opacity,e.opacity);return function(e){return t.r=i(e),t.g=n(e),t.b=a(e),t.opacity=o(e),t+""}}return i.gamma=t,i}(1);function K(t){return function(e){var r,i,n=e.length,a=new Array(n),o=new Array(n),l=new Array(n);for(r=0;r<n;++r)i=E(e[r]),a[r]=i.r||0,o[r]=i.g||0,l[r]=i.b||0;return a=t(a),o=t(o),l=t(l),i.opacity=1,function(t){return i.r=a(t),i.g=o(t),i.b=l(t),i+""}}}K((function(t){var e=t.length-1;return function(r){var i=r<=0?r=0:r>=1?(r=1,e-1):Math.floor(r*e),n=t[i],a=t[i+1],o=i>0?t[i-1]:2*n-a,l=i<e-1?t[i+2]:2*a-n;return W((r-i/e)*e,o,n,a,l)}})),K((function(t){var e=t.length;return function(r){var i=Math.floor(((r%=1)<0?++r:r)*e),n=t[(i+e-1)%e],a=t[i%e],o=t[(i+1)%e],l=t[(i+2)%e];return W((r-i/e)*e,n,a,o,l)}}));var Q=function(t,e){e||(e=[]);var r,i=t?Math.min(e.length,t.length):0,n=e.slice();return function(a){for(r=0;r<i;++r)n[r]=t[r]*(1-a)+e[r]*a;return n}};function tt(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function et(t,e){var r,i=e?e.length:0,n=t?Math.min(i,t.length):0,a=new Array(n),o=new Array(i);for(r=0;r<n;++r)a[r]=st(t[r],e[r]);for(;r<i;++r)o[r]=e[r];return function(t){for(r=0;r<n;++r)o[r]=a[r](t);return o}}var rt=function(t,e){var r=new Date;return t=+t,e=+e,function(i){return r.setTime(t*(1-i)+e*i),r}},it=function(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}},nt=function(t,e){var r,i={},n={};for(r in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)r in t?i[r]=st(t[r],e[r]):n[r]=e[r];return function(t){for(r in i)n[r]=i[r](t);return n}},at=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ot=new RegExp(at.source,"g");var lt=function(t,e){var r,i,n,a=at.lastIndex=ot.lastIndex=0,o=-1,l=[],s=[];for(t+="",e+="";(r=at.exec(t))&&(i=ot.exec(e));)(n=i.index)>a&&(n=e.slice(a,n),l[o]?l[o]+=n:l[++o]=n),(r=r[0])===(i=i[0])?l[o]?l[o]+=i:l[++o]=i:(l[++o]=null,s.push({i:o,x:it(r,i)})),a=ot.lastIndex;return a<e.length&&(n=e.slice(a),l[o]?l[o]+=n:l[++o]=n),l.length<2?s[0]?function(t){return function(e){return t(e)+""}}(s[0].x):function(t){return function(){return t}}(e):(e=s.length,function(t){for(var r,i=0;i<e;++i)l[(r=s[i]).i]=r.x(t);return l.join("")})},st=function(t,e){var r,i=typeof e;return null==e||"boolean"===i?q(e):("number"===i?it:"string"===i?(r=V(e))?(e=r,J):lt:e instanceof V?J:e instanceof Date?rt:tt(e)?Q:Array.isArray(e)?et:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?nt:it)(t,e)},ut=function(t,e){return t=+t,e=+e,function(r){return Math.round(t*(1-r)+e*r)}};function ct(t){return+t}var ht=[0,1];function vt(t){return t}function ft(t,e){return(e-=t=+t)?function(r){return(r-t)/e}:(r=isNaN(e)?NaN:.5,function(){return r});var r}function dt(t,e,r){var i=t[0],n=t[1],a=e[0],o=e[1];return n<i?(i=ft(n,i),a=r(o,a)):(i=ft(i,n),a=r(a,o)),function(t){return a(i(t))}}function pt(t,e,r){var i=Math.min(t.length,e.length)-1,n=new Array(i),a=new Array(i),o=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<i;)n[o]=ft(t[o],t[o+1]),a[o]=r(e[o],e[o+1]);return function(e){var r=m(t,e,1,i)-1;return a[r](n[r](e))}}function mt(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function gt(){var t,e,r,i,n,a,o=ht,l=ht,s=st,u=vt;function c(){var t,e,r,s=Math.min(o.length,l.length);return u!==vt&&(t=o[0],e=o[s-1],t>e&&(r=t,t=e,e=r),u=function(r){return Math.max(t,Math.min(e,r))}),i=s>2?pt:dt,n=a=null,h}function h(e){return null==e||isNaN(e=+e)?r:(n||(n=i(o.map(t),l,s)))(t(u(e)))}return h.invert=function(r){return u(e((a||(a=i(l,o.map(t),it)))(r)))},h.domain=function(t){return arguments.length?(o=Array.from(t,ct),c()):o.slice()},h.range=function(t){return arguments.length?(l=Array.from(t),c()):l.slice()},h.rangeRound=function(t){return l=Array.from(t),s=ut,c()},h.clamp=function(t){return arguments.length?(u=!!t||vt,c()):u!==vt},h.interpolate=function(t){return arguments.length?(s=t,c()):s},h.unknown=function(t){return arguments.length?(r=t,h):r},function(r,i){return t=r,e=i,c()}}function yt(){return gt()(vt,vt)}function bt(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}var xt=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function wt(t){if(!(e=xt.exec(t)))throw new Error("invalid format: "+t);var e;return new kt({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function kt(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}wt.prototype=kt.prototype,kt.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};function Mt(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,i=t.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+t.slice(r+1)]}var At,St,Dt,Tt,Ot=function(t){return(t=Mt(Math.abs(t)))?t[1]:NaN},_t=function(t,e){var r=Mt(t,e);if(!r)return t+"";var i=r[0],n=r[1];return n<0?"0."+new Array(-n).join("0")+i:i.length>n+1?i.slice(0,n+1)+"."+i.slice(n+1):i+new Array(n-i.length+2).join("0")},Ct={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>_t(100*t,e),r:_t,s:function(t,e){var r=Mt(t,e);if(!r)return t+"";var i=r[0],n=r[1],a=n-(At=3*Math.max(-8,Math.min(8,Math.floor(n/3))))+1,o=i.length;return a===o?i:a>o?i+new Array(a-o+1).join("0"):a>0?i.slice(0,a)+"."+i.slice(a):"0."+new Array(1-a).join("0")+Mt(t,Math.max(0,e+a-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)},zt=function(t){return t},It=Array.prototype.map,Vt=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];St=function(t){var e,r,i=void 0===t.grouping||void 0===t.thousands?zt:(e=It.call(t.grouping,Number),r=t.thousands+"",function(t,i){for(var n=t.length,a=[],o=0,l=e[0],s=0;n>0&&l>0&&(s+l+1>i&&(l=Math.max(1,i-s)),a.push(t.substring(n-=l,n+l)),!((s+=l+1)>i));)l=e[o=(o+1)%e.length];return a.reverse().join(r)}),n=void 0===t.currency?"":t.currency[0]+"",a=void 0===t.currency?"":t.currency[1]+"",o=void 0===t.decimal?".":t.decimal+"",l=void 0===t.numerals?zt:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(It.call(t.numerals,String)),s=void 0===t.percent?"%":t.percent+"",u=void 0===t.minus?"−":t.minus+"",c=void 0===t.nan?"NaN":t.nan+"";function h(t){var e=(t=wt(t)).fill,r=t.align,h=t.sign,v=t.symbol,f=t.zero,d=t.width,p=t.comma,m=t.precision,g=t.trim,y=t.type;"n"===y?(p=!0,y="g"):Ct[y]||(void 0===m&&(m=12),g=!0,y="g"),(f||"0"===e&&"="===r)&&(f=!0,e="0",r="=");var b="$"===v?n:"#"===v&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",x="$"===v?a:/[%p]/.test(y)?s:"",w=Ct[y],k=/[defgprs%]/.test(y);function M(t){var n,a,s,v=b,M=x;if("c"===y)M=w(t)+M,t="";else{var A=(t=+t)<0||1/t<0;if(t=isNaN(t)?c:w(Math.abs(t),m),g&&(t=function(t){t:for(var e,r=t.length,i=1,n=-1;i<r;++i)switch(t[i]){case".":n=e=i;break;case"0":0===n&&(n=i),e=i;break;default:if(!+t[i])break t;n>0&&(n=0)}return n>0?t.slice(0,n)+t.slice(e+1):t}(t)),A&&0==+t&&"+"!==h&&(A=!1),v=(A?"("===h?h:u:"-"===h||"("===h?"":h)+v,M=("s"===y?Vt[8+At/3]:"")+M+(A&&"("===h?")":""),k)for(n=-1,a=t.length;++n<a;)if(48>(s=t.charCodeAt(n))||s>57){M=(46===s?o+t.slice(n+1):t.slice(n))+M,t=t.slice(0,n);break}}p&&!f&&(t=i(t,1/0));var S=v.length+t.length+M.length,D=S<d?new Array(d-S+1).join(e):"";switch(p&&f&&(t=i(D+t,D.length?d-M.length:1/0),D=""),r){case"<":t=v+t+M+D;break;case"=":t=v+D+t+M;break;case"^":t=D.slice(0,S=D.length>>1)+v+t+M+D.slice(S);break;default:t=D+v+t+M}return l(t)}return m=void 0===m?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),M.toString=function(){return t+""},M}return{format:h,formatPrefix:function(t,e){var r=h(((t=wt(t)).type="f",t)),i=3*Math.max(-8,Math.min(8,Math.floor(Ot(e)/3))),n=Math.pow(10,-i),a=Vt[8+i/3];return function(t){return r(n*t)+a}}}}({thousands:",",grouping:[3],currency:["$",""]}),Dt=St.format,Tt=St.formatPrefix;function Ft(t,e,r,i){var n,a=function(t,e,r){r=+r;const i=(e=+e)<(t=+t),n=i?u(e,t,r):u(t,e,r);return(i?-1:1)*(n<0?1/-n:n)}(t,e,r);switch((i=wt(null==i?",f":i)).type){case"s":var o=Math.max(Math.abs(t),Math.abs(e));return null!=i.precision||isNaN(n=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Ot(e)/3)))-Ot(Math.abs(t)))}(a,o))||(i.precision=n),Tt(i,o);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(n=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Ot(e)-Ot(t))+1}(a,Math.max(Math.abs(t),Math.abs(e))))||(i.precision=n-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(n=function(t){return Math.max(0,-Ot(Math.abs(t)))}(a))||(i.precision=n-2*("%"===i.type))}return Dt(i)}function Pt(t){var e=t.domain;return t.ticks=function(t){var r=e();return function(t,e,r){if(!((r=+r)>0))return[];if((t=+t)===(e=+e))return[t];const i=e<t,[n,a,o]=i?s(e,t,r):s(t,e,r);if(!(a>=n))return[];const l=a-n+1,u=new Array(l);if(i)if(o<0)for(let t=0;t<l;++t)u[t]=(a-t)/-o;else for(let t=0;t<l;++t)u[t]=(a-t)*o;else if(o<0)for(let t=0;t<l;++t)u[t]=(n+t)/-o;else for(let t=0;t<l;++t)u[t]=(n+t)*o;return u}(r[0],r[r.length-1],null==t?10:t)},t.tickFormat=function(t,r){var i=e();return Ft(i[0],i[i.length-1],null==t?10:t,r)},t.nice=function(r){null==r&&(r=10);var i,n,a=e(),o=0,l=a.length-1,s=a[o],c=a[l],h=10;for(c<s&&(n=s,s=c,c=n,n=o,o=l,l=n);h-- >0;){if((n=u(s,c,r))===i)return a[o]=s,a[l]=c,e(a);if(n>0)s=Math.floor(s/n)*n,c=Math.ceil(c/n)*n;else{if(!(n<0))break;s=Math.ceil(s*n)/n,c=Math.floor(c*n)/n}i=n}return t},t}function Bt(){var t=yt();return t.copy=function(){return mt(t,Bt())},bt.apply(t,arguments),Pt(t)}class Et extends Map{constructor(t,e=Gt){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),null!=t)for(const[e,r]of t)this.set(e,r)}get(t){return super.get(Rt(this,t))}has(t){return super.has(Rt(this,t))}set(t,e){return super.set(jt(this,t),e)}delete(t){return super.delete(Nt(this,t))}}Set;function Rt({_intern:t,_key:e},r){const i=e(r);return t.has(i)?t.get(i):r}function jt({_intern:t,_key:e},r){const i=e(r);return t.has(i)?t.get(i):(t.set(i,r),r)}function Nt({_intern:t,_key:e},r){const i=e(r);return t.has(i)&&(r=t.get(r),t.delete(i)),r}function Gt(t){return null!==t&&"object"==typeof t?t.valueOf():t}const Ht=Symbol("implicit");function Lt(){var t=new Et,e=[],r=[],i=Ht;function n(n){let a=t.get(n);if(void 0===a){if(i!==Ht)return i;t.set(n,a=e.push(n)-1)}return r[a%r.length]}return n.domain=function(r){if(!arguments.length)return e.slice();e=[],t=new Et;for(const i of r)t.has(i)||t.set(i,e.push(i)-1);return n},n.range=function(t){return arguments.length?(r=Array.from(t),n):r.slice()},n.unknown=function(t){return arguments.length?(i=t,n):i},n.copy=function(){return Lt(e,r).unknown(i)},bt.apply(n,arguments),n}var Xt=function(t){for(var e=t.length/6|0,r=new Array(e),i=0;i<e;)r[i]="#"+t.slice(6*i,6*++i);return r}("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),Yt=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&l.return&&l.return()}finally{if(n)throw a}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},Wt=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),qt=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var o=n.get;return void 0!==o?o.call(i):void 0};function Ut(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function $t(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function Zt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var Jt=function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];if(!new.target)throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');var n=t.services,a=n.tileProxy,o=n.pixiRenderer,l=t.utils,s=l.colorToHex,u=l.absToChr,c=function(e){function r(t,e){Ut(this,r);var i=$t(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,e));return i.initializeStackedBarTrack(),i}return Zt(r,e),Wt(r,[{key:"initializeStackedBarTrack",value:function(){this.stackedBarTrackInitialized||(this.maxAndMin={max:null,min:null},this.textureGraphics=new t.libraries.PIXI.Graphics,this.stackedBarTrackInitialized=!0)}},{key:"createColorScale",value:function(){if(!this.options.colorScale)if(this.tilesetInfo.row_infos&&this.tilesetInfo.row_infos[0].color)this.options.colorScale=this.tilesetInfo.row_infos.map((function(t){return t.color}));else{this.options.colorScale=["#FF0000","#FF4500","#32CD32","#008000","#006400","#C2E105","#FFFF00","#66CDAA","#8A91D0","#CD5C5C","#E9967A","#BDB76B","#808080","#C0C0C0","#FFFFFF"]}}},{key:"initTile",value:function(t){if(this.createColorScale(),this.initializeStackedBarTrack(),this.scale.minRawValue=this.minVisibleValue(),this.scale.maxRawValue=this.maxVisibleValue(),this.scale.minValue=this.scale.minRawValue,this.scale.maxValue=this.scale.maxRawValue,this.options.globalMinMax)this.maxAndMin.min=this.options.globalMinMax.min,this.maxAndMin.max=this.options.globalMinMax.max;else if(this.maxAndMin.min=this.minValueInArray(t.tileData.dense),this.maxAndMin.max=this.maxValueInArray(t.tileData.dense),this.isValueScaleLocked()){var e=this.getLockGroupExtrema();null!==e&&(this.maxAndMin.min=1.05*e[0],this.maxAndMin.max=1.05*e[1])}this.numCategories=this.options.selectRows?this.options.selectRows.length:t.tileData.shape[0],this.localColorToHexScale(),this.unFlatten(t),this.renderTile(t),this.rescaleTiles()}},{key:"destroyTile",value:function(t){t.sprite.destroy(!0),t.graphics.destroy(!0),t.graphics=null,t.sprite=null}},{key:"rerender",value:function(t){qt(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"rerender",this).call(this,t),this.options=t;for(var e=this.visibleAndFetchedTiles(),i=0;i<e.length;i++){var n=e[i];n.matrix=null,this.updateTile(n)}for(var a=0;a<e.length;a++){var o=e[a];this.renderTile(o)}this.rescaleTiles(),this.draw()}},{key:"updateTile",value:function(){for(var t=this.visibleAndFetchedTiles(),e=0;e<t.length;e++){var r=t[e];this.unFlatten(r)}if(this.isValueScaleLocked()){var i=this.getLockGroupExtrema();null!==i&&(this.maxAndMin.min=1.05*i[0],this.maxAndMin.max=1.05*i[1]),this.rescaleTiles()}this.rescaleTiles()}},{key:"drawTile",value:function(t){}},{key:"calculateVisibleTiles",value:function(){var t=this;if(this.tilesetInfo)if(this.zoomLevel=this.calculateZoomLevel(),this.tilesetInfo.resolutions){var e=this.tilesetInfo.resolutions.map((function(t){return+t})).sort((function(t,e){return e-t})),r=a.calculateTilesFromResolution(e[this.zoomLevel],this._xScale,this.tilesetInfo.min_pos[0],this.tilesetInfo.max_pos[0],this.tilesetInfo.tile_size).map((function(e){return[t.zoomLevel,e]}));this.setVisibleTiles(r)}else{var i=api.calculateTiles(this.zoomLevel,this.relevantScale(),this.tilesetInfo.min_pos[0],this.tilesetInfo.max_pos[0],this.tilesetInfo.max_zoom,this.tilesetInfo.max_width).map((function(e){return[t.zoomLevel,e]}));this.setVisibleTiles(i)}}},{key:"renderTile",value:function(t){t.svgData=null,t.mouseOverData=null;var e=t.graphics;e.clear(),e.children.map((function(t){e.removeChild(t)})),t.drawnAtScale=this._xScale.copy();var r=this.getTilePosAndDimensions(t.tileData.zoomLevel,t.tileData.tilePos,this.tilesetInfo.tile_size),i=r.tileX,n=r.tileWidth,a=this.unFlatten(t);this.oldDimensions=this.dimensions;try{this.drawVerticalBars(this.mapOriginalColors(a),i,n,this.maxAndMin.max,this.maxAndMin.min,t),e.addChild(t.sprite),this.makeMouseOverData(t)}catch(t){}}},{key:"syncMaxAndMin",value:function(){var t=this,e=this.visibleAndFetchedTiles();this.maxAndMin.min=0,this.maxAndMin.max=0,e.map((function(e){e.minValue+e.maxValue>t.maxAndMin.min+t.maxAndMin.max&&(t.maxAndMin.min=e.minValue,t.maxAndMin.max=e.maxValue)}))}},{key:"rescaleTiles",value:function(){var t=this,e=this.visibleAndFetchedTiles();if(this.options.globalMinMax)this.maxAndMin.min=this.options.globalMinMax.min,this.maxAndMin.max=this.options.globalMinMax.max;else if(this.isValueScaleLocked()){var r=this.getLockGroupExtrema();null!==r&&(this.maxAndMin.min=1.05*r[0],this.maxAndMin.max=1.05*r[1])}else this.syncMaxAndMin();if(!0===this.options.symmetricRange){var i=Math.max(Math.abs(this.maxAndMin.min),this.maxAndMin.max);i+=.01*i,this.maxAndMin.min=-i,this.maxAndMin.max=i}e.map((function(e){var r=Bt().domain([0,t.maxAndMin.max+Math.abs(t.maxAndMin.min)]).range([0,t.dimensions[1]]),i=t.dimensions[1]-r(Math.abs(t.maxAndMin.min)),n=r(e.minValue+e.maxValue),a=e.sprite,o=i-r(e.maxValue);a&&(a.height=n,a.y=o)}))}},{key:"localColorToHexScale",value:function(){for(var t=this.options.colorScale||Lt(Xt),e={},r=0;r<t.length;r++)e[t[r]]=s(t[r]);this.colorHexMap=e}},{key:"findMaxAndMin",value:function(t){for(var e={max:null,min:null},r=0;r<t.length;r++){var i=t[r],n=i.filter((function(t){return t>=0})).reduce((function(t,e){return t+e}),0);n>e.max&&(e.max=n);var a=i.filter((function(t){return t<=0}));if(a.length>0){var o=(a=a.map((function(t){return Math.abs(t)}))).reduce((function(t,e){return t+e}),0);(null===e.min||o>e.min)&&(e.min=o)}}return e}},{key:"unFlatten",value:function(t){if(t.matrix)return t.matrix;var e=t.tileData.dense;e.filter((function(t){return t<0})).length>0&&"linear"===this.options.valueScaling&&(console.warn("Negative values present in data. Defaulting to exponential scale."),this.options.valueScaling="exponential");var r=this.simpleUnFlatten(t,e),i=this.findMaxAndMin(r);return t.matrix=r,t.maxValue=i.max,t.minValue=i.min,this.syncMaxAndMin(),r}},{key:"simpleUnFlatten",value:function(t,e){for(var r=this,i=this.numCategories,n=t.tileData.shape[1],a=[],o=0;o<i;o++)for(var l=function(t){var i=void 0;if(i=void 0===a[t]?[]:a[t],r.options.selectRows){var l=r.options.selectRows[o];if(Array.isArray(l)){var s=l.reduce((function(r,i){return r+e[n*i+t]}),0);i.push(s)}else i.push(e[n*l+t])}else i.push(e[n*o+t]);a[t]=i},s=0;s<n;s++)l(s);return"log"===this.options.valueScaling&&function(){for(var t=null==r.options.pseudocount?1:r.options.pseudocount,e=function(e){var r=a[e].map((function(e){return e+t})),i=r.reduce((function(t,e){return t+e}),0),n=r.map((function(t){return Math.log(t)})),o=n.reduce((function(t,e){return t+e}),0),l=Math.log(i),s=n.map((function(t){return t/o*l}));a[e]=s},i=0;i<n;i++)e(i)}(),a}},{key:"mapOriginalColors",value:function(t){for(var e=this.options.colorScale||Lt(Xt),r=[],i=0;i<t.length;i++){for(var n=[],a=0;a<t[i].length;a++)n[a]={value:isNaN(t[i][a])?0:t[i][a],color:e[a]};for(var o=[],l=[],s=0;s<n.length;s++)n[s].value>=0?o.push(n[s]):n[s].value<0&&l.push(n[s]);this.options.sortLargestOnTop?(o.sort((function(t,e){return t.value-e.value})),l.sort((function(t,e){return e.value-t.value}))):(o.sort((function(t,e){return e.value-t.value})),l.sort((function(t,e){return t.value-e.value}))),r.push([o,l])}return r}},{key:"drawVerticalBars",value:function(e,r,i,n,a,l){this.textureGraphics.clear();var s=this.dimensions[1],u=n+Math.abs(a),c=n*s/u,h=Math.abs(a)*s/u,v=this.dimensions[1],f=new t.libraries.PIXI.Graphics;this.drawBackground(e,this.textureGraphics);var d=this._xScale(r+i)-this._xScale(r);this.options.barBorder&&this.textureGraphics.lineStyle(1,0,1);var p=[];function m(r){var i=256/e.length*d,n=o.generateTexture(this.textureGraphics,t.libraries.PIXI.SCALE_MODES.NEAREST),a=new t.libraries.PIXI.Sprite(n);a.width=i,a.x=(r-256)/e.length*d,f.addChild(a),p.push({sprite:a,height:n.height}),this.textureGraphics.clear(),this.drawBackground(e,this.textureGraphics)}for(var g=0;g<e.length;g++){var y=10*g;0===g&&y,g>0&&g%256==0&&m.bind(this)(g);for(var b=e[g][0],x=Bt().domain([0,n]).range([0,c]),w=0,k=0;k<b.length;k++){var M=x(b[k].value),A=c-(w+M);this.addSVGInfo(l,y,A,10,M,b[k].color),this.textureGraphics.beginFill(this.colorHexMap[b[k].color]),this.textureGraphics.drawRect(y,A,10,M),w+=M,v>A&&(v=A)}if(Math.abs(a)>0)for(var S=e[g][1],D=Bt().domain([-Math.abs(a),0]).range([h,0]),T=0,O=0;O<S.length;O++){var _=D(S[O].value),C=c+T;this.addSVGInfo(l,y,C,10,_,S[O].color),this.textureGraphics.beginFill(this.colorHexMap[S[O].color]),this.textureGraphics.drawRect(y,C,10,_),T+=_}}m.bind(this)(e.length);for(var z=p.reduceRight((function(t,e){return Math.max(t,e.height)}),0),I=0;I<p.length;I++){p[I].sprite.y=z-p[I].height}f.width=d,f.x=this._xScale(r),l.sprite=f,l.lowestY=v}},{key:"draw",value:function(){qt(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"draw",this).call(this)}},{key:"addSVGInfo",value:function(t,e,r,i,n,a){t.hasOwnProperty("svgData")&&null!==t.svgData?(t.svgData.barXValues.push(e),t.svgData.barYValues.push(r),t.svgData.barWidths.push(i),t.svgData.barHeights.push(n),t.svgData.barColors.push(a)):t.svgData={barXValues:[e],barYValues:[r],barWidths:[i],barHeights:[n],barColors:[a]}}},{key:"setDimensions",value:function(t){var e=this;this.oldDimensions=this.dimensions,qt(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"setDimensions",this).call(this,t),this.visibleAndFetchedTiles().map((function(t){return e.initTile(t)}))}},{key:"minValueInArray",value:function(t){for(var e=t[0],r=1;r<t.length;r++){var i=t[r];e=i<e?i:e}return e}},{key:"maxValueInArray",value:function(t){for(var e=t[0],r=1;r<t.length;r++){var i=t[r];e=i>e?i:e}return e}},{key:"makeMouseOverData",value:function(t){for(var e=this.numCategories,r=t.tileData.shape[1],i=t.svgData.barYValues,n=t.svgData.barHeights,a=t.svgData.barColors,o=[],l=0;l<e;l++)for(var s=0;s<r;s++){var u=s*e+l,c={y:i[u],height:n[u],color:a[u]};void 0===o[s]?o[s]=[c]:o[s].push(c)}for(var h=0;h<o.length;h++)o[h]=o[h].sort((function(t,e){return t.y-e.y}));t.mouseOverData=o}},{key:"exportSVG",value:function(){var t=this;this.visibleAndFetchedTiles().map((function(e){t.initTile(e),t.draw()}));var e=null,i=null;e=i=document.createElement("g");var n=qt(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"superSVG",this).call(this),a=Yt(n,2);i=a[0],e=a[1];var o=document.createElement("g");e.appendChild(o),o.setAttribute("transform","translate("+this.pMain.position.x+","+this.pMain.position.y+") scale("+this.pMain.scale.x+","+this.pMain.scale.y+")");var l=!0,s=!1,u=void 0;try{for(var c,h=this.visibleAndFetchedTiles()[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var v=c.value,f=document.createElement("g");f.setAttribute("transform"," translate("+v.sprite.x+","+v.sprite.y+") rotate(0) scale("+v.sprite.scale.x+","+v.sprite.scale.y+") ");for(var d=v.svgData,p=0;p<d.barXValues.length;p++){var m=document.createElement("rect");m.setAttribute("fill",d.barColors[p]),m.setAttribute("stroke",d.barColors[p]),m.setAttribute("x",d.barXValues[p]),m.setAttribute("y",d.barYValues[p]-v.lowestY),m.setAttribute("height",d.barHeights[p]),m.setAttribute("width",d.barWidths[p]),this.options.barBorder&&(m.setAttribute("stroke-width","0.1"),m.setAttribute("stroke","black")),f.appendChild(m)}o.appendChild(f)}}catch(t){s=!0,u=t}finally{try{!l&&h.return&&h.return()}finally{if(s)throw u}}return[i,i]}},{key:"getMouseOverHtml",value:function(t,e){if(!this.tilesetInfo)return"";var r=this.options.colorScale||Lt(Xt),i=this.calculateZoomLevel(),n=a.calculateTileWidth(this.tilesetInfo,i,this.tilesetInfo.tile_size),o=this._xScale.invert(t)/n,l=Math.floor(this.tilesetInfo.tile_size*(o-Math.floor(o))),s=this.tileToLocalId([i,Math.floor(o)]),c=this.fetchedTiles[s];if(!c)return"";for(var h=c.matrix[l],v=c.mouseOverData[l],f=(e-c.sprite.y)/c.sprite.scale.y+c.lowestY,d={},p=0;p<r.length;p++)d[r[p]]=p;if(f<v[0].y||f>=v[v.length-1].y+v[v.length-1].height)return"";for(var m=0;m<v.length;m++){var g=v[m].y,y=v[m].height;if(f>g&&f<=g+y){var b=v[m].color,x=Number.parseFloat(h[d[b]]).toPrecision(4).toString(),w=this.tilesetInfo.row_infos[d[b]],k=this._xScale.invert(t),M=null;if(this.options.chromInfo&&this.options.binSize){var A=u(k,this.options.chromInfo);M=A[0]+":"+(Math.ceil(A[1]/this.options.binSize)*this.options.binSize-this.options.binSize)}var S='<div class="track-mouseover-menu-table">';return M&&(S+='\n              <div class="track-mouseover-menu-table-item">\n                <label for="position" class="track-mouseover-menu-table-item-label">Position</label>\n                <div name="position" class="track-mouseover-menu-table-item-value">'+M+"</div>\n              </div>\n              "),S+='<div class="track-mouseover-menu-table-item">\n              <label for="binScore" class="track-mouseover-menu-table-item-label">Score</label>\n              <div name="binScore" class="track-mouseover-menu-table-item-value">'+x+"</div>\n            </div>",S+='\n              <div class="track-mouseover-menu-table-item">\n                <label for="stateName" class="track-mouseover-menu-table-item-label">Chromatin state</label>\n                <div name="stateName" class="track-mouseover-menu-table-item-value">'+('<svg width="10" height="10" style="position:relative; top:-2px;"><rect width="10" height="10" rx="2" ry="2" style="fill:'+b+';stroke:black;stroke-width:2;"></svg> '+w)+"</div>\n              </div>",S+="</div>"}}}}]),r}(t.tracks.BarTrack);return new(Function.prototype.bind.apply(c,[null].concat(r)))};Jt.config={type:"horizontal-stacked-bar",datatype:["multivec","epilogos"],local:!1,orientation:"1d-horizontal",thumbnail:(new DOMParser).parseFromString('<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 5640 5420" preserveAspectRatio="xMidYMid meet"> <g id="layer101" fill="#000000" stroke="none"> <path d="M0 2710 l0 -2710 2820 0 2820 0 0 2710 0 2710 -2820 0 -2820 0 0 -2710z"/> </g> <g id="layer102" fill="#750075" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> <path d="M4340 2710 l0 -2510 560 0 560 0 0 2510 0 2510 -560 0 -560 0 0 -2510z"/> <path d="M200 1870 l0 -1670 630 0 630 0 0 1670 0 1670 -630 0 -630 0 0 -1670z"/> <path d="M1660 1810 l0 -1610 570 0 570 0 0 1610 0 1610 -570 0 -570 0 0 -1610z"/> <path d="M3000 840 l0 -640 570 0 570 0 0 640 0 640 -570 0 -570 0 0 -640z"/> </g> <g id="layer103" fill="#ffff04" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> </g> </svg>',"text/xml").documentElement,availableOptions:["labelPosition","labelColor","valueScaling","labelTextOpacity","labelBackgroundOpacity","trackBorderWidth","trackBorderColor","trackType","scaledHeight","backgroundColor","colorScale","barBorder","sortLargestOnTop","selectRows"],defaultOptions:{labelPosition:"topLeft",labelColor:"black",labelTextOpacity:.4,valueScaling:"linear",trackBorderWidth:0,trackBorderColor:"black",backgroundColor:"white",barBorder:!0,sortLargestOnTop:!0,selectRows:null},otherOptions:{epilogos:{scaledHeight:!1}}};var Kt=Jt,Qt=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&l.return&&l.return()}finally{if(n)throw a}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},te=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),ee=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var o=n.get;return void 0!==o?o.call(i):void 0};function re(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function ie(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ne(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function ae(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var oe=function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];if(!new.target)throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');var n=t.services,a=n.tileProxy,o=n.pixiRenderer,l=t.utils,s=l.absToChr,u=l.colorToHex,c=function(e){function r(t,e){ie(this,r);var i=ne(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,e));return i.initializeStackedDeltaBarTrack(),i}return ae(r,e),te(r,[{key:"initializeStackedDeltaBarTrack",value:function(){this.stackedDeltaBarTrackInitialized||(this.maxAndMin={max:null,min:null},this.textureGraphics=new t.libraries.PIXI.Graphics,this.stackedDeltaBarTrackInitialized=!0)}},{key:"createColorScale",value:function(){if(!this.options.colorScale)if(this.tilesetInfo.row_infos&&this.tilesetInfo.row_infos[0].color)this.options.colorScale=this.tilesetInfo.row_infos.map((function(t){return t.color}));else{this.options.colorScale=["#FF0000","#FF4500","#32CD32","#008000","#006400","#C2E105","#FFFF00","#66CDAA","#8A91D0","#CD5C5C","#E9967A","#BDB76B","#808080","#C0C0C0","#FFFFFF"]}}},{key:"initTile",value:function(t){this.createColorScale(),this.initializeStackedDeltaBarTrack(),this.scale.minRawValue=this.minVisibleValue(),this.scale.maxRawValue=this.maxVisibleValue(),this.scale.minValue=this.scale.minRawValue,this.scale.maxValue=this.scale.maxRawValue,this.maxAndMin.min=this.minValueInArray(t.tileData.dense),this.maxAndMin.max=this.maxValueInArray(t.tileData.dense),this.numCategories=t.tileData.shape[0],this.localColorToHexScale(),this.unFlatten(t),this.renderTile(t),this.rescaleTiles()}},{key:"destroyTile",value:function(t){t.sprite.destroy(!0),t.graphics.destroy(!0),t.graphics=null,t.sprite=null}},{key:"rerender",value:function(t){ee(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"rerender",this).call(this,t),this.options=t;for(var e=this.visibleAndFetchedTiles(),i=0;i<e.length;i++)this.updateTile(e[i]);this.rescaleTiles(),this.draw()}},{key:"updateTile",value:function(){for(var t=this.visibleAndFetchedTiles(),e=0;e<t.length;e++){var r=t[e];this.unFlatten(r)}this.rescaleTiles()}},{key:"drawTile",value:function(t){}},{key:"renderTile",value:function(t){t.svgData=null,t.mouseOverData=null;var e=t.graphics;e.clear(),e.children.map((function(t){e.removeChild(t)})),t.drawnAtScale=this._xScale.copy();var r=this.getTilePosAndDimensions(t.tileData.zoomLevel,t.tileData.tilePos,this.tilesetInfo.tile_size),i=r.tileX,n=r.tileWidth,a=this.unFlatten(t);this.oldDimensions=this.dimensions;try{this.drawVerticalBars(this.mapOriginalColors(a),i,n,this.maxAndMin.max,this.maxAndMin.min,t),e.addChild(t.sprite),this.makeMouseOverData(t)}catch(e){console.log("StackedDeltaBarChart -> renderTile("+t.tileId+") TypeError")}}},{key:"syncMaxAndMin",value:function(){var t=this,e=this.visibleAndFetchedTiles();this.maxAndMin.min=0,this.maxAndMin.max=0,e.map((function(e){e.minValue+e.maxValue>t.maxAndMin.min+t.maxAndMin.max&&(t.maxAndMin.min=e.minValue,t.maxAndMin.max=e.maxValue)}))}},{key:"rescaleTiles",value:function(){var t=this,e=this.visibleAndFetchedTiles();this.syncMaxAndMin(),e.map((function(e){var r=Bt().domain([0,t.maxAndMin.max+Math.abs(t.maxAndMin.min)]).range([0,t.dimensions[1]]),i=t.dimensions[1]-r(Math.abs(t.maxAndMin.min)),n=r(e.minValue+e.maxValue),a=e.sprite,o=i-r(e.maxValue);a&&(a.height=n,a.y=o)}))}},{key:"localColorToHexScale",value:function(){for(var t=this.options.colorScale||Lt(schemeCategory10),e={},r=0;r<t.length;r++)e[t[r]]=u(t[r]),this.options.hideColorByIndex&&r===this.options.hideColorByIndex&&(e[t[r]]=u("#ffffff"));this.colorHexMap=e}},{key:"findMaxAndMin",value:function(t){for(var e={max:null,min:null},r=0;r<t.length;r++){var i=t[r],n=i.filter((function(t){return t>=0})).reduce((function(t,e){return t+e}),0);n>e.max&&(e.max=n);var a=i.filter((function(t){return t<=0}));if(a.length>0){var o=(a=a.map((function(t){return Math.abs(t)}))).reduce((function(t,e){return t+e}),0);(null===e.min||o>e.min)&&(e.min=o)}}return e}},{key:"unFlatten",value:function(t){if(t.matrix)return t.matrix;var e=t.tileData.dense;e.filter((function(t){return t<0})).length>0&&"linear"===this.options.valueScaling&&(console.warn("Negative values present in data. Defaulting to exponential scale."),this.options.valueScaling="exponential");var r=this.simpleUnFlatten(t,e),i=this.findMaxAndMin(r.matrix);return t.sortedIdxs=r.idxs,t.matrix=r.matrix,t.maxValue=i.max,t.minValue=i.min,this.syncMaxAndMin(),r.matrix}},{key:"simpleUnFlatten",value:function(t,e){for(var r=this,i=this.numCategories,n=t.tileData.shape[1],a=[],o=[],l=0;l<i;l++)for(var s=function(t){var i=void 0;if(i=void 0===a[t]?[]:a[t],r.options.selectRows){var o=r.options.selectRows[l];if(Array.isArray(o)){var s=o.reduce((function(r,i){return r+e[n*i+t]}),0);i.push(s)}else i.push(e[n*o+t])}else i.push(e[n*l+t]);a[t]=i},u=0;u<n;u++)s(u);for(var c=-1,h=0;h<n;h++){for(var v=0;v<i;v++)c<a[h][v]&&(c=a[h][v]);o[h]=this.remapVectorToSortedIndices(a[h]),a[h]=this.remapVectorToStateSortedDeltas(a[h])}return{idxs:o,matrix:a}}},{key:"remapVectorToSortedIndices",value:function(t){var e=t.length-1;Array(e+1);return[].concat(re(t)).map((function(t,e){return{i:e,d:t}})).sort((function(t,e){return t.d>e.d?1:-1})).map((function(t){return t.i}))}},{key:"remapVectorToStateSortedDeltas",value:function(t){var e=0,r=t.length-1,i=Array(r+1),n=[].concat(re(i.keys())).sort((function(e,r){return t[e]-t[r]}));for(i[n[e]]=t[n[e]];e++<r;)i[n[e]]=t[n[e]]-t[n[e-1]];return i}},{key:"remapVectorToStateDeltas",value:function(t){var e=[].concat(re(Array(t.length).keys()));e.sort((function(e,r){return t[e]<t[r]?-1:t[e]>t[r]?1:0}));var r=[];e.forEach((function(i,n){return r.push({i:e[n],d:t[e[n]]})}));var i=new Array(t.length);i[0]=r[0];for(var n=1;n<t.length;++n)i[n]={i:r[n].i,d:r[n].d-r[n-1].d};return i}},{key:"sortStateDeltasByState",value:function(t){var e=[].concat(re(t));return e.sort((function(t,e){return t.i>e.i?1:-1})),e}},{key:"sortStateDeltasByValue",value:function(t){var e=[].concat(re(t));return e.sort((function(t,e){return t.d>e.d?1:-1})),e}},{key:"remapVectorToUndiffedStateDeltas",value:function(t){var e=[].concat(re(Array(t.length).keys()));e.sort((function(e,r){return t[e]<t[r]?-1:t[e]>t[r]?1:0}));var r=[];return e.forEach((function(i,n){return r.push({i:e[n],d:t[e[n]]})})),r}},{key:"accumulateStateDeltasUpToState",value:function(t,e){for(var r=0,i=0;i<t.length;i++){var n=t[i];if(r+=n.d,n.i===e)break}return r}},{key:"mapOriginalColors",value:function(t){for(var e=this.options.colorScale||Lt(schemeCategory10),r=[],i=0;i<t.length;i++){for(var n=[],a=0;a<t[i].length;a++)n[a]={value:isNaN(t[i][a])?0:t[i][a],color:e[a]};for(var o=[],l=[],s=0;s<n.length;s++)n[s].value>=0?o.push(n[s]):n[s].value<0&&l.push(n[s]);r.push([o,l])}return r}},{key:"drawVerticalBars",value:function(e,r,i,n,a,l){if(l&&e){this.textureGraphics.clear();var s=this.dimensions[1],u=n+Math.abs(a),c=n*s/u,h=(Math.abs(a),this.dimensions[1]);this.drawBackground(e,this.textureGraphics),this.options.barBorder&&this.textureGraphics.lineStyle(1,0,1);for(var v=this.options.fillOpacityMin?this.options.fillOpacityMin:.1,f=this.options.fillOpacityMax?this.options.fillOpacityMax:1,d=Bt().domain([0,this.numCategories-1]).range([f,v]),p=0;p<e.length;p++){var m=10*p;0===p&&m;for(var g=e[p][0],y=Bt().domain([0,n]).range([0,c]),b=0,x=l.sortedIdxs[p],w=y(g.reduce((function(t,e){return t+parseFloat(e.value)}),0)),k=0;k<g.length;k++){var M=x[k],A=y(g[M].value),S=c-(b+A);this.addSVGInfo(l,m,S,10,A,g[M].color);var D=x[g.length-1-k],T=y(g[D].value),O=w,_=c-O,C=this.options.fillOpacityMin?parseFloat(d(k)):1;this.textureGraphics.beginFill(this.colorHexMap[g[D].color],C),this.textureGraphics.drawRect(m,_,10,O),w-=T,b+=A,h>_&&(h=_)}}try{var z=o.generateTexture(this.textureGraphics,t.libraries.PIXI.SCALE_MODES.NEAREST),I=new t.libraries.PIXI.Sprite(z);I.width=this._xScale(r+i)-this._xScale(r),I.x=this._xScale(r),l.sprite=I,l.lowestY=h}catch(t){console.log("StackedDeltaBarChart -> drawVerticalBars("+l.tileId+") TypeError")}}}},{key:"addSVGInfo",value:function(t,e,r,i,n,a){t.hasOwnProperty("svgData")&&null!==t.svgData?(t.svgData.barXValues.push(e),t.svgData.barYValues.push(r),t.svgData.barWidths.push(i),t.svgData.barHeights.push(n),t.svgData.barColors.push(a)):t.svgData={barXValues:[e],barYValues:[r],barWidths:[i],barHeights:[n],barColors:[a]}}},{key:"setDimensions",value:function(t){var e=this;this.oldDimensions=this.dimensions,ee(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"setDimensions",this).call(this,t),this.visibleAndFetchedTiles().map((function(t){return e.initTile(t)}))}},{key:"minValueInArray",value:function(t){for(var e=t[0],r=1;r<t.length;r++){var i=t[r];e=i<e?i:e}return e}},{key:"maxValueInArray",value:function(t){for(var e=t[0],r=1;r<t.length;r++){var i=t[r];e=i>e?i:e}return e}},{key:"makeMouseOverData",value:function(t){for(var e=this.numCategories,r=t.tileData.shape[1],i=t.svgData.barYValues,n=t.svgData.barHeights,a=t.svgData.barColors,o=[],l=0;l<e;l++)for(var s=0;s<r;s++){var u=s*e+l,c={y:i[u],height:n[u],color:a[u]};void 0===o[s]?o[s]=[c]:o[s].push(c)}for(var h=0;h<o.length;h++)o[h]=o[h].sort((function(t,e){return t.y-e.y}));t.mouseOverData=o}},{key:"exportSVG",value:function(){var t=this;this.visibleAndFetchedTiles().map((function(e){t.initTile(e),t.draw()}));var e=null,i=null;e=i=document.createElement("g");var n=ee(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"superSVG",this).call(this),a=Qt(n,2);i=a[0],e=a[1];var o=document.createElement("g");e.appendChild(o),o.setAttribute("transform","translate("+this.pMain.position.x+","+this.pMain.position.y+") scale("+this.pMain.scale.x+","+this.pMain.scale.y+")");var l=!0,s=!1,u=void 0;try{for(var c,h=this.visibleAndFetchedTiles()[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var v=c.value,f=document.createElement("g");f.setAttribute("transform"," translate("+v.sprite.x+","+v.sprite.y+") rotate(0) scale("+v.sprite.scale.x+","+v.sprite.scale.y+") ");for(var d=v.svgData,p=0;p<d.barXValues.length;p++){var m=document.createElement("rect");m.setAttribute("fill",d.barColors[p]),m.setAttribute("stroke",d.barColors[p]),m.setAttribute("x",d.barXValues[p]),m.setAttribute("y",d.barYValues[p]-v.lowestY),m.setAttribute("height",d.barHeights[p]),m.setAttribute("width",d.barWidths[p]),this.options.barBorder&&(m.setAttribute("stroke-width","0.1"),m.setAttribute("stroke","black")),f.appendChild(m)}o.appendChild(f)}}catch(t){s=!0,u=t}finally{try{!l&&h.return&&h.return()}finally{if(s)throw u}}return[i,i]}},{key:"getMouseOverHtml",value:function(t,e){var r=this;if(!this.tilesetInfo)return"";var i=this.options.colorScale||Lt(schemeCategory10),n=this.calculateZoomLevel(),o=a.calculateTileWidth(this.tilesetInfo,n,this.tilesetInfo.tile_size),l=this._xScale.invert(t)/o,u=Math.floor(this.tilesetInfo.tile_size*(l-Math.floor(l))),c=this.tileToLocalId([n,Math.floor(l)]),h=this.fetchedTiles[c];if(!h)return"";for(var v=h.matrix[u],f=h.sortedIdxs[u],d=h.mouseOverData[u],p=(e-h.sprite.y)/h.sprite.scale.y+h.lowestY,m={},g=0;g<i.length;g++)m[i[g]]=g;if(p<d[0].y||p>=d[d.length-1].y+d[d.length-1].height)return"";for(var y=0;y<d.length;y++){var b=d[y].y,x=d[y].height;if(p>b&&p<=b+x){var w=d[y].color;if("#ffffff"===w)return"";var k=Number.parseFloat(v[m[w]]).toPrecision(4).toString(),M=void 0;if(this.options.selectRows){var A=this.options.selectRows[m[w]];if(Array.isArray(A)){var S=A.map((function(t){return r.tilesetInfo.row_infos[t].name||r.tilesetInfo.row_infos[t]}));M=S.join(", ")}else{var D=this.tilesetInfo.row_infos[A];M=D.name||D}}else!function(){var t=m[w],e=r.tilesetInfo.row_infos[t],i=r.remapVectorToUndiffedStateDeltas(v);M=e.name||e;var n=!0,a=[];f.forEach((function(e){n&&a.push(e),e===t&&(n=!1)}));var o=a.map((function(t){return i.filter((function(e){return e.i===t}))})).map((function(t){return t[0].d})).reduce((function(t,e){return t+e}),0);k=Number.parseFloat(o).toPrecision(4).toString()}();var T='<svg width="10" height="10"><rect width="10" height="10" rx="2" ry="2" style="fill:'+w+';stroke:black;stroke-width:2;"></svg> '+M,O=this._xScale.invert(t),_=null;if(this.options.chromInfo&&this.options.binSize){var C=s(O,this.options.chromInfo);_=C[0]+":"+(Math.ceil(C[1]/this.options.binSize)*this.options.binSize-this.options.binSize)}var z="";return z+='<div class="track-mouseover-menu-table">',_&&(z+='\n              <div class="track-mouseover-menu-table-item">\n                <label for="position" class="track-mouseover-menu-table-item-label">Position</label>\n                <div name="position" class="track-mouseover-menu-table-item-value">'+_+"</div>\n              </div>\n              "),z+='\n              <div class="track-mouseover-menu-table-item">\n                <label for="normalizedDensity" class="track-mouseover-menu-table-item-label">Normalized density</label>\n                <div name="normalizedDensity" class="track-mouseover-menu-table-item-value">'+k+'</div>\n              </div>\n              <div class="track-mouseover-menu-table-item">\n                <label for="category" class="track-mouseover-menu-table-item-label">Category</label>\n                <div name="category" class="track-mouseover-menu-table-item-value">'+T+"</div>\n              </div>\n            ",z+="</div>"}}}},{key:"draw",value:function(){ee(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"draw",this).call(this)}}]),r}(t.tracks.BarTrack);return new(Function.prototype.bind.apply(c,[null].concat(r)))};oe.config={type:"horizontal-stacked-delta-bar",datatype:["multivec","epilogos"],local:!1,orientation:"1d-horizontal",thumbnail:(new DOMParser).parseFromString('<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 5640 5420" preserveAspectRatio="xMidYMid meet"> <g id="layer101" fill="#000000" stroke="none"> <path d="M0 2710 l0 -2710 2820 0 2820 0 0 2710 0 2710 -2820 0 -2820 0 0 -2710z"/> </g> <g id="layer102" fill="#750075" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> <path d="M4340 2710 l0 -2510 560 0 560 0 0 2510 0 2510 -560 0 -560 0 0 -2510z"/> <path d="M200 1870 l0 -1670 630 0 630 0 0 1670 0 1670 -630 0 -630 0 0 -1670z"/> <path d="M1660 1810 l0 -1610 570 0 570 0 0 1610 0 1610 -570 0 -570 0 0 -1610z"/> <path d="M3000 840 l0 -640 570 0 570 0 0 640 0 640 -570 0 -570 0 0 -640z"/> </g> <g id="layer103" fill="#ffff04" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> </g> </svg>',"text/xml").documentElement,availableOptions:["labelPosition","labelColor","valueScaling","labelTextOpacity","labelBackgroundOpacity","trackBorderWidth","trackBorderColor","trackType","scaledHeight","backgroundColor","colorScale","barBorder","sortLargestOnTop","selectRows"],defaultOptions:{labelPosition:"topLeft",labelColor:"black",labelTextOpacity:.4,valueScaling:"linear",trackBorderWidth:0,trackBorderColor:"black",backgroundColor:"white",barBorder:!0,sortLargestOnTop:!0,selectRows:null,fillOpacityMin:.1,fillOpacityMax:1},otherOptions:{epilogos:{scaledHeight:!1}}};var le=r(1),se=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&l.return&&l.return()}finally{if(n)throw a}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},ue=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),ce=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var o=n.get;return void 0!==o?o.call(i):void 0};function he(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ve(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function fe(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var de=function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];if(!new.target)throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');var n=t.services.tileProxy,a=function(e){function r(t,e){he(this,r);var i=ve(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,e));return i.maxAndMin={max:null,min:null},i}return fe(r,e),ue(r,[{key:"renderTile",value:function(t){for(var e=t.graphics,r=e.children.length-1;r>=0;r--)e.removeChild(e.children[r]);e.clear(),t.drawnAtScale=this._xScale.copy();var i=this.getTilePosAndDimensions(t.tileData.zoomLevel,t.tileData.tilePos,this.tilesetInfo.tile_size),n=i.tileX,a=i.tileWidth,o=this.unFlatten(t);this.drawNormalizedBars(this.scaleMatrix(this.mapOriginalColors(o)),n,a,t),e.addChild(t.sprite),this.makeMouseOverData(t)}},{key:"rescaleTiles",value:function(){var t=this;this.visibleAndFetchedTiles().map((function(e){e.sprite&&(e.sprite.height=t.dimensions[1],e.sprite.y=0)}))}},{key:"scaleMatrix",value:function(t){for(var e=function(e){var r=t[e][0],i=t[e][1],n=r.map((function(t){return t.value})),a=i.map((function(t){return t.value})),o=n.length>0?n.reduce((function(t,e){return t+e})):0,l=a.length>0?a.reduce((function(t,e){return t+e})):0;r.map((function(t){return t.value=t.value/o})),i.map((function(t){return t.value=t.value/l}))},r=0;r<t.length;r++)e(r);return t}},{key:"mapOriginalColors",value:function(t){for(var e=this.options.colorScale||Lt(schemeCategory10),r=[],i=0;i<t.length;i++){for(var n=[],a=0;a<t[i].length;a++)n[a]={value:t[i][a],color:e[a]};for(var o=[],l=[],s=0;s<n.length;s++)n[s].value>=0?o.push(n[s]):n[s].value<0&&l.push(n[s]);this.options.sortLargestOnTop?(o.sort((function(t,e){return t.value-e.value})),l.sort((function(t,e){return e.value-t.value}))):(o.sort((function(t,e){return e.value-t.value})),l.sort((function(t,e){return t.value-e.value}))),r.push([o,l])}return r}},{key:"drawNormalizedBars",value:function(e,r,i,n){for(var a=this.dimensions[1],o=new t.libraries.PIXI.Graphics,l=this.dimensions[1],s=0;s<e.length;s++){var u=s;0===s&&u;for(var c=Bt().domain([0,1]).range([0,a/2]),h=0,v=0;v<e[s][0].length;v++){var f=c(e[s][0][v].value),d=a/2-(h+f),p=e[s][0][v].color;this.addSVGInfo(n,u,d,1,f,p),o.beginFill(this.colorHexMap[p],1),o.drawRect(u,d,1,f),h+=f,l>d&&(l=d)}h=0;for(var m=Bt().domain([0,1]).range([0,a/2]),g=0,y=0;y<e[s][1].length;y++){var b=m(e[s][1][y].value),x=a/2+g,w=e[s][1][y].color;this.addSVGInfo(n,u,x,1,b,w),o.beginFill(this.colorHexMap[w],1),o.drawRect(u,x,1,b),g+=b}g=0}var k=o.generateTexture(t.libraries.PIXI.SCALE_MODES.NEAREST),M=new t.libraries.PIXI.Sprite(k);M.width=this._xScale(r+i)-this._xScale(r),M.x=this._xScale(r),n.sprite=M}},{key:"setDimensions",value:function(t){var e=this;ce(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"setDimensions",this).call(this,t),this.visibleAndFetchedTiles().map((function(t){return e.initTile(t)}))}},{key:"addSVGInfo",value:function(t,e,r,i,n,a){t.hasOwnProperty("svgData")&&null!==t.svgData?(t.svgData.barXValues.push(e),t.svgData.barYValues.push(r),t.svgData.barWidths.push(i),t.svgData.barHeights.push(n),t.svgData.barColors.push(a)):t.svgData={barXValues:[e],barYValues:[r],barWidths:[i],barHeights:[n],barColors:[a]}}},{key:"draw",value:function(){ce(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"draw",this).call(this)}},{key:"makeMouseOverData",value:function(t){for(var e=t.tileData.shape[0],r=t.tileData.shape[1],i=t.svgData.barYValues,n=t.svgData.barColors,a=t.svgData.barHeights,o=[],l=0;l<e;l++)for(var s=0;s<r;s++){var u=s*e+l,c={y:i[u],color:n[u],height:a[u]};void 0===o[s]?o[s]=[c]:o[s].push(c)}for(var h=0;h<o.length;h++)o[h]=o[h].sort((function(t,e){return t.y-e.y}));t.mouseOverData=o}},{key:"exportSVG",value:function(){var t=this;this.visibleAndFetchedTiles().map((function(e){t.initTile(e)}));var e=null,i=null;e=i=document.createElement("g");var n=ce(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"superSVG",this).call(this),a=se(n,2);i=a[0],e=a[1];var o=document.createElement("g");e.appendChild(o),o.setAttribute("transform","translate("+this.pMain.position.x+","+this.pMain.position.y+") scale("+this.pMain.scale.x+","+this.pMain.scale.y+")");var l=!0,s=!1,u=void 0;try{for(var c,h=this.visibleAndFetchedTiles()[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var v=c.value,f=document.createElement("g");f.setAttribute("transform","translate("+v.sprite.x+","+v.sprite.y+") rotate(0) scale("+v.sprite.scale.x+","+v.sprite.scale.y+")");for(var d=v.svgData,p=0;p<d.barXValues.length;p++){var m=document.createElement("rect");m.setAttribute("fill",d.barColors[p]),m.setAttribute("stroke",d.barColors[p]),m.setAttribute("x",d.barXValues[p]),m.setAttribute("y",d.barYValues[p]),m.setAttribute("height",d.barHeights[p]),m.setAttribute("width",d.barWidths[p]),v.barBorders&&(m.setAttribute("stroke-width","0.1"),m.setAttribute("stroke","black")),f.appendChild(m)}o.appendChild(f)}}catch(t){s=!0,u=t}finally{try{!l&&h.return&&h.return()}finally{if(s)throw u}}return[i,i]}},{key:"getMouseOverHtml",value:function(t,e){if(!this.tilesetInfo)return"";var r=this.options.colorScale||Lt(schemeCategory10),i=this.calculateZoomLevel(),a=n.calculateTileWidth(this.tilesetInfo,i,this.tilesetInfo.tile_size),o=this._xScale.invert(t)/a,l=Math.floor(this.tilesetInfo.tile_size*(o-Math.floor(o))),s=this.tileToLocalId([i,Math.floor(o)]),u=this.fetchedTiles[s];if(!u)return"";for(var c=u.matrix[l],h=u.mouseOverData[l],v={},f=0;f<r.length;f++)v[r[f]]=f;if(e<h[0].y||e>=h[h.length-1].y+h[h.length-1].height)return"";for(var d=0;d<h.length;d++)if(e>h[d].y&&e<=h[d].y+h[d].height){var p=h[d].color,m=Number.parseFloat(c[v[p]]).toPrecision(4).toString(),g=this.tilesetInfo.row_infos[v[p]];return'<svg width="10" height="10"><rect width="10" height="10" rx="2" ry="2"\n            style="fill:'+p+';stroke:black;stroke-width:2;"></svg> '+(g.name||g)+"<br>"+m}}}]),r}(Object(le.mix)(t.tracks.BarTrack).with(t.tracks.OneDimensionalMixin));return new(Function.prototype.bind.apply(a,[null].concat(r)))};de.config={type:"scaled-horizontal-stacked-bar",datatype:["multivec"],local:!1,orientation:"1d-horizontal",thumbnail:(new DOMParser).parseFromString('<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="564px" height="542px" viewBox="0 0 5640 5420" preserveAspectRatio="xMidYMid meet"> <g id="layer101" fill="#000000" stroke="none"> <path d="M0 2710 l0 -2710 2820 0 2820 0 0 2710 0 2710 -2820 0 -2820 0 0 -2710z"/> </g> <g id="layer102" fill="#750075" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> <path d="M4340 2710 l0 -2510 560 0 560 0 0 2510 0 2510 -560 0 -560 0 0 -2510z"/> <path d="M200 1870 l0 -1670 630 0 630 0 0 1670 0 1670 -630 0 -630 0 0 -1670z"/> <path d="M1660 1810 l0 -1610 570 0 570 0 0 1610 0 1610 -570 0 -570 0 0 -1610z"/> <path d="M3000 840 l0 -640 570 0 570 0 0 640 0 640 -570 0 -570 0 0 -640z"/> </g> <g id="layer103" fill="#ffff04" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> </g> </svg>',"text/xml").documentElement,availableOptions:["labelPosition","labelColor","valueScaling","labelTextOpacity","labelBackgroundOpacity","trackBorderWidth","trackBorderColor","trackType","scaledHeight","backgroundColor","colorScale","barBorder","sortLargestOnTop"],defaultOptions:{labelPosition:"topLeft",labelColor:"black",labelTextOpacity:.4,valueScaling:"linear",trackBorderWidth:0,trackBorderColor:"black",backgroundColor:"white",barBorder:!0,sortLargestOnTop:!0,colorScale:["#FF0000","#FF4500","#32CD32","#008000","#006400","#C2E105","#FFFF00","#66CDAA","#8A91D0","#CD5C5C","#E9967A","#BDB76B","#808080","#C0C0C0","#FFFFFF"]}};var pe=de,me=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&l.return&&l.return()}finally{if(n)throw a}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},ge=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),ye=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var o=n.get;return void 0!==o?o.call(i):void 0};function be(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function xe(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function we(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var ke=function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];if(!new.target)throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');t.services.tileProxy;var n=function(t){function e(t,r){be(this,e);var i=xe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r));return i.maxAndMin={max:null,min:null},i}return we(e,t),ge(e,[{key:"renderTile",value:function(t){var e=t.graphics;e.clear(),t.drawnAtScale=this._xScale.copy();for(var r=this.getTilePosAndDimensions(t.tileData.zoomLevel,t.tileData.tilePos,this.tilesetInfo.tile_size),i=r.tileX,n=r.tileWidth,a=t.matrix,o=this.dimensions[1],l=t.tileData.shape,s=this.options.colorScale||Lt(schemeCategory10),u=Bt().domain([0,this.maxAndMin.max]).range([0,o/l[0]]),c=0;c<a[0].length;c++){var h=o/l[0],v=c===a[0].length-1?h*c+(h*(c+1)-h*c)-1:h*c+(h*(c+1)-h*c);e.lineStyle(1,this.colorHexMap[s[c]],1);for(var f=0;f<a.length;f++){var d=this._xScale(i+f*n/this.tilesetInfo.tile_size),p=v-u(a[f][c]);this.addSVGInfo(t,d,p,s[c]),0===f?e.moveTo(d,p):e.lineTo(d,p)}}}},{key:"setDimensions",value:function(t){var r=this;ye(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setDimensions",this).call(this,t),this.visibleAndFetchedTiles().map((function(t){return r.initTile(t)}))}},{key:"addSVGInfo",value:function(t,e,r,i){t.svgData&&t.svgData.hasOwnProperty("lineXValues")&&t.svgData.hasOwnProperty("lineYValues")&&t.svgData.hasOwnProperty("lineColor")?t.svgData.lineColor[t.svgData.lineColor.length-1]!==i?(t.svgData.lineXValues.push([e]),t.svgData.lineYValues.push([r]),t.svgData.lineColor.push(i)):(t.svgData.lineXValues[t.svgData.lineXValues.length-1].push(e),t.svgData.lineYValues[t.svgData.lineYValues.length-1].push(r)):t.svgData={lineXValues:[[e]],lineYValues:[[r]],lineColor:[i]}}},{key:"exportSVG",value:function(){var t=document.createElement("g"),r=t,i=ye(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"superSVG",this).call(this),n=me(i,2);t=n[0],r=n[1],t.setAttribute("class","exported-line-track");var a=document.createElement("g");r.appendChild(a),a.setAttribute("transform","translate("+this.position[0]+","+this.position[1]+")");for(var o=this.visibleAndFetchedTiles(),l=0;l<o.length;l++)for(var s=0;s<o[l].svgData.lineXValues.length;s++){var u=document.createElement("path");u.setAttribute("fill","transparent"),u.setAttribute("stroke",o[l].svgData.lineColor[s]);for(var c="M"+o[l].svgData.lineXValues[s][0]+" "+o[l].svgData.lineYValues[s][0],h=0;h<o[l].svgData.lineXValues[s].length;h++)c+="L"+o[l].svgData.lineXValues[s][h]+" "+o[l].svgData.lineYValues[s][h];u.setAttribute("d",c),a.appendChild(u)}var v=document.createElement("g");if(v.setAttribute("id","axis"),t.appendChild(v),v.setAttribute("transform","translate("+this.axis.pAxis.position.x+", "+this.axis.pAxis.position.y+")"),"left"===this.options.axisPositionHorizontal||"top"===this.options.axisPositionVertical){var f=this.axis.exportAxisLeftSVG(this.valueScale,this.dimensions[1]);v.appendChild(f)}else if("right"===this.options.axisPositionHorizontal||"bottom"===this.options.axisPositionVertical){var d=this.axis.exportAxisRightSVG(this.valueScale,this.dimensions[1]);v.appendChild(d)}return[t,r]}},{key:"getMouseOverHtml",value:function(t,e){return""}}]),e}(Object(le.mix)(t.tracks.BarTrack).with(t.tracks.OneDimensionalMixin));return new(Function.prototype.bind.apply(n,[null].concat(r)))};ke.config={type:"basic-multiple-line-chart",datatype:["multivec"],local:!1,orientation:"1d-horizontal",thumbnail:(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  width="100%" height="100%" viewBox="0 0 340 288" preserveAspectRatio="xMidYMid meet"><rect id="svgEditorBackground" x="0" y="0" width="340" height="288" style="fill:none;stroke:none;"/><g style="fill:rgb(239,221,228);fill-rule:evenodd;stroke:rgb(239,221,228);stroke-width:0.1;" id="l1"><path d="M0,0h340v88h-2l-8,-4l-4,-2v-1h-3l-14,-7v-1h-3l-16,-8v-1h-3l-18,-9v-1h-3l-32,-16v-1h-3l-14,-7v-1l-5,5c-2,0,-2,1,-7,6c-2,0,-2,1,-8,7c-2,0,-2,1,-7,6c-2,0,-2,1,-6,5c-2,0,-2,1,-5,4h-1l-2,-16l-1,-9c0,-4,-1,-3,-3,-2c-2,0,-2,1,-3,2l-2,1l-2,1c-2,0,-2,1,-3,2l-2,1c-2,0,-2,1,-3,2l-2,1c-2,0,-2,1,-3,2h-1l-2,-1l-1,-1v-1h-2l-1,-1v-1h-2l-2,-2v-1h-2l-2,-2v-1h-2l-2,-2v-1c-3,0,-3,2,-4,3h-1v2l-1,1h-1v2l-1,1h-1l-1,-1l-2,-4c0,-3,-1,-3,-5,-11c0,-3,-1,-3,-4,-9c0,-3,-1,-3,-3,-7v2l-7,21h-1v4l-3,9l-3,9l-3,9h-1v4l-3,9l-3,9l-3,9h-1v4l-3,9l-2,6l-1,2h-1c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3l-1,-2c0,-2,-1,-2,-3,-4l-1,-2c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3v-1l-1,1c-5,0,-5,1,-11,4c-3,0,-3,1,-5,2c-3,0,-3,1,-5,2c-3,0,-3,1,-5,2l-3,1c-3,0,-3,1,-5,2h-2Z" style="fill:white;"/><path d="M220,41h1l24,12l1,1v1h2l24,12l1,1v1h2l28,14l1,1v1h2l18,9l8,4l1,1v1h2l4,2l1,1v94l-2,2h-1v2l-4,4l-11,11h-1v2l-8,8l-2,1l-15,1l-32,2c-17,0,-17,1,-33,2c-16,0,-16,1,-31,2l-16,1c-17,0,-17,1,-33,2h-7l-1,-2l-1,-6c0,-6,-1,-6,-2,-11l-1,-6c0,-6,-1,-6,-2,-11v-2l-4,4c-2,0,-2,1,-6,5c-2,0,-2,1,-7,6c-2,0,-2,1,-7,6l-2,1h-2l-8,-8v-1h-2l-1,-1l-7,-7v-1l-1,1l-4,2c-3,0,-3,1,-7,3c-3,0,-3,1,-5,2h-2l-2,-1l-6,-6l-2,-2v-1h-2l-3,-3v-1l-1,1h-1v3l-2,4h-1v3l-2,4h-1v3h-2l-1,-1c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-2,-3c0,-2,-1,-2,-3,-4v3l-2,10h-1v6l-1,4h-1v5l-1,5h-1l-6,-3l-1,-1v-1h-2l-6,-3l-1,-1v-1h-2l-4,-2l-1,-1v-1h-2l-2,-1l-1,-1v-130l4,-2l3,-1c3,0,3,-1,5,-2l3,-1c3,0,3,-1,5,-2l3,-1c3,0,3,-1,5,-2l3,-1h3l1,2c0,2,1,2,2,3l3,6c0,2,1,2,2,3l2,4l2,4c0,2,1,2,2,3l4,8c0,2,1,2,2,3l3,6c0,2,1,2,2,3l4,8c0,2,1,2,2,3l4,8c0,2,1,2,2,3l3,6c0,2,1,2,2,3l3,6v-2l1,-4l7,-21h1v-4l3,-9l3,-9h1v-4l3,-9l2,-6h1v-4l3,-9l2,-6h1v-4l3,-9l2,-6h1l2,4l1,3c0,3,1,3,2,5c0,3,1,3,2,5c0,3,1,3,2,5c0,3,1,3,2,5c0,3,1,3,2,5q0,1,1,-3l1,-3h1v-4l1,-3h1v-4l1,-3h1v-4l1,-3h1v-4l1,-1h1l5,5l5,5v1l3,-1c2,0,2,-1,3,-2c2,0,2,-1,3,-2l2,-1c2,0,2,-1,3,-2l2,-1h1l1,2l1,9l1,10c0,9,1,9,2,12v-1l1,-1c2,0,2,-1,4,-3l2,-2c2,0,2,-1,5,-4c2,0,2,-1,6,-5c2,0,2,-1,5,-4c2,0,2,-1,6,-5c2,0,2,-1,6,-5c2,0,2,-1,5,-4c2,0,2,-1,6,-5c2,0,2,-1,5,-4Z" style="fill:white;"/><path d="M339,214h1v74h-340v-58h1l24,12l1,1v1h2l8,4l1,1v-3l1,-5l2,-8l1,-3h1l2,4c0,2,1,2,2,3l2,4v2h1v1l1,-2h1v-3l2,-4h1v-3l1,-2h1v-3l2,-4h1v-3l1,-2h1l4,4c0,1,2,1,6,2v-1l3,-1c3,0,3,-1,5,-2l9,-3h2l1,1c0,2,1,2,6,7l3,3c0,2,1,2,8,9v2l4,-4c2,0,2,-1,5,-4c2,0,2,-1,6,-5c2,0,2,-1,5,-4l2,-1h1l1,7l1,10c0,10,1,10,4,11v-1c15,0,15,-1,29,-2l15,-1c16,0,16,-1,46,-3l15,-1l30,-2l15,-1l16,-1h14v-1c2,0,2,-1,9,-8l8,-8h1v-2l2,-1h1v-2Z" style="fill:white;"/></g><g style="fill:rgb(252,100,68);fill-rule:evenodd;stroke:rgb(252,100,68);stroke-width:0.1;" id="l2"><path d="M109,10h1l2,4c0,3,1,3,4,9c0,3,1,3,5,11c0,3,1,3,2,5l1,3q0,1,2-3l1-1h1v-2l1-1h1v-2h3l2,2v1h2l2,2v1h2l2,2v1h2l1,1v1h2l1,1v1h2c1,1,1,0,2-1l2-1c2,0,2-1,3-2l2-1c2,0,2-1,3-2l4-2c2,0,2-1,3-2l4-2h1l1,4l1,9c0,10,1,10,2,16v-1c2,0,2-1,6-5c2,0,2-1,7-6c2,0,2-1,9-8c2,0,2-1,6-5c2,0,2-1,7-6l2-1h3l12,6v1h3l32,16v1h3l18,9v1h3l16,8v1h3l14,7v1h3l14,7v14h-3l-4-2l-1-1v-1h-2l-26-13l-1-1v-1h-2l-28-14l-1-1v-1h-2l-24-12l-1-1v-1h-2l-18-9l-4-2v-1l-4,4c-2,0-2,1-4,3c-2,0-2,1-5,4c-2,0-2,1-6,5c-2,0-2,1-5,4c-2,0-2,1-4,3l-2,2c-2,0-2,1-5,4c-2,0-2,1-6,5c-2,0-2,1-4,3l-2,2c-2,0-2,1-5,4h-1l-1-6l-2-20c0-7-2-6-4-6v1l-1,1l-2,1c-2,0-2,1-3,2c-2,0-2,1-3,2l-2,1h-2l-12-12v1l-1,5l-1,3h-1v4l-1,3l-1,2h-1v5l-1,4l-1,3h-1v4h-1l-1-1l-1-2c0-3-1-3-2-5c0-3-1-3-2-5c0-3-1-3-2-5c0-3-1-3-2-5l-1-3c0-3-1-3-3-7v3l-2,6l-2,6h-1v4l-3,9l-2,6h-1v4l-3,9l-2,6l-1,2h-1v5l-3,9l-2,6l-1,2h-1v5l-3,9l-3,9h-1v4l-1,2h-1l-2-4c0-2-1-2-2-3l-3-6c0-2-1-2-2-3l-4-8c0-2-1-2-2-3l-4-8c0-2-1-2-2-3l-3-6c0-2-1-2-2-3l-4-8c0-2-1-2-2-3l-4-8c0-2-1-2-2-3l-3-6c0-2-1-2-2-3l-1-2c0-2-3-1-6-1v1l-2,1l-3,1c-3,0-3,1-5,2l-3,1c-3,0-3,1-5,2l-3,1c-3,0-3,1-5,2h-2v-12l4-2l3-1c3,0,3-1,5-2c3,0,3-1,5-2c3,0,3-1,5-2c3,0,3-1,9-4l5-1h1l2,2c0,2,1,2,2,3c0,3,1,3,4,6c0,3,1,3,4,6c0,2,1,2,2,3c0,3,1,3,4,6c0,3,1,3,2,4c0,2,1,2,3,4l1,2c0,2,1,2,3,4c0,2,1,2,2,3c0,2,1,2,2,3c0,2,1,2,2,3c0,2,1,2,2,3c0,2,1,2,2,3l1,2v-2l3-9l2-6l1-2h1v-5l3-9l3-9l2-6l1-2h1v-5l3-9l3-9l2-6l1-2h1v-5l3-9l3-9z"/></g><g style="fill:rgb(6,6,252);fill-rule:evenodd;stroke:rgb(6,6,252);stroke-width:0.1;" id="l3"><path d="M56,197h1l3,3v1h2l8,8v1h2v1l4-2c3,0,3-1,7-3c3,0,3-1,7-3h1l8,8v1h2l1,1l7,7v1l2-1c2,0,2-1,7-6c2,0,2-1,7-6c2,0,2-1,6-5c2,0,2-1,5-4h1l1,2l1,5l1,6c0,6,1,6,2,11l2,12c0,2,9,1,25,1v-1l15-1l18-1c16,0,16-1,31-2c16,0,16-1,31-2c18,0,18-1,34-2h13v-1c2,0,2-1,7-6l5-5h1v-2l10-10l5-5h1v16l-8,8h-1v2l-12,12l-4,1l-28,2l-15,1c-17,0-17,1-32,2c-15,0-15,1-28,2c-17,0-17,1-31,2l-15,1c-16,0-16,1-31,2h-1l-1-1l-1-10l-1-12v-5l-1,1c-2,0-2,1-5,4c-2,0-2,1-6,5c-2,0-2,1-5,4c-2,0-2,1-5,4h-1c0-2-1-2-8-9c0-2-1-2-9-10l-1-2v-1l-2,1l-6,2c-3,0-3,1-5,2l-6,2h-4l-2-2v-1h-2c-3-3-3-1-4,2l-2,4h-1v3l-1,2h-1v3l-2,4h-1v3l-1,2h-1l-1-1l-2-4c0-2-1-2-2-3l-3-6v3l-2,8h-1v5l-1,3h-1l-10-5l-1-1v-1h-2l-22-11l-1-1v-15h1l4,2l1,1v1h2l4,2l1,1v1h2l4,2l2,1l1,1v1h2l4,2l1,1v-5l1-5l1-4h1v-6l2-10l1-3h1l2,2c0,2,1,2,2,3c0,2,1,2,2,3c0,2,1,2,2,3c0,2,1,2,2,3c0,2,1,2,3,3v-3l2-4h1v-3l2-4h1v-3z"/></g><g style="fill:rgb(252,133,112);fill-rule:evenodd;stroke:rgb(252,133,112);stroke-width:0.1;" id="l4"><path d="M216,29h1v1l-1,1h-1v-1zm-115,4h1v2h-1zm109,1h1v1l-2,2h-1v-1zm7,2h1v1l-2,2h-1v-1zm-14,4h1v1l-1,1h-1v-1zm-80,1h1l1,1v1h-1l-1-1zm72,6h1v1l-2,2h-1v-1zm-59,1h1l5,5l6,6v1h-1l-5-5l-5-5v-1l-1,1h-1v-1zm75,0h1v1l-1,1h-1v-1zm-47,3h1v2h-1zm42,1h1v1l-1,1h-1v-1zm-18,1h1v1l-2,2h-1v-1zm-11,1h1v2h-1zm23,3h1v1l-1,1h-1v-1zm-35,1h1v4h-1zm17,0h1v1l-2,2h-1v-1zm13,3h1v1l-2,2h-1v-1zm-104,3h1v2h-1z"/><path d="M41,66h1l1,1v1h-1l-1-1zm89,0h1v2h-1zm59,0h1v1l-1,1h-1v-1zm-23,2h1v4h-1zm18,2h1v1l-2,2h-1v-1zm-139,2h1l1,1v1h-1l-1-1zm133,3h1v1l-1,1h-1v-1zm-11,3h1v3h-1zm5,2h1v1l-1,1h-1v-1zm-121,1h1l1,1v1h-1l-1-1zm4,6h1l1,1v1h-1l-1-1zm2,3h1l1,1v1h-1l-1-1zm24,5h1v2h-1zm-20,1h1l1,1v1h-1l-1-1zm278,6h1v1h-1zm-245,2h1v2h-1zm-7,22h1v2h-1zm-12,16h1l1,1v1h-1l-1-1z"/></g><g style="fill:rgb(155,153,247);fill-rule:evenodd;stroke:rgb(155,153,247);stroke-width:0.1;" id="l5"><path d="M339,197h1v1l-2,2h-1v-1zm-16,17h1v1l-2,2h-1v-1zm14,2h1v1l-1,1h-1v-1zm-3,3h1v1l-3,3h-1v-1zm-270,2h1l1,1v1h-1l-1-1zm67,5h1v2h-1zm165,1h2v1h-2zm-16,1h2v1h-2zm-33,2h2v1h-2zm-16,1h2v1h-2zm-16,1h3v1h-3zm-15,1h2v1h-2zm-33,2h2v1h-2zm-16,1h2v1h-2zm164,0h2v1h-2zm-14,1h2v1h-2zm-46,3h2v1h-2zm-15,1h2v1h-2zm-15,1h2v1h-2zm-30,2h2v1h-2zm-45,3h2v1h-2zm-15,1h2v1h-2z"/></g></svg>',"text/xml").documentElement,availableOptions:["labelPosition","labelColor","valueScaling","labelTextOpacity","labelBackgroundOpacity","trackBorderWidth","trackBorderColor","trackType"],defaultOptions:{labelPosition:"topLeft",labelColor:"black",labelTextOpacity:.4,valueScaling:"linear",trackBorderWidth:0,trackBorderColor:"black"}};var Me=ke,Ae=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&l.return&&l.return()}finally{if(n)throw a}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},De=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),Te=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var o=n.get;return void 0!==o?o.call(i):void 0};function Oe(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function _e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ce(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function ze(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var Ie=function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];if(!new.target)throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');var n=t.services,a=n.tileProxy,o=n.pixiRenderer,l=t.utils,s=l.absToChr,u=l.colorToHex,c=function(e){function r(t,e){_e(this,r);var i=Ce(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,e));return i.initializeBasicMultipleBarChart(),i}return ze(r,e),De(r,[{key:"initializeBasicMultipleBarChart",value:function(){this.basicMultipleBarChartInitialized||(this.maxAndMin={max:null,min:null},this.textureGraphics=new t.libraries.PIXI.Graphics,this.basicMultipleBarChartInitialized=!0,this.renderedTileIds=Object.create({}),this.rescaledTileIds=Object.create({}))}},{key:"createColorScale",value:function(){if(!this.options.colorScale)if(this.tilesetInfo.row_infos&&this.tilesetInfo.row_infos[0].color)this.options.colorScale=this.tilesetInfo.row_infos.map((function(t){return t.color}));else{this.options.colorScale=["#FF0000","#FF4500","#32CD32","#008000","#006400","#C2E105","#FFFF00","#66CDAA","#8A91D0","#CD5C5C","#E9967A","#BDB76B","#808080","#C0C0C0","#FFFFFF"]}}},{key:"initTile",value:function(t){var e=this;this.createColorScale(),this.initializeBasicMultipleBarChart(),this.scale.minRawValue=this.minVisibleValue(),this.scale.maxRawValue=this.maxVisibleValue(),this.scale.minValue=this.scale.minRawValue,this.scale.maxValue=this.scale.maxRawValue,this.maxAndMin.min=this.minValueInArray(t.tileData.dense),this.maxAndMin.max=this.maxValueInArray(t.tileData.dense),this.numCategories=this.options.selectRows?this.options.selectRows.length:t.tileData.shape[0],this.localColorToHexScale(),this.unFlatten(t),this.renderedTileIds[t.tileId]=!1,this.renderTile(t);var r=this.visibleAndFetchedTiles(),i=r.map((function(t){return t.tileId})),n=Object.keys(this.renderedTileIds);this.deepEqual(i,n)&&(this.syncMaxAndMin(),r.map((function(t){if(e.minValueInArray(t.tileData.dense)!==e.maxAndMin.min||e.maxValueInArray(t.tileData.dense)!==e.maxAndMin.max){if(t.hasOwnProperty("mouseoverRawData")&&null!==t.mouseoverRawData){for(var r in t.mouseoverRawData)t.mouseoverRawData.hasOwnProperty(r)&&delete t.mouseoverRawData[r];t.mouseoverRawData=null}e.renderedTileIds[t.tileId]=!1,e.renderTile(t)}})))}},{key:"destroyTile",value:function(t){var e=this;for(var r in delete this.renderedTileIds[t.tileId],this.renderedTileIds)this.renderedTileIds[r]=!1;for(var r in delete this.rescaledTileIds[t.tileId],this.rescaledTileIds)this.rescaledTileIds[r]=!1;t.sprite.destroy(!0),t.graphics.destroy(!0),t.graphics=null,t.sprite=null;var i=this.visibleAndFetchedTiles(),n=i.map((function(t){return t.tileId})),a=Object.keys(this.renderedTileIds);this.deepEqual(n,a)&&(this.syncMaxAndMin(),i.map((function(t){if(e.minValueInArray(t.tileData.dense)!==e.maxAndMin.min||e.maxValueInArray(t.tileData.dense)!==e.maxAndMin.max){if(t.hasOwnProperty("mouseoverRawData")&&null!==t.mouseoverRawData){for(var r in t.mouseoverRawData)t.mouseoverRawData.hasOwnProperty(r)&&delete t.mouseoverRawData[r];t.mouseoverRawData=null}e.renderedTileIds[t.tileId]=!1,e.renderTile(t)}})))}},{key:"rerender",value:function(t){Te(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"rerender",this).call(this,t),this.options=t;for(var e=this.visibleAndFetchedTiles(),i=0;i<e.length;i++)this.updateTile(e[i]);this.draw()}},{key:"updateTile",value:function(){for(var t=this.visibleAndFetchedTiles(),e=0;e<t.length;e++){var r=t[e];this.unFlatten(r)}}},{key:"drawTile",value:function(t){}},{key:"renderTile",value:function(t){if(!this.renderedTileIds[t.tileId]){t.svgData=null,t.mouseOverData=null;var e=t.graphics;e.clear(),e.children.map((function(t){e.removeChild(t)})),t.drawnAtScale=this._xScale.copy();var r=this.getTilePosAndDimensions(t.tileData.zoomLevel,t.tileData.tilePos,this.tilesetInfo.tile_size),i=r.tileX,n=r.tileWidth,a=this.unFlatten(t);this.oldDimensions=this.dimensions;try{this.drawVerticalBars(this.mapOriginalColors(a),i,n,this.maxAndMin.max,this.maxAndMin.min,t),e.addChild(t.sprite),this.makeMouseOverData(t),this.renderedTileIds[t.tileId]=!0}catch(t){}}}},{key:"syncMaxAndMin",value:function(){var t=this,e=this.visibleAndFetchedTiles();this.maxAndMin.min=0,this.maxAndMin.max=0,e.map((function(e){e.minValue<t.maxAndMin.min&&(t.maxAndMin.min=e.minValue),e.maxValue>t.maxAndMin.max&&(t.maxAndMin.max=e.maxValue)}))}},{key:"deepEqual",value:function(t,e){var r=this,i=Object.keys,n=void 0===t?"undefined":Se(t),a=void 0===e?"undefined":Se(e);return t&&e&&"object"===n&&n===a?i(t).length===i(e).length&&i(t).every((function(i){return r.deepEqual(t[i],e[i])})):t===e}},{key:"rescaleTiles",value:function(){var t=this,e=this.visibleAndFetchedTiles(),r=e.map((function(t){return t.tileId})),i=Object.keys(this.renderedTileIds);this.deepEqual(r,i)&&(this.syncMaxAndMin(),e.map((function(e){if(!t.rescaledTileIds[e.tileId]){var r=Bt().domain([0,t.maxAndMin.max+Math.abs(t.maxAndMin.min)]).range([0,t.dimensions[1]]),i=t.dimensions[1]-r(Math.abs(t.maxAndMin.min)),n=r(t.maxAndMin.max+Math.abs(t.maxAndMin.min)),a=e.sprite,o=i-r(t.maxAndMin.max);a&&(a.height=n,a.y=o,t.rescaledTileIds[e.tileId]=!0)}})))}},{key:"localColorToHexScale",value:function(){for(var t=this.options.colorScale||Lt(schemeCategory10),e={},r=0;r<t.length;r++)e[t[r]]=u(t[r]),this.options.hideColorByIndex&&r===this.options.hideColorByIndex&&(e[t[r]]=u("#ffffff"));this.colorHexMap=e}},{key:"findMaxAndMin",value:function(t){for(var e={max:null,min:null},r=0;r<t.length;r++){var i=t[r],n=Math.max.apply(Math,Oe(i.filter((function(t){return t>=0}))));n>e.max&&(e.max=n);var a=i.filter((function(t){return t<=0}));if(a.length>0){a=a.map((function(t){return Math.abs(t)}));var o=Math.min.apply(Math,Oe(a));(null===e.min||o>e.min)&&(e.min=o)}else e.min=0}return e}},{key:"unFlatten",value:function(t){if(t.matrix)return t.matrix;var e=t.tileData.dense;e.filter((function(t){return t<0})).length>0&&"linear"===this.options.valueScaling&&(this.options.valueScaling="exponential");var r=this.simpleUnFlatten(t,e),i=this.findMaxAndMin(r.matrix);return t.matrix=r.matrix,t.maxValue=i.max,t.minValue=i.min,this.syncMaxAndMin(),r.matrix}},{key:"simpleUnFlatten",value:function(t,e){for(var r=this,i=this.numCategories,n=t.tileData.shape[1],a=[],o=0;o<i;o++)for(var l=function(t){var i=void 0;if(i=void 0===a[t]?[]:a[t],r.options.selectRows){var l=r.options.selectRows[o];if(Array.isArray(l)){var s=l.reduce((function(r,i){return r+e[n*i+t]}),0);i.push(s)}else i.push(e[n*l+t])}else i.push(e[n*o+t]);a[t]=i},s=0;s<n;s++)l(s);for(var u=-1,c=0;c<n;c++)for(var h=0;h<i;h++)u<a[c][h]&&(u=a[c][h]);return{matrix:a}}},{key:"remapVectorToSortedIndices",value:function(t){var e=t.length-1;Array(e+1);return[].concat(Oe(t)).map((function(t,e){return{i:e,d:t}})).sort((function(t,e){return t.d>e.d?1:-1})).map((function(t){return t.i}))}},{key:"remapVectorToStateSortedDeltas",value:function(t){var e=0,r=t.length-1,i=Array(r+1),n=[].concat(Oe(i.keys())).sort((function(e,r){return t[e]-t[r]}));for(i[n[e]]=t[n[e]];e++<r;)i[n[e]]=t[n[e]]-t[n[e-1]];return i}},{key:"remapVectorToStateDeltas",value:function(t){var e=[].concat(Oe(Array(t.length).keys()));e.sort((function(e,r){return t[e]<t[r]?-1:t[e]>t[r]?1:0}));var r=[];e.forEach((function(i,n){return r.push({i:e[n],d:t[e[n]]})}));var i=new Array(t.length);i[0]=r[0];for(var n=1;n<t.length;++n)i[n]={i:r[n].i,d:r[n].d-r[n-1].d};return i}},{key:"sortStateDeltasByState",value:function(t){var e=[].concat(Oe(t));return e.sort((function(t,e){return t.i>e.i?1:-1})),e}},{key:"sortStateDeltasByValue",value:function(t){var e=[].concat(Oe(t));return e.sort((function(t,e){return t.d>e.d?1:-1})),e}},{key:"remapVectorToUndiffedStateDeltas",value:function(t){var e=[].concat(Oe(Array(t.length).keys()));e.sort((function(e,r){return t[e]<t[r]?-1:t[e]>t[r]?1:0}));var r=[];return e.forEach((function(i,n){return r.push({i:e[n],d:t[e[n]]})})),r}},{key:"accumulateStateDeltasUpToState",value:function(t,e){for(var r=0,i=0;i<t.length;i++){var n=t[i];if(r+=n.d,n.i===e)break}return r}},{key:"mapOriginalColors",value:function(t){for(var e=this.options.colorScale||Lt(schemeCategory10),r=[],i=0;i<t.length;i++){for(var n=[],a=0;a<t[i].length;a++)n[a]={value:isNaN(t[i][a])?0:t[i][a],color:e[a]};for(var o=[],l=[],s=0;s<n.length;s++)n[s].value>=0?o.push(n[s]):n[s].value<0&&l.push(n[s]);o.reverse(),l.reverse(),r.push([o,l])}return r}},{key:"drawVerticalBars",value:function(e,r,i,n,a,l){this.textureGraphics.clear();var s=this.dimensions[1];this.syncMaxAndMin();var c=-1===this.options.valueScaleMax?n:this.options.valueScaleMax,h=n+Math.abs(a),v=n*s/h,f=Math.abs(a)*s/h,d=v/this.numCategories,p=(this.numCategories,this.dimensions[1]);this.drawBackground(e,this.textureGraphics);for(var m=u("#000000"),g=Bt().domain([0,c]).range([0,d]),y=0;y<e.length;y++){var b=10*y;0===y&&b;for(var x=e[y][0],w=0,k=0;k<x.length;k++){var M=x[k].value;-1!==this.options.valueScaleMax&&x[k].value>this.options.valueScaleMax&&(M=this.options.valueScaleMax);var A=g(M)<.5?1:g(M),S=v-w-A;this.addSVGInfo(l,b,S,10,A,x[k].color),this.textureGraphics.beginFill(this.colorHexMap[x[k].color],g(M)<1?.33:1),this.textureGraphics.drawRect(b,S,10,A),this.textureGraphics.endFill(),w+=d,p>S&&(p=S)}}"20.490855"===l.tileId&&(console.log("lowestY (background over tile) "+p),console.log("drawRect (background over tile) > y0 0 y1 "+p)),this.addSVGInfo(l,0,0,10*e.length,p,"#000000"),this.textureGraphics.beginFill(m),this.textureGraphics.drawRect(0,0,10*e.length,p),this.textureGraphics.endFill();for(var D=d-p,T=0;T<e.length;T++){var O=10*T;0===T&&O;for(var _=e[T][0],C=0,z=0;z<_.length;z++){g(_[z].value);var I=parseInt(v-C-D),V=parseInt(d);this.addMouseoverRawInfo(l,O,I,10,V,_[z].color),C+=d}}try{var F=o.generateTexture(this.textureGraphics,t.libraries.PIXI.SCALE_MODES.NEAREST),P=new t.libraries.PIXI.Sprite(F);P.width=this._xScale(r+i)-this._xScale(r),P.x=this._xScale(r),l.sprite=P,l.lowestY=p}catch(t){}}},{key:"addSVGInfo",value:function(t,e,r,i,n,a){t.hasOwnProperty("svgData")&&null!==t.svgData?(t.svgData.barXValues.push(e),t.svgData.barYValues.push(r),t.svgData.barWidths.push(i),t.svgData.barHeights.push(n),t.svgData.barColors.push(a)):t.svgData={barXValues:[e],barYValues:[r],barWidths:[i],barHeights:[n],barColors:[a]}}},{key:"addMouseoverRawInfo",value:function(t,e,r,i,n,a){t.hasOwnProperty("mouseoverRawData")&&null!==t.mouseoverRawData?(t.mouseoverRawData.barXValues.push(e),t.mouseoverRawData.barYValues.push(r),t.mouseoverRawData.barWidths.push(i),t.mouseoverRawData.barHeights.push(n),t.mouseoverRawData.barColors.push(a)):t.mouseoverRawData={barXValues:[e],barYValues:[r],barWidths:[i],barHeights:[n],barColors:[a]}}},{key:"setDimensions",value:function(t){var e=this;this.oldDimensions=this.dimensions,Te(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"setDimensions",this).call(this,t),this.visibleAndFetchedTiles().map((function(t){if(t.hasOwnProperty("mouseoverRawData")&&null!==t.mouseoverRawData){for(var r in t.mouseoverRawData)t.mouseoverRawData.hasOwnProperty(r)&&delete t.mouseoverRawData[r];t.mouseoverRawData=null}e.initTile(t)}))}},{key:"minValueInArray",value:function(t){for(var e=t[0],r=1;r<t.length;r++){var i=t[r];e=i<e?i:e}return e}},{key:"maxValueInArray",value:function(t){for(var e=t[0],r=1;r<t.length;r++){var i=t[r];e=i>e?i:e}return e}},{key:"makeMouseOverData",value:function(t){for(var e=this.numCategories,r=t.tileData.shape[1],i=t.mouseoverRawData.barYValues,n=t.mouseoverRawData.barHeights,a=t.mouseoverRawData.barColors,o=[],l=0;l<e;l++)for(var s=0;s<r;s++){var u=s*e+l,c={y:i[u],height:n[u],color:a[u]};void 0===o[s]?o[s]=[c]:o[s].push(c)}for(var h=0;h<o.length;h++)o[h]=o[h].sort((function(t,e){return t.y-e.y}));t.mouseOverData=o}},{key:"exportSVG",value:function(){var t=this;this.visibleAndFetchedTiles().map((function(e){t.initTile(e),t.draw()}));var e=null,i=null;e=i=document.createElement("g");var n=Te(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"superSVG",this).call(this),a=Ae(n,2);i=a[0],e=a[1];var o=document.createElement("g");e.appendChild(o),o.setAttribute("transform","translate("+this.pMain.position.x+","+this.pMain.position.y+") scale("+this.pMain.scale.x+","+this.pMain.scale.y+")");var l=!0,s=!1,u=void 0;try{for(var c,h=this.visibleAndFetchedTiles()[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var v=c.value,f=document.createElement("g"),d=v.sprite.x,p=v.sprite.y+v.lowestY,m=v.sprite.scale.x,g=v.sprite.scale.y;f.setAttribute("transform"," translate("+d+","+p+") rotate(0) scale("+m+","+g+") ");for(var y=v.svgData,b=0;b<y.barXValues.length;b++){var x=document.createElement("rect");x.setAttribute("fill",y.barColors[b]),x.setAttribute("stroke",y.barColors[b]),x.setAttribute("x",y.barXValues[b]),x.setAttribute("y",y.barYValues[b]-v.lowestY),x.setAttribute("height",y.barHeights[b]),x.setAttribute("width",y.barWidths[b]),this.options.barBorder&&(x.setAttribute("stroke-width","0.1"),x.setAttribute("stroke","black")),f.appendChild(x)}o.appendChild(f)}}catch(t){s=!0,u=t}finally{try{!l&&h.return&&h.return()}finally{if(s)throw u}}return[i,i]}},{key:"getMouseOverHtml",value:function(t,e){var r=this;if(!this.tilesetInfo)return"";var i=this.options.colorScale||Lt(schemeCategory10),n=this.calculateZoomLevel(),o=a.calculateTileWidth(this.tilesetInfo,n,this.tilesetInfo.tile_size),l=this._xScale.invert(t)/o,u=Math.floor(this.tilesetInfo.tile_size*(l-Math.floor(l))),c=this.tileToLocalId([n,Math.floor(l)]),h=this.fetchedTiles[c];if(!h)return"";for(var v=h.matrix[u],f=h.mouseOverData[u],d=(e-h.sprite.y)/h.sprite.scale.y+h.lowestY,p={},m=0;m<i.length;m++)p[i[m]]=m;if(d<f[0].y||d>=f[f.length-1].y+f[f.length-1].height)return"";for(var g=0;g<f.length;g++){var y=f[g].y,b=f[g].height;if(d>y&&d<=y+b){var x=f[g].color;if("#ffffff"===x)return"";var w=Number.parseFloat(v[p[x]]).toPrecision(4).toString(),k=void 0;if(this.options.selectRows){var M=this.options.selectRows[p[x]];if(Array.isArray(M)){k=M.map((function(t){return r.tilesetInfo.row_infos[t].name||r.tilesetInfo.row_infos[t]})).join(", ")}else{var A=this.tilesetInfo.row_infos[M];k=A.name||A}}else{var S=this.tilesetInfo.row_infos[p[x]];k=S.name||S}var D='<svg width="10" height="10"><rect width="10" height="10" rx="2" ry="2" style="fill:'+x+';stroke:black;stroke-width:2;"></svg> '+k,T=this._xScale.invert(t),O=null;if(this.options.chromInfo&&this.options.binSize){var _=s(T,this.options.chromInfo);O=_[0]+":"+(Math.ceil(_[1]/this.options.binSize)*this.options.binSize-this.options.binSize)}var C="";return C+='<div class="track-mouseover-menu-table">',O&&(C+='\n              <div class="track-mouseover-menu-table-item">\n                <label for="position" class="track-mouseover-menu-table-item-label">Position</label>\n                <div name="position" class="track-mouseover-menu-table-item-value">'+O+"</div>\n              </div>\n              "),C+='\n              <div class="track-mouseover-menu-table-item">\n                <label for="normalizedDensity" class="track-mouseover-menu-table-item-label">Normalized density</label>\n                <div name="normalizedDensity" class="track-mouseover-menu-table-item-value">'+w+'</div>\n              </div>\n              <div class="track-mouseover-menu-table-item">\n                <label for="category" class="track-mouseover-menu-table-item-label">Category</label>\n                <div name="category" class="track-mouseover-menu-table-item-value">'+D+"</div>\n              </div>\n            ",C+="</div>"}}}},{key:"draw",value:function(){Te(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"draw",this).call(this)}}]),r}(t.tracks.BarTrack);return new(Function.prototype.bind.apply(c,[null].concat(r)))};Ie.config={type:"basic-multiple-bar-chart",datatype:["multivec","epilogos"],local:!1,orientation:"1d-horizontal",thumbnail:(new DOMParser).parseFromString('<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 5640 5420" preserveAspectRatio="xMidYMid meet"> <g id="layer101" fill="#000000" stroke="none"> <path d="M0 2710 l0 -2710 2820 0 2820 0 0 2710 0 2710 -2820 0 -2820 0 0 -2710z"/> </g> <g id="layer102" fill="#750075" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> <path d="M4340 2710 l0 -2510 560 0 560 0 0 2510 0 2510 -560 0 -560 0 0 -2510z"/> <path d="M200 1870 l0 -1670 630 0 630 0 0 1670 0 1670 -630 0 -630 0 0 -1670z"/> <path d="M1660 1810 l0 -1610 570 0 570 0 0 1610 0 1610 -570 0 -570 0 0 -1610z"/> <path d="M3000 840 l0 -640 570 0 570 0 0 640 0 640 -570 0 -570 0 0 -640z"/> </g> <g id="layer103" fill="#ffff04" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> </g> </svg>',"text/xml").documentElement,availableOptions:["labelPosition","labelColor","valueScaling","labelTextOpacity","labelBackgroundOpacity","trackBorderWidth","trackBorderColor","trackType","scaledHeight","backgroundColor","colorScale","barBorder","sortLargestOnTop","selectRows"],defaultOptions:{labelPosition:"topLeft",labelColor:"black",labelTextOpacity:.4,valueScaling:"linear",trackBorderWidth:0,trackBorderColor:"black"}};var Ve=Ie;n({name:"StackedBarTrack",track:Kt,config:Kt.config}),n({name:"ScaledStackedBarTrack",track:pe,config:pe.config}),n({name:"BasicMultipleLineChart",track:Me,config:Me.config}),n({name:"BasicMultipleBarChart",track:Ve,config:Ve.config})}])}));